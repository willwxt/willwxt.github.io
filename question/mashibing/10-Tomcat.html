<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tomcat面试题 | SUCKED BloG</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.42575a28.js" as="script"><link rel="preload" href="/assets/js/2.0d7d09b8.js" as="script"><link rel="preload" href="/assets/js/117.f7cb9e2a.js" as="script"><link rel="prefetch" href="/assets/js/10.1a30ebe5.js"><link rel="prefetch" href="/assets/js/100.022f696a.js"><link rel="prefetch" href="/assets/js/101.06eb0acb.js"><link rel="prefetch" href="/assets/js/102.e944c220.js"><link rel="prefetch" href="/assets/js/103.45b9da9a.js"><link rel="prefetch" href="/assets/js/104.cf53f5d1.js"><link rel="prefetch" href="/assets/js/105.200d7fe5.js"><link rel="prefetch" href="/assets/js/106.a0cc3502.js"><link rel="prefetch" href="/assets/js/107.4a71d17e.js"><link rel="prefetch" href="/assets/js/108.d7a39a75.js"><link rel="prefetch" href="/assets/js/109.35619cf9.js"><link rel="prefetch" href="/assets/js/11.f78ae8b3.js"><link rel="prefetch" href="/assets/js/110.f667d72e.js"><link rel="prefetch" href="/assets/js/111.de83ce6f.js"><link rel="prefetch" href="/assets/js/112.417d40bf.js"><link rel="prefetch" href="/assets/js/113.0f26c1ca.js"><link rel="prefetch" href="/assets/js/114.c7014acb.js"><link rel="prefetch" href="/assets/js/115.b502c0f1.js"><link rel="prefetch" href="/assets/js/116.10fb230e.js"><link rel="prefetch" href="/assets/js/118.978d3075.js"><link rel="prefetch" href="/assets/js/119.09272191.js"><link rel="prefetch" href="/assets/js/12.140aa2af.js"><link rel="prefetch" href="/assets/js/120.32b5dbd7.js"><link rel="prefetch" href="/assets/js/121.8d618bbb.js"><link rel="prefetch" href="/assets/js/122.dcd4190d.js"><link rel="prefetch" href="/assets/js/123.2ee061d1.js"><link rel="prefetch" href="/assets/js/124.5a3760a7.js"><link rel="prefetch" href="/assets/js/125.a874a4bc.js"><link rel="prefetch" href="/assets/js/126.c6c6b7e6.js"><link rel="prefetch" href="/assets/js/127.38c35051.js"><link rel="prefetch" href="/assets/js/128.8d775ac8.js"><link rel="prefetch" href="/assets/js/129.6100ddb1.js"><link rel="prefetch" href="/assets/js/13.b2a6e590.js"><link rel="prefetch" href="/assets/js/130.9a83da2a.js"><link rel="prefetch" href="/assets/js/131.22de7670.js"><link rel="prefetch" href="/assets/js/132.f88798bf.js"><link rel="prefetch" href="/assets/js/133.925bbfed.js"><link rel="prefetch" href="/assets/js/134.481fad71.js"><link rel="prefetch" href="/assets/js/135.c3efb09b.js"><link rel="prefetch" href="/assets/js/136.758c447a.js"><link rel="prefetch" href="/assets/js/137.dcde1032.js"><link rel="prefetch" href="/assets/js/138.616a346b.js"><link rel="prefetch" href="/assets/js/139.b58dd07f.js"><link rel="prefetch" href="/assets/js/14.15374560.js"><link rel="prefetch" href="/assets/js/140.62b4c7ea.js"><link rel="prefetch" href="/assets/js/15.ffd155fa.js"><link rel="prefetch" href="/assets/js/16.feb1b022.js"><link rel="prefetch" href="/assets/js/17.6d491eb6.js"><link rel="prefetch" href="/assets/js/18.03ddaa95.js"><link rel="prefetch" href="/assets/js/19.021bbcc8.js"><link rel="prefetch" href="/assets/js/20.8aa708b0.js"><link rel="prefetch" href="/assets/js/21.59d7a21e.js"><link rel="prefetch" href="/assets/js/22.21597439.js"><link rel="prefetch" href="/assets/js/23.77303f0b.js"><link rel="prefetch" href="/assets/js/24.0789ed5b.js"><link rel="prefetch" href="/assets/js/25.244a12a8.js"><link rel="prefetch" href="/assets/js/26.a6ee95e4.js"><link rel="prefetch" href="/assets/js/27.9e0f0e9d.js"><link rel="prefetch" href="/assets/js/28.189031c5.js"><link rel="prefetch" href="/assets/js/29.b3100d33.js"><link rel="prefetch" href="/assets/js/3.2a5d4cd5.js"><link rel="prefetch" href="/assets/js/30.fe8fe8c0.js"><link rel="prefetch" href="/assets/js/31.86fec3f7.js"><link rel="prefetch" href="/assets/js/32.24cac061.js"><link rel="prefetch" href="/assets/js/33.f1db2ed0.js"><link rel="prefetch" href="/assets/js/34.c220692f.js"><link rel="prefetch" href="/assets/js/35.9e7b4779.js"><link rel="prefetch" href="/assets/js/36.0cb1d1bc.js"><link rel="prefetch" href="/assets/js/37.7d1fcf79.js"><link rel="prefetch" href="/assets/js/38.bc9bc4b3.js"><link rel="prefetch" href="/assets/js/39.10801a2a.js"><link rel="prefetch" href="/assets/js/4.b4d9a5aa.js"><link rel="prefetch" href="/assets/js/40.c980543d.js"><link rel="prefetch" href="/assets/js/41.3f4581d8.js"><link rel="prefetch" href="/assets/js/42.60b85cdf.js"><link rel="prefetch" href="/assets/js/43.1338528d.js"><link rel="prefetch" href="/assets/js/44.786fc51f.js"><link rel="prefetch" href="/assets/js/45.d65f6744.js"><link rel="prefetch" href="/assets/js/46.543c2b26.js"><link rel="prefetch" href="/assets/js/47.59f19ed2.js"><link rel="prefetch" href="/assets/js/48.60de6b25.js"><link rel="prefetch" href="/assets/js/49.f3df62ef.js"><link rel="prefetch" href="/assets/js/5.013522c1.js"><link rel="prefetch" href="/assets/js/50.fd9871d6.js"><link rel="prefetch" href="/assets/js/51.1fb1863e.js"><link rel="prefetch" href="/assets/js/52.c06ce3f3.js"><link rel="prefetch" href="/assets/js/53.a3d55203.js"><link rel="prefetch" href="/assets/js/54.89ac64bc.js"><link rel="prefetch" href="/assets/js/55.ccf38d1e.js"><link rel="prefetch" href="/assets/js/56.ffb8595b.js"><link rel="prefetch" href="/assets/js/57.5f1bd695.js"><link rel="prefetch" href="/assets/js/58.7463616d.js"><link rel="prefetch" href="/assets/js/59.ea4eb5dd.js"><link rel="prefetch" href="/assets/js/6.72ad7c85.js"><link rel="prefetch" href="/assets/js/60.a2add219.js"><link rel="prefetch" href="/assets/js/61.3eae0362.js"><link rel="prefetch" href="/assets/js/62.801d1658.js"><link rel="prefetch" href="/assets/js/63.b47a17bb.js"><link rel="prefetch" href="/assets/js/64.d5e2bdea.js"><link rel="prefetch" href="/assets/js/65.24d540f4.js"><link rel="prefetch" href="/assets/js/66.09a1ae52.js"><link rel="prefetch" href="/assets/js/67.75bd38e7.js"><link rel="prefetch" href="/assets/js/68.1fe6956e.js"><link rel="prefetch" href="/assets/js/69.d3306c2d.js"><link rel="prefetch" href="/assets/js/7.60760bb7.js"><link rel="prefetch" href="/assets/js/70.95aa4503.js"><link rel="prefetch" href="/assets/js/71.7065ebf0.js"><link rel="prefetch" href="/assets/js/72.55ae5081.js"><link rel="prefetch" href="/assets/js/73.c7624eee.js"><link rel="prefetch" href="/assets/js/74.63bcc7bd.js"><link rel="prefetch" href="/assets/js/75.e2731e20.js"><link rel="prefetch" href="/assets/js/76.1711af80.js"><link rel="prefetch" href="/assets/js/77.f1c4e2d3.js"><link rel="prefetch" href="/assets/js/78.900bc856.js"><link rel="prefetch" href="/assets/js/79.a1b8c47b.js"><link rel="prefetch" href="/assets/js/8.0c261cf2.js"><link rel="prefetch" href="/assets/js/80.7cf435bf.js"><link rel="prefetch" href="/assets/js/81.fa33b2af.js"><link rel="prefetch" href="/assets/js/82.cdabd386.js"><link rel="prefetch" href="/assets/js/83.879fc50c.js"><link rel="prefetch" href="/assets/js/84.7e460788.js"><link rel="prefetch" href="/assets/js/85.339356d5.js"><link rel="prefetch" href="/assets/js/86.d526418c.js"><link rel="prefetch" href="/assets/js/87.12877e38.js"><link rel="prefetch" href="/assets/js/88.d5a7d193.js"><link rel="prefetch" href="/assets/js/89.2f4a62c2.js"><link rel="prefetch" href="/assets/js/9.50eda380.js"><link rel="prefetch" href="/assets/js/90.6d83f5bf.js"><link rel="prefetch" href="/assets/js/91.f3364825.js"><link rel="prefetch" href="/assets/js/92.158fcc7a.js"><link rel="prefetch" href="/assets/js/93.0c4e5f88.js"><link rel="prefetch" href="/assets/js/94.c5725f80.js"><link rel="prefetch" href="/assets/js/95.dc61d501.js"><link rel="prefetch" href="/assets/js/96.3a598fc5.js"><link rel="prefetch" href="/assets/js/97.712aa8be.js"><link rel="prefetch" href="/assets/js/98.e757fe7a.js"><link rel="prefetch" href="/assets/js/99.1418024a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SUCKED BloG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tomcat面试题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/question/mashibing/10-Tomcat.html#_1-tomcat是什么" class="sidebar-link">1. Tomcat是什么？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_2-tomcat的缺省端口是多少-怎么修改" class="sidebar-link">2. Tomcat的缺省端口是多少，怎么修改</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_3-tomcat-有哪几种connector-运行模式-优化" class="sidebar-link">3. tomcat 有哪几种Connector 运行模式(优化)？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_4-tomcat有几种部署方式" class="sidebar-link">4. Tomcat有几种部署方式？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_5-tomcat容器是如何创建servlet类实例-用到了什么-原理" class="sidebar-link">5. tomcat容器是如何创建servlet类实例？用到了什么 原理？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_6-tomcat工作模式" class="sidebar-link">6. Tomcat工作模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_7-tomcat顶层架构" class="sidebar-link">7. Tomcat顶层架构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_8-connector和container的微妙关系" class="sidebar-link">8. Connector和Container的微妙关系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/question/mashibing/10-Tomcat.html#connector架构分析" class="sidebar-link">Connector架构分析</a></li></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_9-container架构分析" class="sidebar-link">9. Container架构分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/10-Tomcat.html#_10-container如何处理请求的" class="sidebar-link">10. Container如何处理请求的</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tomcat面试题"><a href="#tomcat面试题" class="header-anchor">#</a> Tomcat面试题</h1> <h2 id="_1-tomcat是什么"><a href="#_1-tomcat是什么" class="header-anchor">#</a> 1. Tomcat是什么？</h2> <p>Tomcat 服务器Apache软件基金会项目中的一个核心项目，是一个免费的开放源代码的Web应用服务器，属于轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP程序的首选。</p> <h2 id="_2-tomcat的缺省端口是多少-怎么修改"><a href="#_2-tomcat的缺省端口是多少-怎么修改" class="header-anchor">#</a> 2. Tomcat的缺省端口是多少，怎么修改</h2> <p>在Tomcat目录下的conf/server.xml文件中找到以下信息, 把Connector标签的8080端口改成你想要的端口</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_3-tomcat-有哪几种connector-运行模式-优化"><a href="#_3-tomcat-有哪几种connector-运行模式-优化" class="header-anchor">#</a> 3. tomcat 有哪几种Connector 运行模式(优化)？</h2> <p>下面，我们先大致了解Tomcat Connector的三种运行模式。</p> <ul><li><strong>BIO：同步并阻塞</strong> 一个线程处理一个请求。缺点：并发量高时，线程数较 多，浪费资源。Tomcat7或以下，在Linux系统中默认使用这种方式。<br> <strong>配置项</strong> <code>protocol=&quot;HTTP/1.1&quot;</code></li> <li><strong>NIO：同步非阻塞IO</strong> 利用Java的异步IO处理，可以通过少量的线程处理大量的请求，可以复用同一 个线程处理多个connection(多路复用)。
Tomcat8在Linux系统中默认使用这种方式。
Tomcat7必须修改Connector配置来启动。
<strong>配置项</strong> <code>protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</code>
**备注：**我们常用的Jetty，Mina，ZooKeeper等都是基于java nio实现.</li> <li><strong>APR</strong> (Apache Portable Runtime) 从操作系统层面解决io阻塞问题。<strong>AIO方式，异步非阻塞IO</strong>(Java NIO2又叫AIO) 主要与NIO的区别主要是操作系统的底层区别. 可以做个比喻:快递，NIO就是网购后要自己到官网查快递是否已经到了(可能是多次)，然后自己去取快递；AIO就是快递员送货上门了(不用关注快递进度)。
<strong>配置</strong> <code>protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot;</code>
**备注：**需在本地服务器安装APR库。Tomcat7或Tomcat8在Win7或以上的系统中启动默认使用这种方式。Linux如果安装了apr和native，Tomcat直接启动就支持apr。</li></ul> <h2 id="_4-tomcat有几种部署方式"><a href="#_4-tomcat有几种部署方式" class="header-anchor">#</a> 4. Tomcat有几种部署方式？</h2> <p>**在Tomcat中部署Web应用的方式主要有如下几种： **</p> <ul><li>利用Tomcat的自动部署。 把web应用拷贝到webapps目录。Tomcat在启动时会加载目录下的应用，并将编译后的结果放入work目录下。</li> <li>使用Manager App控制台部署。 在tomcat主页点击“Manager App” 进入应用管理控制台，可以指定一个 web应用的路径或war文件。</li> <li>修改conf/server.xml文件部署。 修改conf/server.xml文件，增加Context节点可以部署应用。</li> <li>增加自定义的Web部署文件。在conf/Catalina/localhost/ 路径下增加 xyz.xml文件，内容是Context节点， 可以部署应用</li></ul> <h2 id="_5-tomcat容器是如何创建servlet类实例-用到了什么-原理"><a href="#_5-tomcat容器是如何创建servlet类实例-用到了什么-原理" class="header-anchor">#</a> 5. tomcat容器是如何创建servlet类实例？用到了什么 原理？</h2> <ol><li>当容器启动时，会读取在webapps目录下所有的web应用中的web.xml 文件，然后对 xml文件进行解析，读取servlet注册信息。然后，将每个应用中注册的servlet类都进行加载，并通过反射的方式实例化。(（有时候 也是在第一次请求时实例化</li> <li>在servlet注册时加上1如果为正数，则在一开始就实例化，如果不写或为负数，则第一次请求实例化。</li></ol> <h2 id="_6-tomcat工作模式"><a href="#_6-tomcat工作模式" class="header-anchor">#</a> 6. Tomcat工作模式</h2> <p>Tomcat作为servlet容器，有三种工作模式：</p> <ol><li>独立的servlet容器，servlet容器是web服务器的一部分；</li> <li>进程内的servlet容器，servlet容器是作为web服务器的插件和java容器的实现，web服务器插件在内部地址空间打开一个jvm使得java容器在内部得以运行。反应速度快但伸缩性不足；</li> <li>进程外的servlet容器，servlet容器运行于web服务器之外的地址空间，并作为web服务器的插件和java容器实现的结合。反应时间不如进程内但伸缩性和稳定性比进程内优； 进入Tomcat的请求可以根据Tomcat的工作模式分为如下两类：</li></ol> <ul><li>Tomcat作为应用程序服务器：请求来自于前端的web服务器，这可能是 Apache, IIS, Nginx等；</li> <li>Tomcat作为独立服务器：请求来自于web浏览器；</li></ul> <p>面试时问到Tomcat相关问题的几率并不高，正式因为如此，很多人忽略了对 Tomcat相关技能的掌握，下面这一篇文章整理了Tomcat相关的系统架构，介绍了Server、Service、Connector、Container之间的关系，各个模块的功能，可以说把这几个掌握住了，Tomcat相关的面试题你就不会有任何问题了！</p> <p>另外，在面试的时候你还要有意识无意识的往Tomcat这个地方引，就比如说常见的Spring MVC的执行流程，一个URL的完整调用链路，这些相关的题目你是可以往Tomcat处理请求的这个过程去说的！掌握了Tomcat这些技能，面试官一定会佩服你的！</p> <p>学了本章之后你应该明白的是：</p> <ul><li>Server、Service、Connector、Container四大组件之间的关系和联系，以及他们的主要功能点；</li> <li>Tomcat执行的整体架构，请求是如何被一步步处理的；</li> <li>Engine、Host、Context、Wrapper相关的概念关系；</li> <li>Container 是如何处理请求的；</li> <li>Tomcat 用到的相关设计模式；</li></ul> <h2 id="_7-tomcat顶层架构"><a href="#_7-tomcat顶层架构" class="header-anchor">#</a> 7. Tomcat顶层架构</h2> <p>俗话说，站在巨人的肩膀上看世界，一般学习的时候也是先总览一下整体，然后逐个部分击破，最后形成思路，了解具体细节，Tomcat的结构很复杂，但是 Tomcat 非常的模块化，找到了 Tomcat 最核心的模块，问题可以迎刃而解，了解整体架构对以后深入了解 Tomcat 来说至关重要！ 先上一张Tomcat的顶层结构图，如下：</p> <p><svg id="SvgjsSvg1093" width="566.9943084716797" height="296" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1094"><marker id="SvgjsMarker1120" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1121" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1095" width="566.9943084716797" height="296" fill="#ffffff"></rect><g id="SvgjsG1096" transform="translate(25.000015258789062,25.011367797851562)"><path id="SvgjsPath1097" d="M 0 4Q 0 0 4 0L 214 0Q 218 0 218 4L 218 242Q 218 246 214 246L 4 246Q 0 246 0 242Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1098"><text id="SvgjsText1099" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="198px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="113.875" transform="rotate(0)"></text></g></g><g id="SvgjsG1100" transform="translate(261.00001525878906,27.511367797851562)"><path id="SvgjsPath1101" d="M 0 0L 281 0L 281 241L 0 241Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1102"><text id="SvgjsText1103" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="261px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="111.375" transform="rotate(0)"></text></g></g><g id="SvgjsG1104" transform="translate(52.00001525878906,108.01136779785156)"><path id="SvgjsPath1105" d="M 0 24.8L 16.400000000000002 24.8L 16.400000000000002 12.4L 32.800000000000004 12.4L 32.800000000000004 0L 164 0L 164 86.8L 147.6 86.8L 147.6 99.2L 131.20000000000002 99.2L 131.20000000000002 111.60000000000001Q 98.4 99.2 65.60000000000001 111.60000000000001Q 32.800000000000004 124 0 111.60000000000001L 0 24.8M 0 24.8L 131.20000000000002 24.8L 131.20000000000002 111.60000000000001Q 98.4 99.2 65.60000000000001 111.60000000000001Q 32.800000000000004 124 0 111.60000000000001L 0 24.8M 16.400000000000002 24.8L 16.400000000000002 12.4L 147.6 12.4L 147.6 99.2L 131.20000000000002 99.2L 131.20000000000002 24.8" stroke="rgba(11,108,195,1)" stroke-width="2" fill-opacity="1" fill="#99ccff"></path><g id="SvgjsG1106"><text id="SvgjsText1107" font-family="微软雅黑" text-anchor="middle" font-size="18px" width="132px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="18px" weight="400" font-style="" opacity="1" y="50.150000000000006" transform="rotate(0)"><tspan id="SvgjsTspan1108" dy="22" x="66"><tspan id="SvgjsTspan1109">Service</tspan></tspan><tspan id="SvgjsTspan1110" dy="22" x="66"><tspan id="SvgjsTspan1111"></tspan></tspan></text></g></g><g id="SvgjsG1112" transform="translate(25.000015258789062,35.01136779785156)"><path id="SvgjsPath1113" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1114"><text id="SvgjsText1115" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1116" dy="16" x="60"><tspan id="SvgjsTspan1117">Server服务器</tspan></tspan></text></g></g><g id="SvgjsG1118"><path id="SvgjsPath1119" d="M182.58580169641596 216.59715423547846C 212.05144133294613 246.06279387200863 219.32930806080986 148.01136779785156 261.00001525878906 148.01136779785156" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1120)"></path></g><g id="SvgjsG1122" transform="translate(243.00001525878906,36.51136779785156)"><path id="SvgjsPath1123" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1124"><text id="SvgjsText1125" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1126" dy="16" x="60"><tspan id="SvgjsTspan1127">Service</tspan></tspan></text></g></g><g id="SvgjsG1128" transform="translate(295.00001525878906,81.51136779785156)"><path id="SvgjsPath1129" d="M 0 14L 10 14L 10 7L 20 7L 20 0L 100 0L 100 49L 90 49L 90 56L 80 56L 80 63Q 60 56 40 63Q 20 70 0 63L 0 14M 0 14L 80 14L 80 63Q 60 56 40 63Q 20 70 0 63L 0 14M 10 14L 10 7L 90 7L 90 56L 80 56L 80 14" stroke="rgba(11,108,195,1)" stroke-width="2" fill-opacity="1" fill="#99ccff"></path><g id="SvgjsG1130"><text id="SvgjsText1131" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.875" transform="rotate(0)"><tspan id="SvgjsTspan1132" dy="16" x="40"><tspan id="SvgjsTspan1133">Connector</tspan></tspan><tspan id="SvgjsTspan1134" dy="16" x="40"><tspan id="SvgjsTspan1135"></tspan></tspan></text></g></g><g id="SvgjsG1136" transform="translate(426.00001525878906,76.51136779785156)"><path id="SvgjsPath1137" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 66Q 100 70 96 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1138"><text id="SvgjsText1139" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="25.875" transform="rotate(0)"><tspan id="SvgjsTspan1140" dy="16" x="50"><tspan id="SvgjsTspan1141">Container</tspan></tspan></text></g></g><g id="SvgjsG1142" transform="translate(281.50001525878906,166.51136779785156)"><path id="SvgjsPath1143" d="M 0 0L 63 0L 63 34L 0 34Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1144"><text id="SvgjsText1145" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="43px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1146" dy="16" x="31.5"><tspan id="SvgjsTspan1147">Jasper</tspan></tspan></text></g></g><g id="SvgjsG1148" transform="translate(369.50001525878906,166.51136779785156)"><path id="SvgjsPath1149" d="M 0 0L 75 0L 75 34L 0 34Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1150"><text id="SvgjsText1151" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="55px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1152" dy="16" x="37.5"><tspan id="SvgjsTspan1153">Naming</tspan></tspan></text></g></g><g id="SvgjsG1154" transform="translate(463.00001525878906,166.51136779785156)"><path id="SvgjsPath1155" d="M 0 0L 70 0L 70 34L 0 34Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1156"><text id="SvgjsText1157" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="50px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1158" dy="16" x="35"><tspan id="SvgjsTspan1159">Session</tspan></tspan></text></g></g><g id="SvgjsG1160" transform="translate(281.00001525878906,219.51136779785156)"><path id="SvgjsPath1161" d="M 0 0L 64 0L 64 35L 0 35Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1162"><text id="SvgjsText1163" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="44px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="8.375" transform="rotate(0)"><tspan id="SvgjsTspan1164" dy="16" x="32"><tspan id="SvgjsTspan1165">Loging</tspan></tspan></text></g></g><g id="SvgjsG1166" transform="translate(366.00001525878906,220.01136779785156)"><path id="SvgjsPath1167" d="M 0 0L 63 0L 63 34L 0 34Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1168"><text id="SvgjsText1169" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="43px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1170" dy="16" x="31.5"><tspan id="SvgjsTspan1171">JMX</tspan></tspan></text></g></g><g id="SvgjsG1172" transform="translate(444.50001525878906,220.01136779785156)"><path id="SvgjsPath1173" d="M 0 0L 63 0L 63 34L 0 34Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1174"><text id="SvgjsText1175" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="43px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1176" dy="16" x="31.5"><tspan id="SvgjsTspan1177">...</tspan></tspan></text></g></g></svg></p> <p>Tomcat中最顶层的容器是Server，代表着整个服务器，从上图中可以看出，一 个Server可以包含一个至多个Service，用于具体提供服务。</p> <p>Service主要包含两个部分：Connector和Container。从上图中可以看出  Tomcat 的心脏就是这两个组件，他们的作用如下：</p> <ul><li>Connector用于处理连接相关的事情，并提供Socket与Request请求和Response响应相关的转化;</li> <li>Container用于封装和管理Servlet，以及具体处理Request请求；</li></ul> <p>一个Tomcat中只有一个Server，一个Server可以包含多个Service，一个 Service只有一个Container，但是可以有多个Connector，这是因为一个服务可以有多个连接，如同时提供Http和Https链接，也可以提供向相同协议不同端口的连接，示意图如下（Engine、Host、Context下面会说到）：</p> <p><svg id="SvgjsSvg1329" width="611.9943237304688" height="414" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1330"><marker id="SvgjsMarker1436" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1437" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1444" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1445" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1452" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1453" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1460" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1461" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1468" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1469" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1472" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1473" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1476" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1477" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1480" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1481" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1331" width="611.9943237304688" height="414" fill="#ffffff"></rect><g id="SvgjsG1332" transform="translate(196.00001525878906,25.005691528320312)"><path id="SvgjsPath1333" d="M 0 4Q 0 0 4 0L 387 0Q 391 0 391 4L 391 360Q 391 364 387 364L 4 364Q 0 364 0 360Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1334"><text id="SvgjsText1335" font-family="微软雅黑" text-anchor="start" font-size="13px" width="371px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1336" dy="16" x="10"><tspan id="SvgjsTspan1337">Server服务器</tspan></tspan></text></g></g><g id="SvgjsG1338" transform="translate(220.00001525878906,69.00569152832031)"><path id="SvgjsPath1339" d="M 0 4Q 0 0 4 0L 339 0Q 343 0 343 4L 343 307Q 343 311 339 311L 4 311Q 0 311 0 307Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1340"><text id="SvgjsText1341" font-family="微软雅黑" text-anchor="start" font-size="13px" width="323px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1342" dy="16" x="10"><tspan id="SvgjsTspan1343">Service</tspan></tspan></text></g></g><g id="SvgjsG1344" transform="translate(242.00001525878906,113.00569152832031)"><path id="SvgjsPath1345" d="M 0 0L 110 0L 110 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1346"><text id="SvgjsText1347" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="90px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1348" dy="16" x="55"><tspan id="SvgjsTspan1349">Connector</tspan></tspan></text></g></g><g id="SvgjsG1350" transform="translate(390,113.00569152832031)"><path id="SvgjsPath1351" d="M 0 4Q 0 0 4 0L 136 0Q 140 0 140 4L 140 232Q 140 236 136 236L 4 236Q 0 236 0 232Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1352"><text id="SvgjsText1353" font-family="微软雅黑" text-anchor="start" font-size="13px" width="120px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1354" dy="16" x="10"><tspan id="SvgjsTspan1355">Engine</tspan></tspan></text></g></g><g id="SvgjsG1356" transform="translate(418.50001525878906,152.0056915283203)"><path id="SvgjsPath1357" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 82Q 100 86 96 86L 4 86Q 0 86 0 82Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1358"><text id="SvgjsText1359" font-family="微软雅黑" text-anchor="start" font-size="13px" width="80px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1360" dy="16" x="10"><tspan id="SvgjsTspan1361">Host</tspan></tspan></text></g></g><g id="SvgjsG1362" transform="translate(428.00001525878906,173.0056915283203)"><path id="SvgjsPath1363" d="M 0 0L 81 0L 81 23L 0 23Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1364"><text id="SvgjsText1365" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="61px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1366" dy="16" x="40.5"><tspan id="SvgjsTspan1367">Context</tspan></tspan></text></g></g><g id="SvgjsG1368" transform="translate(428.00001525878906,207.0056915283203)"><path id="SvgjsPath1369" d="M 0 0L 81 0L 81 23L 0 23Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1370"><text id="SvgjsText1371" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="61px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1372" dy="16" x="40.5"><tspan id="SvgjsTspan1373">Context</tspan></tspan></text></g></g><g id="SvgjsG1374" transform="translate(418.50001525878906,256.0056915283203)"><path id="SvgjsPath1375" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 82Q 100 86 96 86L 4 86Q 0 86 0 82Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1376"><text id="SvgjsText1377" font-family="微软雅黑" text-anchor="start" font-size="13px" width="80px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1378" dy="16" x="10"><tspan id="SvgjsTspan1379">Host</tspan></tspan></text></g></g><g id="SvgjsG1380" transform="translate(428.00001525878906,277.0056915283203)"><path id="SvgjsPath1381" d="M 0 0L 81 0L 81 23L 0 23Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1382"><text id="SvgjsText1383" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="61px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1384" dy="16" x="40.5"><tspan id="SvgjsTspan1385">Context</tspan></tspan></text></g></g><g id="SvgjsG1386" transform="translate(428.00001525878906,311.0056915283203)"><path id="SvgjsPath1387" d="M 0 0L 81 0L 81 23L 0 23Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1388"><text id="SvgjsText1389" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="61px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1390" dy="16" x="40.5"><tspan id="SvgjsTspan1391">Context</tspan></tspan></text></g></g><g id="SvgjsG1392" transform="translate(242.00001525878906,175.33902486165363)"><path id="SvgjsPath1393" d="M 0 0L 110 0L 110 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1394"><text id="SvgjsText1395" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="90px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1396" dy="16" x="55"><tspan id="SvgjsTspan1397">Connector</tspan></tspan></text></g></g><g id="SvgjsG1398" transform="translate(242.00001525878906,237.67235819498694)"><path id="SvgjsPath1399" d="M 0 0L 110 0L 110 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1400"><text id="SvgjsText1401" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="90px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1402" dy="16" x="55"><tspan id="SvgjsTspan1403">Connector</tspan></tspan></text></g></g><g id="SvgjsG1404" transform="translate(242.00001525878906,300.00569152832026)"><path id="SvgjsPath1405" d="M 0 0L 110 0L 110 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1406"><text id="SvgjsText1407" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="90px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1408" dy="16" x="55"><tspan id="SvgjsTspan1409">Connector</tspan></tspan></text></g></g><g id="SvgjsG1410" transform="translate(25.000015258789062,100.00569152832031)"><path id="SvgjsPath1411" d="M 0 0L 100 0L 100 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1412"><text id="SvgjsText1413" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1414" dy="16" x="50"><tspan id="SvgjsTspan1415">浏览器</tspan></tspan></text></g></g><g id="SvgjsG1416" transform="translate(25.000015258789062,165.33902486165363)"><path id="SvgjsPath1417" d="M 0 0L 100 0L 100 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1418"><text id="SvgjsText1419" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1420" dy="16" x="50"><tspan id="SvgjsTspan1421">浏览器</tspan></tspan></text></g></g><g id="SvgjsG1422" transform="translate(25.000015258789062,231.0056915283203)"><path id="SvgjsPath1423" d="M 0 33C 0 -11 100 -11 100 33C 100 77 0 77 0 33Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1424"><text id="SvgjsText1425" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="23.875" transform="rotate(0)"><tspan id="SvgjsTspan1426" dy="16" x="50"><tspan id="SvgjsTspan1427">JK 1.2.X</tspan></tspan></text></g></g><g id="SvgjsG1428" transform="translate(25.000015258789062,313.0056915283203)"><path id="SvgjsPath1429" d="M 0 33C 0 -11 100 -11 100 33C 100 77 0 77 0 33Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1430"><text id="SvgjsText1431" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="23.875" transform="rotate(0)"><tspan id="SvgjsTspan1432" dy="16" x="50"><tspan id="SvgjsTspan1433">其他连接</tspan></tspan></text></g></g><g id="SvgjsG1434"><path id="SvgjsPath1435" d="M125.00001525878906 119.50569152832031C 172.08801797710362 119.50569152832031 194.9120125404745 132.5056915283203 242.00001525878906 132.5056915283203" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1436)"></path><rect id="SvgjsRect1438" width="73" height="20" x="147.00001525878906" y="116.00569152832031" fill="#ffffff"></rect><text id="SvgjsText1439" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="73px" fill="#323232" font-weight="400" align="top" lineHeight="20px" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="114.00569152832031" transform="rotate(0)"><tspan id="SvgjsTspan1440" dy="20" x="183.50001525878906"><tspan id="SvgjsTspan1441">HTTP协议</tspan></tspan></text></g><g id="SvgjsG1442"><path id="SvgjsPath1443" d="M125.00001525878906 184.83902486165363C 171.97064437954919 184.83902486165363 195.02938613802894 194.83902486165363 242.00001525878906 194.83902486165363" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1444)"></path><rect id="SvgjsRect1446" width="50" height="20" x="158.50001525878906" y="179.83902486165363" fill="#ffffff"></rect><text id="SvgjsText1447" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="50px" fill="#323232" font-weight="400" align="top" lineHeight="20px" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="177.83902486165363" transform="rotate(0)"><tspan id="SvgjsTspan1448" dy="20" x="183.50001525878906"><tspan id="SvgjsTspan1449">HTTPS</tspan></tspan></text></g><g id="SvgjsG1450"><path id="SvgjsPath1451" d="M125.00001525878906 264.0056915283203C 171.16755810460998 272.1462749650526 195.12026364776716 257.17235819498694 242.00001525878906 257.17235819498694" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1452)"></path><rect id="SvgjsRect1454" width="27" height="20" x="169.73293697183868" y="253.64174365042823" fill="#ffffff"></rect><text id="SvgjsText1455" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="27px" fill="#323232" font-weight="400" align="top" lineHeight="20px" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="251.64174365042823" transform="rotate(0)"><tspan id="SvgjsTspan1456" dy="20" x="183.23293697183868"><tspan id="SvgjsTspan1457">AJP</tspan></tspan></text></g><g id="SvgjsG1458"><path id="SvgjsPath1459" d="M125.00001525878906 346.0056915283203C 172.25642344128656 354.33827130226695 194.01460080814581 319.50569152832026 242.00001525878906 319.50569152832026" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1460)"></path><rect id="SvgjsRect1462" width="64" height="20" x="151.2266379082344" y="325.88040894355026" fill="#ffffff"></rect><text id="SvgjsText1463" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="64px" fill="#323232" font-weight="400" align="top" lineHeight="20px" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="323.88040894355026" transform="rotate(0)"><tspan id="SvgjsTspan1464" dy="20" x="183.2266379082344"><tspan id="SvgjsTspan1465">其他协议</tspan></tspan></text></g><g id="SvgjsG1466"><path id="SvgjsPath1467" d="M352.00001525878906 132.5056915283203C 368.5541489199371 132.5056915283203 373.44585339200063 148.8992276499933 389.9999870531487 148.8992276499933" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1468)"></path></g><g id="SvgjsG1470"><path id="SvgjsPath1471" d="M352.00001525878906 194.83902486165363C 367.6869241695497 194.83902486165363 374.31307814238806 204.53420863858645 389.9999870531487 204.53420863858645" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1472)"></path></g><g id="SvgjsG1474"><path id="SvgjsPath1475" d="M352.00001525878906 257.17235819498694C 367.20049298445 257.17235819498694 374.7995093274877 257.4771744180541 389.9999870531487 257.4771744180541" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1476)"></path></g><g id="SvgjsG1478"><path id="SvgjsPath1479" d="M352.00001525878906 319.50569152832026C 367.31091262440003 319.50569152832026 374.6890896875377 314.90683221273093 389.9999870531487 314.90683221273093" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1480)"></path></g></svg></p> <p>多个 Connector 和一个 Container 就形成了一个 Service，有了 Service 就可以对外提供服务了，但是 Service 还要一个生存的环境，必须要有人能够给她生命、掌握其生死大权，那就非 Server 莫属了！所以整个 Tomcat 的生命周期由 Server 控制。</p> <p>另外，上述的包含关系或者说是父子关系，都可以在tomcat的conf目录下的 server.xml 配置文件中看出，下图是删除了注释内容之后的一个完整的 server.xml配置文件（Tomcat版本为8.0）</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Server</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8005<span class="token punctuation">&quot;</span></span> <span class="token attr-name">shutdown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SHUTDOWN<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.startup.VersionLoggerListener<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.core.AprLifecycleListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">SSLEngine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>on<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.core.JreMemoryLeakPreventionListener<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.mbeans.GlobalResourcesLifecycleListener<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.core.ThreadLocalLeakPreventionListener<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GlobalNamingResources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Resource</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UserDatabase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Container<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.UserDatabase<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">description</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>User database that can be updated and saved<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.users.MemoryUserDatabaseFactory<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">pathname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>conf/tomcat-users.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GlobalNamingResources</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Catalina<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8009<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AJP/1.3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Engine</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Catalina<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localhost<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Cluster</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.realm.LockOutRealm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.realm.UserDatabaseRealm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resourceName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UserDatabase<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Realm</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localhost<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webapps<span class="token punctuation">&quot;</span></span> <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.authenticator.SingleSignOn<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.catalina.valves.AccessLogValve<span class="token punctuation">&quot;</span></span> <span class="token attr-name">directory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logs<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localhost_access_log<span class="token punctuation">&quot;</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.txt<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%h %l %u %t <span class="token entity named-entity" title="&quot;">&amp;quot;</span>%r<span class="token entity named-entity" title="&quot;">&amp;quot;</span> %s %b<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Host</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Engine</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Service</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Server</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>详细的配置文件内容可以到Tomcat官网查看：<a href="http://tomcat.apache.org/tomcat-8.0-doc/index.html" target="_blank" rel="noopener noreferrer">Tomcat配置文件 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>上边的配置文件，还可以通过下边的一张结构图更清楚的理解：</p> <p><svg id="SvgjsSvg1615" width="839.5028076171875" height="432.9971160888672" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1616"></defs><rect id="SvgjsRect1617" width="839.5028076171875" height="432.9971160888672" fill="#ffffff"></rect><g id="SvgjsG1618" transform="translate(473.008544921875,172.00852966308594)"><path id="SvgjsPath1619" d="M 0 0L 145 0L 145 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1620"><text id="SvgjsText1621" font-family="微软雅黑" text-anchor="start" font-size="13px" width="125px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1622" dy="16" x="10"><tspan id="SvgjsTspan1623">Service</tspan></tspan><tspan id="SvgjsTspan1624" dy="16" x="10"><tspan id="SvgjsTspan1625">Tomcat-standalone</tspan></tspan></text></g></g><g id="SvgjsG1626" transform="translate(49.008544921875,85.00852966308594)"><path id="SvgjsPath1627" d="M 0 0L 108 0L 108 42L 0 42Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1628"><text id="SvgjsText1629" font-family="微软雅黑" text-anchor="start" font-size="13px" width="88px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="3.875" transform="rotate(0)"><tspan id="SvgjsTspan1630" dy="16" x="10"><tspan id="SvgjsTspan1631">Context</tspan></tspan><tspan id="SvgjsTspan1632" dy="16" x="10"><tspan id="SvgjsTspan1633">path = &quot;&quot;</tspan></tspan></text></g></g><g id="SvgjsG1634" transform="translate(25.008544921875,166.00852966308594)"><path id="SvgjsPath1635" d="M 0 0L 132 0L 132 38L 0 38Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1636"><text id="SvgjsText1637" font-family="微软雅黑" text-anchor="start" font-size="13px" width="112px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1.875" transform="rotate(0)"><tspan id="SvgjsTspan1638" dy="16" x="10"><tspan id="SvgjsTspan1639">Context</tspan></tspan><tspan id="SvgjsTspan1640" dy="16" x="10"><tspan id="SvgjsTspan1641">path = &quot;/wsota&quot;</tspan></tspan></text></g></g><g id="SvgjsG1642" transform="translate(198.008544921875,127.00852966308594)"><path id="SvgjsPath1643" d="M 0 0L 110 0L 110 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1644"><text id="SvgjsText1645" font-family="微软雅黑" text-anchor="start" font-size="13px" width="90px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1646" dy="16" x="10"><tspan id="SvgjsTspan1647">Host</tspan></tspan><tspan id="SvgjsTspan1648" dy="16" x="10"><tspan id="SvgjsTspan1649">localhost</tspan></tspan></text></g></g><g id="SvgjsG1650" transform="translate(198.008544921875,212.00852966308594)"><path id="SvgjsPath1651" d="M 0 0L 110 0L 110 40L 0 40Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1652"><text id="SvgjsText1653" font-family="微软雅黑" text-anchor="start" font-size="13px" width="90px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan1654" dy="16" x="10"><tspan id="SvgjsTspan1655">Host...</tspan></tspan><tspan id="SvgjsTspan1656" dy="16" x="10"><tspan id="SvgjsTspan1657">www.xyz.com</tspan></tspan></text></g></g><g id="SvgjsG1658" transform="translate(354.008544921875,172.00852966308594)"><path id="SvgjsPath1659" d="M 0 0L 71 0L 71 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1660"><text id="SvgjsText1661" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="51px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1662" dy="16" x="35.5"><tspan id="SvgjsTspan1663">Engine</tspan></tspan></text></g></g><g id="SvgjsG1664" transform="translate(492.008544921875,79.00852966308594)"><path id="SvgjsPath1665" d="M 0 0L 107 0L 107 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1666"><text id="SvgjsText1667" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="87px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1668" dy="16" x="53.5"><tspan id="SvgjsTspan1669">Server</tspan></tspan></text></g></g><g id="SvgjsG1670" transform="translate(651.008544921875,172.00852966308594)"><path id="SvgjsPath1671" d="M 0 0L 89 0L 89 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1672"><text id="SvgjsText1673" font-family="微软雅黑" text-anchor="start" font-size="13px" width="69px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1674" dy="16" x="10"><tspan id="SvgjsTspan1675">Services2...</tspan></tspan></text></g></g><g id="SvgjsG1676" transform="translate(392.008544921875,261.00852966308594)"><path id="SvgjsPath1677" d="M 0 0L 129 0L 129 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1678"><text id="SvgjsText1679" font-family="微软雅黑" text-anchor="start" font-size="13px" width="109px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1680" dy="16" x="10"><tspan id="SvgjsTspan1681">Connector</tspan></tspan><tspan id="SvgjsTspan1682" dy="16" x="10"><tspan id="SvgjsTspan1683">Coyote HTTP/1.1</tspan></tspan></text></g></g><g id="SvgjsG1684" transform="translate(585.508544921875,261.00852966308594)"><path id="SvgjsPath1685" d="M 0 0L 98 0L 98 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1686"><text id="SvgjsText1687" font-family="微软雅黑" text-anchor="start" font-size="13px" width="78px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1688" dy="16" x="10"><tspan id="SvgjsTspan1689">Connector</tspan></tspan><tspan id="SvgjsTspan1690" dy="16" x="10"><tspan id="SvgjsTspan1691">Coyote JK2</tspan></tspan></text></g></g><g id="SvgjsG1692"><path id="SvgjsPath1693" d="M157.008544921875 106.00852966308594L198.008544921875 146.50852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1694"><path id="SvgjsPath1695" d="M157.008544921875 185.00852966308594L198.008544921875 146.50852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1696"><path id="SvgjsPath1697" d="M308.008544921875 146.50852966308594L354.008544921875 191.50852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1698"><path id="SvgjsPath1699" d="M308.008544921875 232.00852966308594L354.008544921875 191.50852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1700"><path id="SvgjsPath1701" d="M425.008544921875 191.50852966308594L473.008544921875 191.50852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1702"><path id="SvgjsPath1703" d="M545.508544921875 211.00852966308594L456.508544921875 261.00852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1704"><path id="SvgjsPath1705" d="M545.508544921875 211.00852966308594L634.508544921875 261.00852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1706"><path id="SvgjsPath1707" d="M545.508544921875 172.00852966308594L545.508544921875 118.00852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1708"><path id="SvgjsPath1709" d="M592.3671656115303 116.00852966308594L653.3481605432465 172.77001044710943" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1710" transform="translate(183.008544921875,348.00852966308594)"><path id="SvgjsPath1711" d="M 0 0L 54 0L 54 37L 0 37Z" stroke="none" fill="none"></path><g id="SvgjsG1712"><text id="SvgjsText1713" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="54px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.375" transform="rotate(0)"><tspan id="SvgjsTspan1714" dy="16" x="27"><tspan id="SvgjsTspan1715">TCP</tspan></tspan></text></g></g><g id="SvgjsG1716" transform="translate(694.508544921875,25.008529663085938)"><path id="SvgjsPath1717" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1718"><text id="SvgjsText1719" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1720" dy="16" x="60"><tspan id="SvgjsTspan1721">TCP</tspan></tspan></text></g></g><g id="SvgjsG1722"><path id="SvgjsPath1723" d="M237.008544921875 366.50852966308594L754.508544921875 366.50852966308594L754.508544921875 65.00852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1724"><path id="SvgjsPath1725" d="M599.008544921875 98.50852966308594L677.008544921875 98.50852966308594L677.008544921875 98.50852966308594L755.008544921875 98.50852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1726" transform="translate(755.008544921875,78.50852966308594)"><path id="SvgjsPath1727" d="M 0 0L 54 0L 54 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1728"><text id="SvgjsText1729" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="54px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1730" dy="16" x="27"><tspan id="SvgjsTspan1731">8005</tspan></tspan></text></g></g><g id="SvgjsG1732"><path id="SvgjsPath1733" d="M456.508544921875 300.00852966308594L456.508544921875 334.00852966308594L456.508544921875 334.00852966308594L456.508544921875 368.00852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1734" transform="translate(396.508544921875,368.00852966308594)"><path id="SvgjsPath1735" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1736"><text id="SvgjsText1737" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1738" dy="16" x="60"><tspan id="SvgjsTspan1739">8080</tspan></tspan></text></g></g><g id="SvgjsG1740"><path id="SvgjsPath1741" d="M634.508544921875 300.00852966308594L634.508544921875 334.00852966308594L634.508544921875 334.00852966308594L634.508544921875 368.00852966308594" stroke="#323232" stroke-width="2" fill="none"></path></g><g id="SvgjsG1742" transform="translate(574.508544921875,368.00852966308594)"><path id="SvgjsPath1743" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1744"><text id="SvgjsText1745" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1746" dy="16" x="60"><tspan id="SvgjsTspan1747">8009</tspan></tspan></text></g></g></svg></p> <p>Server标签设置的端口号为8005，shutdown=”SHUTDOWN” ，表示在8005端口监听“SHUTDOWN”命令，如果接收到了就会关闭Tomcat。一个 Server有一个Service，当然还可以进行配置，一个Service有多个Connector， Service左边的内容都属于Container的，Service下边是Connector。</p> <p><strong>Tomcat顶层架构小结</strong></p> <ol><li>Tomcat中只有一个Server，一个Server可以有多个Service，一个 Service可以有多个Connector和一个Container；</li> <li>Server掌管着整个Tomcat的生死大权；</li> <li>Service 是对外提供服务的；</li> <li>Connector用于接受请求并将请求封装成Request和Response来具体处理；</li> <li>Container用于封装和管理Servlet，以及具体处理request请求；</li></ol> <p>知道了整个Tomcat顶层的分层架构和各个组件之间的关系以及作用，对于绝大多数的开发人员来说Server和Service对我们来说确实很远，而我们开发中绝大部分进行配置的内容是属于Connector和Container的，所以接下来介绍一下Connector和Container。</p> <h2 id="_8-connector和container的微妙关系"><a href="#_8-connector和container的微妙关系" class="header-anchor">#</a> 8. Connector和Container的微妙关系</h2> <p>由上述内容我们大致可以知道一个请求发送到Tomcat之后，首先经过Service然后会交给我们的Connector，Connector用于接收请求并将接收的请求封装为Request和Response来具体处理，Request和Response封装完之后再交由Container进行处理，Container处理完请求之后再返回给Connector，最后在 由Connector通过Socket将处理的结果返回给客户端，这样整个请求的就处理完了！</p> <p>Connector最底层使用的是Socket来进行连接的，Request和Response是按照 HTTP协议来封装的，所以Connector同时需要实现TCP/IP协议和HTTP协议！</p> <p>Tomcat既然需要处理请求，那么肯定需要先接收到这个请求，接收请求这个东西我们首先就需要看一下Connector！</p> <h3 id="connector架构分析"><a href="#connector架构分析" class="header-anchor">#</a> Connector架构分析</h3> <p>Connector用于接受请求并将请求封装成Request和Response，然后交给Container进行处理，Container处理完之后在交给Connector返回给客户端。 因此，我们可以把Connector分为四个方面进行理解：</p> <ol><li>Connector如何接受请求的？</li> <li>如何将请求封装成Request和Response的？</li> <li>封装完之后的Request和Response如何交给Container进行处理的？</li> <li>Container处理完之后如何交给Connector并返回给客户端的？ 首先看一下Connector的结构图，如下所示：</li></ol> <p><svg id="SvgjsSvg1748" width="681.9914245605469" height="405" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1749"><marker id="SvgjsMarker1811" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1812" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1815" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1816" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1819" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1820" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1823" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1824" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1827" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1828" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1750" width="681.9914245605469" height="405" fill="#ffffff"></rect><g id="SvgjsG1751" transform="translate(25.002838134765625,69.00285339355469)"><path id="SvgjsPath1752" d="M 0 0L 50 0L 50 50L 0 50Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1753"><text id="SvgjsText1754" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="30px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1755" dy="16" x="25"><tspan id="SvgjsTspan1756">req</tspan></tspan><tspan id="SvgjsTspan1757" dy="16" x="25"><tspan id="SvgjsTspan1758">请求</tspan></tspan></text></g></g><g id="SvgjsG1759" transform="translate(98.00283813476562,25.002853393554688)"><path id="SvgjsPath1760" d="M 0 4Q 0 0 4 0L 452 0Q 456 0 456 4L 456 352Q 456 356 452 356L 4 356Q 0 356 0 352Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1761"><text id="SvgjsText1762" font-family="微软雅黑" text-anchor="start" font-size="13px" width="436px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1763" dy="16" x="10"><tspan id="SvgjsTspan1764">Connector</tspan></tspan></text></g></g><g id="SvgjsG1765" transform="translate(118.50283813476562,53.00285339355469)"><path id="SvgjsPath1766" d="M 0 4Q 0 0 4 0L 401 0Q 405 0 405 4L 405 315Q 405 319 401 319L 4 319Q 0 319 0 315Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1767"><text id="SvgjsText1768" font-family="微软雅黑" text-anchor="start" font-size="13px" width="385px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1769" dy="16" x="10"><tspan id="SvgjsTspan1770">ProtocolHandler</tspan></tspan></text></g></g><g id="SvgjsG1771" transform="translate(155.00283813476562,93.00285339355469)"><path id="SvgjsPath1772" d="M 0 0L 93 0L 93 256L 0 256Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1773"><text id="SvgjsText1774" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="73px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1775" dy="16" x="46.5"><tspan id="SvgjsTspan1776">Endpoint</tspan></tspan></text></g></g><g id="SvgjsG1777" transform="translate(161.50283813476562,135.0028533935547)"><path id="SvgjsPath1778" d="M 0 0L 80 0L 80 40L 0 40Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1779"><text id="SvgjsText1780" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1781" dy="16" x="40"><tspan id="SvgjsTspan1782">Acceptor</tspan></tspan></text></g></g><g id="SvgjsG1783" transform="translate(161.50283813476562,215.0028533935547)"><path id="SvgjsPath1784" d="M 0 0L 80 0L 80 40L 0 40Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1785"><text id="SvgjsText1786" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1787" dy="16" x="40"><tspan id="SvgjsTspan1788">Handler</tspan></tspan></text></g></g><g id="SvgjsG1789" transform="translate(161.50283813476562,295.0028533935547)"><path id="SvgjsPath1790" d="M 0 0L 80 0L 80 40L 0 40Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1791"><text id="SvgjsText1792" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan1793" dy="16" x="40"><tspan id="SvgjsTspan1794">Async </tspan></tspan><tspan id="SvgjsTspan1795" dy="16" x="40"><tspan id="SvgjsTspan1796">Timeout</tspan></tspan></text></g></g><g id="SvgjsG1797" transform="translate(279.5028381347656,93.00285339355469)"><path id="SvgjsPath1798" d="M 0 0L 93 0L 93 256L 0 256Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1799"><text id="SvgjsText1800" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="73px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="118.875" transform="rotate(0)"><tspan id="SvgjsTspan1801" dy="16" x="46.5"><tspan id="SvgjsTspan1802">Processor</tspan></tspan></text></g></g><g id="SvgjsG1803" transform="translate(409.0028381347656,93.00285339355469)"><path id="SvgjsPath1804" d="M 0 0L 93 0L 93 256L 0 256Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1805"><text id="SvgjsText1806" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="73px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="118.875" transform="rotate(0)"><tspan id="SvgjsTspan1807" dy="16" x="46.5"><tspan id="SvgjsTspan1808">Adapter</tspan></tspan></text></g></g><g id="SvgjsG1809"><path id="SvgjsPath1810" d="M75.00283813476562 94.00285339355469L161.50283813476562 155.0028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1811)"></path></g><g id="SvgjsG1813"><path id="SvgjsPath1814" d="M201.50283813476562 175.0028533935547L201.50283813476562 215.0028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1815)"></path></g><g id="SvgjsG1817"><path id="SvgjsPath1818" d="M241.50283813476562 235.0028533935547L279.5028381347656 221.0028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1819)"></path></g><g id="SvgjsG1821"><path id="SvgjsPath1822" d="M372.5028381347656 221.0028533935547L409.0028381347656 221.0028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1823)"></path></g><g id="SvgjsG1825"><path id="SvgjsPath1826" d="M502.0028381347656 221.0028533935547L574.0028381347656 221.0028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1827)"></path></g><g id="SvgjsG1829" transform="translate(574.0028381347656,201.5028533935547)"><path id="SvgjsPath1830" d="M 0 0L 83 0L 83 39L 0 39Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1831"><text id="SvgjsText1832" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="63px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.375" transform="rotate(0)"><tspan id="SvgjsTspan1833" dy="16" x="41.5"><tspan id="SvgjsTspan1834">Container</tspan></tspan></text></g></g></svg></p> <p>Connector就是使用ProtocolHandler来处理请求的，不同的ProtocolHandler 代表不同的连接类型，比如：Http11Protocol使用的是普通Socket来连接的， Http11NioProtocol使用的是NioSocket来连接的。</p> <p>其中ProtocolHandler由包含了三个部件：Endpoint、Processor、Adapter。</p> <ol><li>Endpoint用来处理底层Socket的网络连接，Processor将Endpoint接收到的Socket封装成Request，Adapter将Request交给Container进行具体的处理。</li> <li>Endpoint由于是处理底层的Socket网络连接，因此Endpoint用来实现TCP/IP协议，而Processor用来实现HTTP协议，Adapter将请求适配到Servlet容器进行具体的处理。</li> <li>Endpoint的抽象实现AbstractEndpoint里面定义的Acceptor和 AsyncTimeout两个内部类和一个Handler接口。Acceptor用于监听请求，AsyncTimeout用于检查异步Request的超时，Handler用于处理接收到的Socket，在内部调用Processor进行处理。</li></ol> <p>至此，我们应该很轻松的回答1，2，3的问题了，但是4还是不知道，那么我们 就来看一下Container是如何进行处理的以及处理完之后是如何将处理完的结果返回给Connector的</p> <h2 id="_9-container架构分析"><a href="#_9-container架构分析" class="header-anchor">#</a> 9. Container架构分析</h2> <p>Container用于封装和管理Servlet，以及具体处理Request请求，在Container 内部包含了4个子容器，结构图如下：</p> <p><svg id="SvgjsSvg1835" width="589.0057067871094" height="333" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1836"><marker id="SvgjsMarker1888" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1889" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1900" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1901" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1920" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1921" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1837" width="589.0057067871094" height="333" fill="#ffffff"></rect><g id="SvgjsG1838" transform="translate(25.005706787109375,25.005691528320312)"><path id="SvgjsPath1839" d="M 0 4Q 0 0 4 0L 383 0Q 387 0 387 4L 387 279Q 387 283 383 283L 4 283Q 0 283 0 279Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1840"><text id="SvgjsText1841" font-family="微软雅黑" text-anchor="start" font-size="13px" width="367px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1842" dy="16" x="10"><tspan id="SvgjsTspan1843">Engine</tspan></tspan></text></g></g><g id="SvgjsG1844" transform="translate(47.005706787109375,50.00569152832031)"><path id="SvgjsPath1845" d="M 0 4Q 0 0 4 0L 299 0Q 303 0 303 4L 303 203.75816993464053Q 303 207.75816993464053 299 207.75816993464053L 4 207.75816993464053Q 0 207.75816993464053 0 203.75816993464053Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1846"><text id="SvgjsText1847" font-family="微软雅黑" text-anchor="start" font-size="13px" width="283px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1848" dy="16" x="10"><tspan id="SvgjsTspan1849">Host</tspan></tspan></text></g></g><g id="SvgjsG1850" transform="translate(67.00570678710938,65.62660656100005)"><path id="SvgjsPath1851" d="M 0 4Q 0 0 4 0L 299 0Q 303 0 303 4L 303 203.75816993464053Q 303 207.75816993464053 299 207.75816993464053L 4 207.75816993464053Q 0 207.75816993464053 0 203.75816993464053Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1852"><text id="SvgjsText1853" font-family="微软雅黑" text-anchor="start" font-size="13px" width="283px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1854" dy="16" x="10"><tspan id="SvgjsTspan1855">Host</tspan></tspan></text></g></g><g id="SvgjsG1856" transform="translate(87.00570678710938,81.24752159367979)"><path id="SvgjsPath1857" d="M 0 4Q 0 0 4 0L 299 0Q 303 0 303 4L 303 203.75816993464053Q 303 207.75816993464053 299 207.75816993464053L 4 207.75816993464053Q 0 207.75816993464053 0 203.75816993464053Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1858"><text id="SvgjsText1859" font-family="微软雅黑" text-anchor="start" font-size="13px" width="283px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1860" dy="16" x="10"><tspan id="SvgjsTspan1861">Host</tspan></tspan></text></g></g><g id="SvgjsG1862" transform="translate(107.00570678710938,110.00569152832031)"><path id="SvgjsPath1863" d="M 0 4Q 0 0 4 0L 219 0Q 223 0 223 4L 223 115Q 223 119 219 119L 4 119Q 0 119 0 115Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1864"><text id="SvgjsText1865" font-family="微软雅黑" text-anchor="start" font-size="13px" width="203px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1866" dy="16" x="10"><tspan id="SvgjsTspan1867">Context</tspan></tspan></text></g></g><g id="SvgjsG1868" transform="translate(127.00570678710938,130.0056915283203)"><path id="SvgjsPath1869" d="M 0 4Q 0 0 4 0L 219 0Q 223 0 223 4L 223 115Q 223 119 219 119L 4 119Q 0 119 0 115Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1870"><text id="SvgjsText1871" font-family="微软雅黑" text-anchor="start" font-size="13px" width="203px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1872" dy="16" x="10"><tspan id="SvgjsTspan1873">Context</tspan></tspan></text></g></g><g id="SvgjsG1874" transform="translate(147.00570678710938,151.5056915283203)"><path id="SvgjsPath1875" d="M 0 4Q 0 0 4 0L 219 0Q 223 0 223 4L 223 115Q 223 119 219 119L 4 119Q 0 119 0 115Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1876"><text id="SvgjsText1877" font-family="微软雅黑" text-anchor="start" font-size="13px" width="203px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1878" dy="16" x="10"><tspan id="SvgjsTspan1879">Context</tspan></tspan></text></g></g><g id="SvgjsG1880" transform="translate(177.00570678710938,184.0056915283203)"><path id="SvgjsPath1881" d="M 0 14L 10 14L 10 7L 20 7L 20 0L 100 0L 100 49L 90 49L 90 56L 80 56L 80 63Q 60 56 40 63Q 20 70 0 63L 0 14M 0 14L 80 14L 80 63Q 60 56 40 63Q 20 70 0 63L 0 14M 10 14L 10 7L 90 7L 90 56L 80 56L 80 14" stroke="rgba(11,108,195,1)" stroke-width="2" fill="none"></path><g id="SvgjsG1882"><text id="SvgjsText1883" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="32.875" transform="rotate(0)"><tspan id="SvgjsTspan1884" dy="16" x="40"><tspan id="SvgjsTspan1885">Wrapper</tspan></tspan></text></g></g><g id="SvgjsG1886"><path id="SvgjsPath1887" d="M105.00570678710938 66.00569152832031L444.0057067871094 50.00569152832031" stroke-dasharray="8,5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1888)"></path></g><g id="SvgjsG1890" transform="translate(444.0057067871094,30.005691528320312)"><path id="SvgjsPath1891" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1892"><text id="SvgjsText1893" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan1894" dy="16" x="60"><tspan id="SvgjsTspan1895">每个Host代表一个</tspan></tspan><tspan id="SvgjsTspan1896" dy="16" x="60"><tspan id="SvgjsTspan1897">虚拟主机</tspan></tspan></text></g></g><g id="SvgjsG1898"><path id="SvgjsPath1899" d="M176.00570678710938 130.0056915283203L444.0057067871094 110.00569152832031" stroke-dasharray="8,5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1900)"></path></g><g id="SvgjsG1902" transform="translate(444.0057067871094,90.00569152832031)"><path id="SvgjsPath1903" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1904"><text id="SvgjsText1905" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan1906" dy="16" x="60"><tspan id="SvgjsTspan1907">每个Context代表一</tspan></tspan><tspan id="SvgjsTspan1908" dy="16" x="60"><tspan id="SvgjsTspan1909">个应用</tspan></tspan></text></g></g><g id="SvgjsG1910" transform="translate(444.0057067871094,165.12660656100007)"><path id="SvgjsPath1911" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1912"><text id="SvgjsText1913" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan1914" dy="16" x="60"><tspan id="SvgjsTspan1915">每个Wrapper封装着</tspan></tspan><tspan id="SvgjsTspan1916" dy="16" x="60"><tspan id="SvgjsTspan1917">一个Servlet</tspan></tspan></text></g></g><g id="SvgjsG1918"><path id="SvgjsPath1919" d="M277.0057067871094 219.0056915283203L444.0057067871094 185.12660656100007" stroke-dasharray="8,5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1920)"></path></g></svg></p> <p>4个子容器的作用分别是：</p> <ol><li>Engine：引擎，用来管理多个站点，一个Service只有一个Engine</li> <li>Host：代表一个站点，也可以叫虚拟主机，通过配置Host就可以添加站点</li> <li>Context：代表一个应用程序, 对应着平时开发的一套程序, 或者一个WEB-INF目录以及下面的web.xml文件</li> <li>Wrapper：每一Wrapper封装着一个Servlet</li></ol> <p>下面找一个Tomcat的文件目录对照一下, 如下图所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>|- Apache-tomcat-8.0.32
  |- bin
  |- conf
  |- ...
  |- webapps  ------------------ 代表一个Host
    |- docs	  -----------\
    |- examples   ---------\
    |- host-manager  -------|
    |- manager  ------------|
    |- ROOT   ---------- 代表一个Context
  |- work
  |- LICENSE...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Context和Host的区别是Context表示一个应用, 我们的Tomcat中默认的配置下webapps下的每一个文件夹目录都是一个Context, 其中ROOT目录中存放着主应用, 其他目录存放着子应用, 而整个webapps就是一个Host站点。</p> <p>我们访问应用Context的时候，如果是ROOT下的则直接使用域名就可以访问， 例如：www.baidu.com，如果是Host（webapps）下的其他应用，则可以使用www.baidu.com/docs进行访问，当然默认指定的根应用（ROOT）是可以进行设定的，只不过Host站点下默认的主应用是ROOT目录下的。</p> <p>看到这里我们知道Container是什么，但是还是不知道Container是如何进行请 求处理的以及处理完之后是如何将处理完的结果返回给Connector的？别急！下边就开始探讨一下Container是如何进行处理的！</p> <h2 id="_10-container如何处理请求的"><a href="#_10-container如何处理请求的" class="header-anchor">#</a> 10. Container如何处理请求的</h2> <p>Container处理请求是使用Pipeline-Valve管道来处理的！(Valve--阀门)</p> <p>Pipeline-Valve使用<strong>责任链模式</strong>，责任链模式是指在一个请求处理的过程中有很多处理者依次对请求进行处理，每个处理者负责做自己相应的处理，处理完之后将处理后的结果返回，再让下一个处理者继续处理。</p> <p>但是Pipeline-Valve和普通的责任链模式有些不同！区别主要以下两点：</p> <p>每个Pipeline都有特定的Valve，而且是在管道的最后一个执行，这个Valve叫做BaseValve，它是不可删除的,在上层容器的管道的BaseValve中会调用下层容器的管道。</p> <p>我们知道Container包含四个子容器，而这四个子容器对应的BaseValve分别在：StandardEngineValve、StandardHostValve、StandardContextValve、 StandardWrapperValve。</p> <p>Pipeline的处理流程图如下：</p> <p><svg id="SvgjsSvg1922" width="569.0056762695312" height="340.9943084716797" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1923"><marker id="SvgjsMarker1951" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1952" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1955" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1956" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1987" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1988" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1991" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1992" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2023" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2024" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2027" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2028" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2059" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2060" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2063" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2064" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2071" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2072" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2075" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2076" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker2079" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath2080" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1924" width="569.0056762695312" height="340.9943084716797" fill="#ffffff"></rect><g id="SvgjsG1925" transform="translate(49.011383056640625,25.002853393554688)"><path id="SvgjsPath1926" d="M 0 0L 469 0L 469 57L 0 57Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1927"><text id="SvgjsText1928" font-family="微软雅黑" text-anchor="start" font-size="13px" width="449px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1929" dy="16" x="10"><tspan id="SvgjsTspan1930">EnginePipeLine</tspan></tspan></text></g></g><g id="SvgjsG1931" transform="translate(55.011383056640625,45.00285339355469)"><path id="SvgjsPath1932" d="M 0 0L 108 0L 108 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1933"><text id="SvgjsText1934" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="88px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan1935" dy="16" x="54"><tspan id="SvgjsTspan1936">EngineValve1</tspan></tspan></text></g></g><g id="SvgjsG1937" transform="translate(194.01138305664062,45.00285339355469)"><path id="SvgjsPath1938" d="M 0 0L 108 0L 108 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1939"><text id="SvgjsText1940" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="88px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan1941" dy="16" x="54"><tspan id="SvgjsTspan1942">EngineValve2</tspan></tspan></text></g></g><g id="SvgjsG1943" transform="translate(355.0113830566406,45.00285339355469)"><path id="SvgjsPath1944" d="M 0 0L 154 0L 154 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1945"><text id="SvgjsText1946" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="134px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan1947" dy="16" x="77"><tspan id="SvgjsTspan1948">StandardEngineValve</tspan></tspan></text></g></g><g id="SvgjsG1949"><path id="SvgjsPath1950" d="M163.01138305664062 60.50285339355469L194.01138305664062 60.50285339355469" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1951)"></path></g><g id="SvgjsG1953"><path id="SvgjsPath1954" d="M302.0113830566406 60.50285339355469L355.0113830566406 60.50285339355469" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1955)"></path><rect id="SvgjsRect1957" width="19" height="15" x="319.0113830566406" y="53.00285339355469" fill="#ffffff"></rect><text id="SvgjsText1958" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="19px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="51.37785339355469" transform="rotate(0)"><tspan id="SvgjsTspan1959" dy="16" x="328.5113830566406"><tspan id="SvgjsTspan1960">......</tspan></tspan></text></g><g id="SvgjsG1961" transform="translate(49.011383056640625,104.00285339355469)"><path id="SvgjsPath1962" d="M 0 0L 469 0L 469 57L 0 57Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1963"><text id="SvgjsText1964" font-family="微软雅黑" text-anchor="start" font-size="13px" width="449px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1965" dy="16" x="10"><tspan id="SvgjsTspan1966">HostPipeLine</tspan></tspan></text></g></g><g id="SvgjsG1967" transform="translate(55.011383056640625,124.00285339355469)"><path id="SvgjsPath1968" d="M 0 0L 108 0L 108 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1969"><text id="SvgjsText1970" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="88px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan1971" dy="16" x="54"><tspan id="SvgjsTspan1972">HostValve1</tspan></tspan></text></g></g><g id="SvgjsG1973" transform="translate(194.01138305664062,124.00285339355469)"><path id="SvgjsPath1974" d="M 0 0L 108 0L 108 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1975"><text id="SvgjsText1976" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="88px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan1977" dy="16" x="54"><tspan id="SvgjsTspan1978">HostValve2</tspan></tspan></text></g></g><g id="SvgjsG1979" transform="translate(355.0113830566406,124.00285339355469)"><path id="SvgjsPath1980" d="M 0 0L 154 0L 154 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1981"><text id="SvgjsText1982" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="134px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan1983" dy="16" x="77"><tspan id="SvgjsTspan1984">StandardHostValve</tspan></tspan></text></g></g><g id="SvgjsG1985"><path id="SvgjsPath1986" d="M163.01138305664062 139.5028533935547L194.01138305664062 139.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1987)"></path></g><g id="SvgjsG1989"><path id="SvgjsPath1990" d="M302.0113830566406 139.5028533935547L355.0113830566406 139.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1991)"></path><rect id="SvgjsRect1993" width="19" height="15" x="319.0113830566406" y="132.0028533935547" fill="#ffffff"></rect><text id="SvgjsText1994" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="19px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="130.3778533935547" transform="rotate(0)"><tspan id="SvgjsTspan1995" dy="16" x="328.5113830566406"><tspan id="SvgjsTspan1996">......</tspan></tspan></text></g><g id="SvgjsG1997" transform="translate(49.011383056640625,181.0028533935547)"><path id="SvgjsPath1998" d="M 0 0L 469 0L 469 57L 0 57Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1999"><text id="SvgjsText2000" font-family="微软雅黑" text-anchor="start" font-size="13px" width="449px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan2001" dy="16" x="10"><tspan id="SvgjsTspan2002">ContextPipeLine</tspan></tspan></text></g></g><g id="SvgjsG2003" transform="translate(55.011383056640625,201.0028533935547)"><path id="SvgjsPath2004" d="M 0 0L 114 0L 114 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2005"><text id="SvgjsText2006" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="94px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan2007" dy="16" x="57"><tspan id="SvgjsTspan2008">ContextValve1</tspan></tspan></text></g></g><g id="SvgjsG2009" transform="translate(194.01138305664062,201.0028533935547)"><path id="SvgjsPath2010" d="M 0 0L 113 0L 113 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2011"><text id="SvgjsText2012" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="93px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan2013" dy="16" x="56.5"><tspan id="SvgjsTspan2014">ContextValve2</tspan></tspan></text></g></g><g id="SvgjsG2015" transform="translate(355.0113830566406,201.0028533935547)"><path id="SvgjsPath2016" d="M 0 0L 159 0L 159 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2017"><text id="SvgjsText2018" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="139px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan2019" dy="16" x="79.5"><tspan id="SvgjsTspan2020">StandardContextValve</tspan></tspan></text></g></g><g id="SvgjsG2021"><path id="SvgjsPath2022" d="M169.01138305664062 216.5028533935547L194.01138305664062 216.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2023)"></path></g><g id="SvgjsG2025"><path id="SvgjsPath2026" d="M307.0113830566406 216.5028533935547L355.0113830566406 216.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2027)"></path><rect id="SvgjsRect2029" width="19" height="15" x="321.5113830566406" y="209.0028533935547" fill="#ffffff"></rect><text id="SvgjsText2030" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="19px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="207.3778533935547" transform="rotate(0)"><tspan id="SvgjsTspan2031" dy="16" x="331.0113830566406"><tspan id="SvgjsTspan2032">......</tspan></tspan></text></g><g id="SvgjsG2033" transform="translate(49.011383056640625,261.0028533935547)"><path id="SvgjsPath2034" d="M 0 0L 495 0L 495 56L 0 56Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2035"><text id="SvgjsText2036" font-family="微软雅黑" text-anchor="start" font-size="13px" width="475px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan2037" dy="16" x="10"><tspan id="SvgjsTspan2038">WrapperPipeLine</tspan></tspan></text></g></g><g id="SvgjsG2039" transform="translate(55.011383056640625,281.0028533935547)"><path id="SvgjsPath2040" d="M 0 0L 120 0L 120 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2041"><text id="SvgjsText2042" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="100px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan2043" dy="16" x="60"><tspan id="SvgjsTspan2044">WrapperValve1</tspan></tspan></text></g></g><g id="SvgjsG2045" transform="translate(194.01138305664062,281.0028533935547)"><path id="SvgjsPath2046" d="M 0 0L 119 0L 119 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2047"><text id="SvgjsText2048" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="99px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan2049" dy="16" x="59.5"><tspan id="SvgjsTspan2050">WrapperValve2</tspan></tspan></text></g></g><g id="SvgjsG2051" transform="translate(370.0113830566406,281.0028533935547)"><path id="SvgjsPath2052" d="M 0 0L 167 0L 167 31L 0 31Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG2053"><text id="SvgjsText2054" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="147px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.375" transform="rotate(0)"><tspan id="SvgjsTspan2055" dy="16" x="83.5"><tspan id="SvgjsTspan2056">StandardWrapperValve</tspan></tspan></text></g></g><g id="SvgjsG2057"><path id="SvgjsPath2058" d="M175.01138305664062 296.5028533935547L194.01138305664062 296.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2059)"></path></g><g id="SvgjsG2061"><path id="SvgjsPath2062" d="M313.0113830566406 296.5028533935547L370.0113830566406 296.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2063)"></path><rect id="SvgjsRect2065" width="19" height="15" x="332.0113830566406" y="289.0028533935547" fill="#ffffff"></rect><text id="SvgjsText2066" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="19px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="287.3778533935547" transform="rotate(0)"><tspan id="SvgjsTspan2067" dy="16" x="341.5113830566406"><tspan id="SvgjsTspan2068">......</tspan></tspan></text></g><g id="SvgjsG2069"><path id="SvgjsPath2070" d="M509.0113830566406 60.50285339355469L539.0113830566406 60.50285339355469L539.0113830566406 91.00285339355469L25.011383056640625 91.00285339355469L25.011383056640625 139.5028533935547L55.011383056640625 139.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2071)"></path></g><g id="SvgjsG2073"><path id="SvgjsPath2074" d="M509.0113830566406 139.5028533935547L539.0113830566406 139.5028533935547L539.0113830566406 171.0028533935547L25.011383056640625 171.0028533935547L25.011383056640625 216.5028533935547L55.011383056640625 216.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2075)"></path></g><g id="SvgjsG2077"><path id="SvgjsPath2078" d="M514.0113830566406 216.5028533935547L544.0113830566406 216.5028533935547L544.0113830566406 249.5028533935547L25.011383056640625 249.5028533935547L25.011383056640625 296.5028533935547L55.011383056640625 296.5028533935547" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker2079)"></path></g></svg></p> <ul><li>Connector在接收到请求后会首先调用最顶层容器的Pipeline来处理，这里的最顶层容器的Pipeline就是EnginePipeline(Engine的管道)</li> <li>在Engine的管道中依次会执行EngineValve1、EngineValve2等等， 最后会执行StandardEngineValve，在StandardEngineValve中会调用 Host管道，然后再依次执行Host的HostValve1、HostValve2等，最后在执行StandardHostValve，然后再依次调用Context的管道和Wrapper的管道，最后执行StandardWrapperValve。</li> <li>当执行到StandardWrapperValve的时候，会在 StandardWrapperValve中创建FilterChain，并调用其doFilter方法来处理请求，这个FilterChain包含着我们配置的与请求相匹配的Filter和Servlet，其doFilter方法会依次调用所有的Filter的doFilter方法和Servlet的service方法，这样请求就得到了处理！</li> <li>当所有的Pipeline-Valve都执行完之后，并且处理完了具体的请求， 这个时候就可以将返回的结果交给Connector，Connector再通过Socket的方式将结果返回给客户端。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/24/2021, 8:31:13 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.42575a28.js" defer></script><script src="/assets/js/2.0d7d09b8.js" defer></script><script src="/assets/js/117.f7cb9e2a.js" defer></script>
  </body>
</html>
