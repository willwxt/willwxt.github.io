<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>为什么使用MQ？MQ的优点 | SUCKED BloG</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.42575a28.js" as="script"><link rel="preload" href="/assets/js/2.0d7d09b8.js" as="script"><link rel="preload" href="/assets/js/122.dcd4190d.js" as="script"><link rel="prefetch" href="/assets/js/10.1a30ebe5.js"><link rel="prefetch" href="/assets/js/100.022f696a.js"><link rel="prefetch" href="/assets/js/101.06eb0acb.js"><link rel="prefetch" href="/assets/js/102.e944c220.js"><link rel="prefetch" href="/assets/js/103.45b9da9a.js"><link rel="prefetch" href="/assets/js/104.cf53f5d1.js"><link rel="prefetch" href="/assets/js/105.200d7fe5.js"><link rel="prefetch" href="/assets/js/106.a0cc3502.js"><link rel="prefetch" href="/assets/js/107.4a71d17e.js"><link rel="prefetch" href="/assets/js/108.d7a39a75.js"><link rel="prefetch" href="/assets/js/109.35619cf9.js"><link rel="prefetch" href="/assets/js/11.f78ae8b3.js"><link rel="prefetch" href="/assets/js/110.f667d72e.js"><link rel="prefetch" href="/assets/js/111.de83ce6f.js"><link rel="prefetch" href="/assets/js/112.417d40bf.js"><link rel="prefetch" href="/assets/js/113.0f26c1ca.js"><link rel="prefetch" href="/assets/js/114.c7014acb.js"><link rel="prefetch" href="/assets/js/115.b502c0f1.js"><link rel="prefetch" href="/assets/js/116.10fb230e.js"><link rel="prefetch" href="/assets/js/117.f7cb9e2a.js"><link rel="prefetch" href="/assets/js/118.978d3075.js"><link rel="prefetch" href="/assets/js/119.09272191.js"><link rel="prefetch" href="/assets/js/12.140aa2af.js"><link rel="prefetch" href="/assets/js/120.32b5dbd7.js"><link rel="prefetch" href="/assets/js/121.8d618bbb.js"><link rel="prefetch" href="/assets/js/123.2ee061d1.js"><link rel="prefetch" href="/assets/js/124.5a3760a7.js"><link rel="prefetch" href="/assets/js/125.a874a4bc.js"><link rel="prefetch" href="/assets/js/126.c6c6b7e6.js"><link rel="prefetch" href="/assets/js/127.38c35051.js"><link rel="prefetch" href="/assets/js/128.8d775ac8.js"><link rel="prefetch" href="/assets/js/129.6100ddb1.js"><link rel="prefetch" href="/assets/js/13.b2a6e590.js"><link rel="prefetch" href="/assets/js/130.9a83da2a.js"><link rel="prefetch" href="/assets/js/131.22de7670.js"><link rel="prefetch" href="/assets/js/132.f88798bf.js"><link rel="prefetch" href="/assets/js/133.925bbfed.js"><link rel="prefetch" href="/assets/js/134.481fad71.js"><link rel="prefetch" href="/assets/js/135.c3efb09b.js"><link rel="prefetch" href="/assets/js/136.758c447a.js"><link rel="prefetch" href="/assets/js/137.dcde1032.js"><link rel="prefetch" href="/assets/js/138.616a346b.js"><link rel="prefetch" href="/assets/js/139.b58dd07f.js"><link rel="prefetch" href="/assets/js/14.15374560.js"><link rel="prefetch" href="/assets/js/140.62b4c7ea.js"><link rel="prefetch" href="/assets/js/15.ffd155fa.js"><link rel="prefetch" href="/assets/js/16.feb1b022.js"><link rel="prefetch" href="/assets/js/17.6d491eb6.js"><link rel="prefetch" href="/assets/js/18.03ddaa95.js"><link rel="prefetch" href="/assets/js/19.021bbcc8.js"><link rel="prefetch" href="/assets/js/20.8aa708b0.js"><link rel="prefetch" href="/assets/js/21.59d7a21e.js"><link rel="prefetch" href="/assets/js/22.21597439.js"><link rel="prefetch" href="/assets/js/23.77303f0b.js"><link rel="prefetch" href="/assets/js/24.0789ed5b.js"><link rel="prefetch" href="/assets/js/25.244a12a8.js"><link rel="prefetch" href="/assets/js/26.a6ee95e4.js"><link rel="prefetch" href="/assets/js/27.9e0f0e9d.js"><link rel="prefetch" href="/assets/js/28.189031c5.js"><link rel="prefetch" href="/assets/js/29.b3100d33.js"><link rel="prefetch" href="/assets/js/3.2a5d4cd5.js"><link rel="prefetch" href="/assets/js/30.fe8fe8c0.js"><link rel="prefetch" href="/assets/js/31.86fec3f7.js"><link rel="prefetch" href="/assets/js/32.24cac061.js"><link rel="prefetch" href="/assets/js/33.f1db2ed0.js"><link rel="prefetch" href="/assets/js/34.c220692f.js"><link rel="prefetch" href="/assets/js/35.9e7b4779.js"><link rel="prefetch" href="/assets/js/36.0cb1d1bc.js"><link rel="prefetch" href="/assets/js/37.7d1fcf79.js"><link rel="prefetch" href="/assets/js/38.bc9bc4b3.js"><link rel="prefetch" href="/assets/js/39.10801a2a.js"><link rel="prefetch" href="/assets/js/4.b4d9a5aa.js"><link rel="prefetch" href="/assets/js/40.c980543d.js"><link rel="prefetch" href="/assets/js/41.3f4581d8.js"><link rel="prefetch" href="/assets/js/42.60b85cdf.js"><link rel="prefetch" href="/assets/js/43.1338528d.js"><link rel="prefetch" href="/assets/js/44.786fc51f.js"><link rel="prefetch" href="/assets/js/45.d65f6744.js"><link rel="prefetch" href="/assets/js/46.543c2b26.js"><link rel="prefetch" href="/assets/js/47.59f19ed2.js"><link rel="prefetch" href="/assets/js/48.60de6b25.js"><link rel="prefetch" href="/assets/js/49.f3df62ef.js"><link rel="prefetch" href="/assets/js/5.013522c1.js"><link rel="prefetch" href="/assets/js/50.fd9871d6.js"><link rel="prefetch" href="/assets/js/51.1fb1863e.js"><link rel="prefetch" href="/assets/js/52.c06ce3f3.js"><link rel="prefetch" href="/assets/js/53.a3d55203.js"><link rel="prefetch" href="/assets/js/54.89ac64bc.js"><link rel="prefetch" href="/assets/js/55.ccf38d1e.js"><link rel="prefetch" href="/assets/js/56.ffb8595b.js"><link rel="prefetch" href="/assets/js/57.5f1bd695.js"><link rel="prefetch" href="/assets/js/58.7463616d.js"><link rel="prefetch" href="/assets/js/59.ea4eb5dd.js"><link rel="prefetch" href="/assets/js/6.72ad7c85.js"><link rel="prefetch" href="/assets/js/60.a2add219.js"><link rel="prefetch" href="/assets/js/61.3eae0362.js"><link rel="prefetch" href="/assets/js/62.801d1658.js"><link rel="prefetch" href="/assets/js/63.b47a17bb.js"><link rel="prefetch" href="/assets/js/64.d5e2bdea.js"><link rel="prefetch" href="/assets/js/65.24d540f4.js"><link rel="prefetch" href="/assets/js/66.09a1ae52.js"><link rel="prefetch" href="/assets/js/67.75bd38e7.js"><link rel="prefetch" href="/assets/js/68.1fe6956e.js"><link rel="prefetch" href="/assets/js/69.d3306c2d.js"><link rel="prefetch" href="/assets/js/7.60760bb7.js"><link rel="prefetch" href="/assets/js/70.95aa4503.js"><link rel="prefetch" href="/assets/js/71.7065ebf0.js"><link rel="prefetch" href="/assets/js/72.55ae5081.js"><link rel="prefetch" href="/assets/js/73.c7624eee.js"><link rel="prefetch" href="/assets/js/74.63bcc7bd.js"><link rel="prefetch" href="/assets/js/75.e2731e20.js"><link rel="prefetch" href="/assets/js/76.1711af80.js"><link rel="prefetch" href="/assets/js/77.f1c4e2d3.js"><link rel="prefetch" href="/assets/js/78.900bc856.js"><link rel="prefetch" href="/assets/js/79.a1b8c47b.js"><link rel="prefetch" href="/assets/js/8.0c261cf2.js"><link rel="prefetch" href="/assets/js/80.7cf435bf.js"><link rel="prefetch" href="/assets/js/81.fa33b2af.js"><link rel="prefetch" href="/assets/js/82.cdabd386.js"><link rel="prefetch" href="/assets/js/83.879fc50c.js"><link rel="prefetch" href="/assets/js/84.7e460788.js"><link rel="prefetch" href="/assets/js/85.339356d5.js"><link rel="prefetch" href="/assets/js/86.d526418c.js"><link rel="prefetch" href="/assets/js/87.12877e38.js"><link rel="prefetch" href="/assets/js/88.d5a7d193.js"><link rel="prefetch" href="/assets/js/89.2f4a62c2.js"><link rel="prefetch" href="/assets/js/9.50eda380.js"><link rel="prefetch" href="/assets/js/90.6d83f5bf.js"><link rel="prefetch" href="/assets/js/91.f3364825.js"><link rel="prefetch" href="/assets/js/92.158fcc7a.js"><link rel="prefetch" href="/assets/js/93.0c4e5f88.js"><link rel="prefetch" href="/assets/js/94.c5725f80.js"><link rel="prefetch" href="/assets/js/95.dc61d501.js"><link rel="prefetch" href="/assets/js/96.3a598fc5.js"><link rel="prefetch" href="/assets/js/97.712aa8be.js"><link rel="prefetch" href="/assets/js/98.e757fe7a.js"><link rel="prefetch" href="/assets/js/99.1418024a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SUCKED BloG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>为什么使用MQ？MQ的优点</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/question/mashibing/15-MQ.html#为什么使用mq-mq的优点" class="sidebar-link">为什么使用MQ？MQ的优点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#简答" class="sidebar-link">简答</a></li><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#详答" class="sidebar-link">详答</a></li></ul></li><li><a href="/question/mashibing/15-MQ.html#消息队列有什么优缺点-rabbitmq有什么优缺点" class="sidebar-link">消息队列有什么优缺点？RabbitMQ有什么优缺点？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#你们公司生产环境用的是什么消息中间件" class="sidebar-link">你们公司生产环境用的是什么消息中间件？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#kafka、activemq、rabbitmq、rocketmq-有-什么优缺点" class="sidebar-link">Kafka、ActiveMQ、RabbitMQ、RocketMQ 有 什么优缺点？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#mq-有哪些常见问题-如何解决这些问题" class="sidebar-link">MQ 有哪些常见问题？如何解决这些问题？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#什么是rabbitmq" class="sidebar-link">什么是RabbitMQ？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#rabbitmq-的使用场景" class="sidebar-link">Rabbitmq 的使用场景</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#rabbitmq基本概念" class="sidebar-link">RabbitMQ基本概念</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/mashibing/15-MQ.html#rabbitmq的工作模式" class="sidebar-link">RabbitMQ的工作模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#一-simple模式-即最简单的收发模式" class="sidebar-link">一.simple模式（即最简单的收发模式）</a></li><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#二-work工作模式-资源的竞争" class="sidebar-link">二.work工作模式(资源的竞争)</a></li><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#三-publish-subscribe发布订阅-共享资源" class="sidebar-link">三.publish/subscribe发布订阅(共享资源)</a></li><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#四-routing路由模式" class="sidebar-link">四.routing路由模式</a></li><li class="sidebar-sub-header"><a href="/question/mashibing/15-MQ.html#五-topic-主题模式-路由模式的一种" class="sidebar-link">五.topic 主题模式(路由模式的一种)</a></li></ul></li><li><a href="/question/mashibing/15-MQ.html#如何保证rabbitmq消息的顺序性" class="sidebar-link">如何保证RabbitMQ消息的顺序性？</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="为什么使用mq-mq的优点"><a href="#为什么使用mq-mq的优点" class="header-anchor">#</a> 为什么使用MQ？MQ的优点</h2> <h3 id="简答"><a href="#简答" class="header-anchor">#</a> 简答</h3> <ul><li>异步处理 - 相比于传统的串行、并行方式，提高了系统吞吐量。</li> <li>应用解耦 - 系统间通过消息通信，不用关心其他系统的处理。</li> <li>流量削锋 - 可以通过消息队列长度控制请求量；可以缓解短时间内的高并发请 求。</li> <li>日志处理 - 解决大量日志传输。</li> <li>消息通讯 - 消息队列一般都内置了高效的通信机制，因此也可以用在纯的消息通 讯。比如实现点对点消息队列，或者聊天室等。</li></ul> <h3 id="详答"><a href="#详答" class="header-anchor">#</a> 详答</h3> <p>主要是：解耦、异步、削峰。</p> <p>**解耦：**A 系统发送数据到 BCD 三个系统，通过接口调用发送。如果 E 系统也要 这个数据呢？那如果 C 系统现在不需要了呢？A 系统负责人几乎崩溃…A 系统 跟其它各种乱七八糟的系统严重耦合，A 系统产生一条比较关键的数据，很多系 统都需要 A 系统将这个数据发送过来。如果使用 MQ，A 系统产生一条数据， 发送到 MQ 里面去，哪个系统需要数据自己去 MQ 里面消费。如果新系统需要 数据，直接从 MQ 里消费即可；如果某个系统不需要这条数据了，就取消对  MQ 消息的消费即可。这样下来，A 系统压根儿不需要去考虑要给谁发送数 据，不需要维护这个代码，也不需要考虑人家是否调用成功、失败超时等情况。 就是一个系统或者一个模块，调用了多个系统或者模块，互相之间的调用很复 杂，维护起来很麻烦。但是其实这个调用是不需要直接同步调用接口的，如果用  MQ 给它异步化解耦。</p> <p>**异步：**A 系统接收一个请求，需要在自己本地写库，还需要在 BCD 三个系统写 库，自己本地写库要 3ms，BCD 三个系统分别写库要 300ms、450ms、 200ms。最终请求总延时是 3 + 300 + 450 + 200 = 953ms，接近 1s，用户 感觉搞个什么东西，慢死了慢死了。用户通过浏览器发起请求。如果使用  MQ，那么 A 系统连续发送 3 条消息到 MQ 队列中，假如耗时 5ms，A 系统从 接受一个请求到返回响应给用户，总时长是 3 + 5 = 8ms。</p> <p>**削峰：**减少高峰时期对服务器压力。</p> <h2 id="消息队列有什么优缺点-rabbitmq有什么优缺点"><a href="#消息队列有什么优缺点-rabbitmq有什么优缺点" class="header-anchor">#</a> 消息队列有什么优缺点？RabbitMQ有什么优缺点？</h2> <p>优点上面已经说了，就是**在特殊场景下有其对应的好处，解耦、异步、削峰。 **</p> <p>缺点有以下几个：</p> <p>系统可用性降低</p> <p>本来系统运行好好的，现在你非要加入个消息队列进去，那消息队列挂了，你的 系统不是呵呵了。因此，系统可用性会降低；</p> <p>系统复杂度提高</p> <p>加入了消息队列，要多考虑很多方面的问题，比如：一致性问题、如何保证消息 不被重复消费、如何保证消息可靠性传输等。因此，需要考虑的东西更多，复杂 性增大。</p> <p>一致性问题</p> <p>A 系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是， 要是 BCD 三个系统那里，BD 两个系统写库成功了，结果 C 系统写库失败了， 咋整？你这数据就不一致了。</p> <p>所以消息队列实际是一种非常复杂的架构，你引入它有很多好处，但是也得针对 它带来的坏处做各种额外的技术方案和架构来规避掉，做好之后，你会发现，妈 呀，系统复杂度提升了一个数量级，也许是复杂了 10 倍。但是关键时刻，用， 还是得用的。</p> <h2 id="你们公司生产环境用的是什么消息中间件"><a href="#你们公司生产环境用的是什么消息中间件" class="header-anchor">#</a> 你们公司生产环境用的是什么消息中间件？</h2> <p>这个首先你可以说下你们公司选用的是什么消息中间件，比如用的是 RabbitMQ，然后可以初步给一些你对不同MQ中间件技术的选型分析。</p> <p>举个例子：比如说ActiveMQ是老牌的消息中间件，国内很多公司过去运用的还 是非常广泛的，功能很强大。</p> <p>但是问题在于没法确认ActiveMQ可以支撑互联网公司的高并发、高负载以及高 吞吐的复杂场景，在国内互联网公司落地较少。而且使用较多的是一些传统企 业，用ActiveMQ做异步调用和系统解耦。</p> <p>然后你可以说说RabbitMQ，他的好处在于可以支撑高并发、高吞吐、性能很 高，同时有非常完善便捷的后台管理界面可以使用。</p> <p>另外，他还支持集群化、高可用部署架构、消息高可靠支持，功能较为完善。</p> <p>而且经过调研，国内各大互联网公司落地大规模RabbitMQ集群支撑自身业务的 case较多，国内各种中小型互联网公司使用RabbitMQ的实践也比较多。</p> <p>除此之外，RabbitMQ的开源社区很活跃，较高频率的迭代版本，来修复发现的 bug以及进行各种优化，因此综合考虑过后，公司采取了RabbitMQ。</p> <p>但是RabbitMQ也有一点缺陷，就是他自身是基于erlang语言开发的，所以导致 较为难以分析里面的源码，也较难进行深层次的源码定制和改造，毕竟需要较为 扎实的erlang语言功底才可以。</p> <p>然后可以聊聊RocketMQ，是阿里开源的，经过阿里的生产环境的超高并发、 高吞吐的考验，性能卓越，同时还支持分布式事务等特殊场景。</p> <p>而且RocketMQ是基于Java语言开发的，适合深入阅读源码，有需要可以站在 源码层面解决线上生产问题，包括源码的二次开发和改造。</p> <p>另外就是Kafka。Kafka提供的消息中间件的功能明显较少一些，相对上述几款 MQ中间件要少很多。</p> <p>但是Kafka的优势在于专为超高吞吐量的实时日志采集、实时数据同步、实时数 据计算等场景来设计。</p> <p>因此Kafka在大数据领域中配合实时计算技术（比如Spark Streaming、 Storm、Flink）使用的较多。但是在传统的MQ中间件使用场景中较少采用。</p> <h2 id="kafka、activemq、rabbitmq、rocketmq-有-什么优缺点"><a href="#kafka、activemq、rabbitmq、rocketmq-有-什么优缺点" class="header-anchor">#</a> Kafka、ActiveMQ、RabbitMQ、RocketMQ 有 什么优缺点？</h2> <table><thead><tr><th>ActiveMQ</th> <th>RabbitMQ</th> <th>RocketMQ</th> <th>Kafka</th> <th>ZeroMQ</th> <th></th></tr></thead> <tbody><tr><td>单机吞吐 量</td> <td>比 RabbitM Q低</td> <td>2.6w/s（ 消息做持 久化）</td> <td>11.6w/s</td> <td>17.3w/s</td> <td>29w/s</td></tr> <tr><td>开发语言</td> <td>Java</td> <td>Erlang</td> <td>Java</td> <td>Scala/Java</td> <td>C</td></tr> <tr><td>主要维护者</td> <td>Apache</td> <td>Mozilla/Spring</td> <td>Alibaba</td> <td>Apache</td> <td>iMatix创始人已去世</td></tr> <tr><td>成熟度</td> <td>成熟</td> <td>成熟</td> <td>开源版本不够成熟</td> <td>比较成熟</td> <td>只有C、PHP等版本成熟</td></tr> <tr><td>订阅形式</td> <td>点对点 (p2p)、广 播（发布订阅）</td> <td>提供了4 种： direct,  topic,Headers 和 fanout。 fanout就 是广播模 式</td> <td>基于 topic/me ssageTag 以及按照消息类 型、属性 进行正则 匹配的发 布订阅模 式</td> <td>基于topic 以及按照 topic进行 正则匹配的发布订 阅模式</td> <td>点对点(P2P)</td></tr> <tr><td>持久化</td> <td>支持少量 堆积</td> <td>支持少量 堆积</td> <td>支持大量 堆积</td> <td>支持大量 堆积</td> <td>不支持</td></tr> <tr><td>顺序消息</td> <td>不支持</td> <td>不支持</td> <td>支持</td> <td>支持</td> <td>不支持</td></tr> <tr><td>性能稳定 性</td> <td>好</td> <td>好</td> <td>一般</td> <td>较差</td> <td>很好</td></tr> <tr><td>集群方式</td> <td>支持简单 集群模 式，比 如’主备’，对 高级集群 模式支持 不好。</td> <td>支持简单 集群，'复 制’模 式，对高 级集群模 式支持不 好。</td> <td>常用 多 对’Mast erSlave’ 模 式，开源 版本需手 动切换 Slave变成 Master</td> <td>天然 的‘Lead erSlave’无 状态集 群，每台 服务器既 是Master 也是Slave</td> <td>不支持</td></tr> <tr><td>管理界面</td> <td>一般</td> <td>较好</td> <td>一般</td> <td>无</td> <td>无</td></tr></tbody></table> <p>综上，各种对比之后，有如下建议：</p> <p>一般的业务系统要引入 MQ，最早大家都用 ActiveMQ，但是现在确实大家用 的不多了，没经过大规模吞吐量场景的验证，社区也不是很活跃，所以大家还是 算了吧，我个人不推荐用这个了；</p> <p>后来大家开始用 RabbitMQ，但是确实 erlang 语言阻止了大量的 Java 工程师 去深入研究和掌控它，对公司而言，几乎处于不可控的状态，但是确实人家是开 源的，比较稳定的支持，活跃度也高；</p> <p>不过现在确实越来越多的公司会去用 RocketMQ，确实很不错，毕竟是阿里出 品，但社区可能有突然黄掉的风险（目前 RocketMQ 已捐给 <a href="https://github.com/apache/rocketmq" target="_blank" rel="noopener noreferrer">Apache<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，但  GitHub 上的活跃度其实不算高）对自己公司技术实力有绝对自信的，推荐用  RocketMQ，否则回去老老实实用 RabbitMQ 吧，人家有活跃的开源社区，绝 对不会黄。</p> <p>所以<strong>中小型公司</strong>，技术实力较为一般，技术挑战不是特别高，用 RabbitMQ 是 不错的选择；<strong>大型公司</strong>，基础架构研发实力较强，用 RocketMQ 是很好的选 择。</p> <p>如果是<strong>大数据领域</strong>的实时计算、日志采集等场景，用 Kafka 是业内标准的，绝 对没问题，社区活跃度很高，绝对不会黄，何况几乎是全世界这个领域的事实性 规范。</p> <h2 id="mq-有哪些常见问题-如何解决这些问题"><a href="#mq-有哪些常见问题-如何解决这些问题" class="header-anchor">#</a> MQ 有哪些常见问题？如何解决这些问题？</h2> <p>MQ 的常见问题有：</p> <ol><li>消息的顺序问题</li> <li>消息的重复问题</li></ol> <p>**消息的顺序问题 **</p> <p>消息有序指的是可以按照消息的发送顺序来消费。</p> <p>假如生产者产生了 2 条消息：M1、M2，假定 M1 发送到 S1，M2 发送到  S2，如果要保证 M1 先于 M2 被消费，怎么做？</p> <p><svg id="SvgjsSvg1006" width="620.9943084716797" height="364.99998474121094" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><marker id="SvgjsMarker1063" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1064" d="M0,2 L14,6 L0,11 L0,2" fill="#cc0000" stroke="#cc0000" stroke-width="2"></path></marker><marker id="SvgjsMarker1071" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1072" d="M0,2 L14,6 L0,11 L0,2" fill="#cc0000" stroke="#cc0000" stroke-width="2"></path></marker><marker id="SvgjsMarker1079" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1080" d="M0,2 L14,6 L0,11 L0,2" fill="#7f00ff" stroke="#7f00ff" stroke-width="2"></path></marker><marker id="SvgjsMarker1087" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1088" d="M0,2 L14,6 L0,11 L0,2" fill="#7f00ff" stroke="#7f00ff" stroke-width="2"></path></marker><marker id="SvgjsMarker1095" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1096" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1103" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1104" d="M0,2 L14,6 L0,11 L0,2" fill="#cc0000" stroke="#cc0000" stroke-width="2"></path></marker><marker id="SvgjsMarker1113" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1114" d="M0,2 L14,6 L0,11 L0,2" fill="#7f00ff" stroke="#7f00ff" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1008" width="620.9943084716797" height="364.99998474121094" fill="#ffffff"></rect><g id="SvgjsG1009" transform="translate(25.002853393554688,25.011367797851562)"><path id="SvgjsPath1010" d="M 0 4Q 0 0 4 0L 166 0Q 170 0 170 4L 170 266Q 170 270 166 270L 4 270Q 0 270 0 266Z" stroke-dasharray="3,4" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1011"><text id="SvgjsText1012" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="150px" fill="#323232" font-weight="400" align="bottom" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="246.875" transform="rotate(0)"><tspan id="SvgjsTspan1013" dy="21" x="85"><tspan id="SvgjsTspan1014">生产者集群</tspan></tspan></text></g></g><g id="SvgjsG1015" transform="translate(60.00285339355469,95.01136779785156)"><path id="SvgjsPath1016" d="M 0 0L 100 0L 100 50L 0 50Z" stroke="none" fill-opacity="1" fill="#3399ff"></path><g id="SvgjsG1017"><text id="SvgjsText1018" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1019" dy="21" x="50"><tspan id="SvgjsTspan1020">生产者</tspan></tspan></text></g></g><g id="SvgjsG1021" transform="translate(228.0028533935547,25.011367797851562)"><path id="SvgjsPath1022" d="M 0 4Q 0 0 4 0L 166 0Q 170 0 170 4L 170 266Q 170 270 166 270L 4 270Q 0 270 0 266Z" stroke-dasharray="3,4" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1023"><text id="SvgjsText1024" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="150px" fill="#323232" font-weight="400" align="bottom" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="246.875" transform="rotate(0)"><tspan id="SvgjsTspan1025" dy="21" x="85"><tspan id="SvgjsTspan1026">MQ集群</tspan></tspan></text></g></g><g id="SvgjsG1027" transform="translate(263.0028533935547,59.01136779785156)"><path id="SvgjsPath1028" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1029"><text id="SvgjsText1030" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="17.875" transform="rotate(0)"><tspan id="SvgjsTspan1031" dy="16" x="50"><tspan id="SvgjsTspan1032">S1</tspan></tspan><tspan id="SvgjsTspan1033" dy="16" x="50"><tspan id="SvgjsTspan1034">MQ Server</tspan></tspan></text></g></g><g id="SvgjsG1035" transform="translate(426.0028533935547,25.011367797851562)"><path id="SvgjsPath1036" d="M 0 4Q 0 0 4 0L 166 0Q 170 0 170 4L 170 266Q 170 270 166 270L 4 270Q 0 270 0 266Z" stroke-dasharray="3,4" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1037"><text id="SvgjsText1038" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="150px" fill="#323232" font-weight="400" align="bottom" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="246.875" transform="rotate(0)"><tspan id="SvgjsTspan1039" dy="21" x="85"><tspan id="SvgjsTspan1040">消费者集群</tspan></tspan></text></g></g><g id="SvgjsG1041" transform="translate(461.0028533935547,69.01136779785156)"><path id="SvgjsPath1042" d="M 0 0L 100 0L 100 50L 0 50Z" stroke="none" fill-opacity="1" fill="#3399ff"></path><g id="SvgjsG1043"><text id="SvgjsText1044" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1045" dy="21" x="50"><tspan id="SvgjsTspan1046">消费者 1</tspan></tspan></text></g></g><g id="SvgjsG1047" transform="translate(461.0028533935547,178.01136779785156)"><path id="SvgjsPath1048" d="M 0 0L 100 0L 100 50L 0 50Z" stroke="none" fill-opacity="1" fill="#3399ff"></path><g id="SvgjsG1049"><text id="SvgjsText1050" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1051" dy="21" x="50"><tspan id="SvgjsTspan1052">消费者 2</tspan></tspan></text></g></g><g id="SvgjsG1053" transform="translate(263.0028533935547,169.01136779785156)"><path id="SvgjsPath1054" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1055"><text id="SvgjsText1056" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="17.875" transform="rotate(0)"><tspan id="SvgjsTspan1057" dy="16" x="50"><tspan id="SvgjsTspan1058">S2</tspan></tspan><tspan id="SvgjsTspan1059" dy="16" x="50"><tspan id="SvgjsTspan1060">MQ Server</tspan></tspan></text></g></g><g id="SvgjsG1061"><path id="SvgjsPath1062" d="M160.0028533935547 120.01136779785156L263.0028533935547 94.01136779785156" stroke="#cc0000" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1063)"></path><rect id="SvgjsRect1065" width="20" height="15" x="201.5028533935547" y="99.51136779785156" fill="#ffffff"></rect><text id="SvgjsText1066" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="97.88636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1067" dy="16" x="211.5028533935547"><tspan id="SvgjsTspan1068">M1</tspan></tspan></text></g><g id="SvgjsG1069"><path id="SvgjsPath1070" d="M363.0028533935547 94.01136779785156L461.0028533935547 94.01136779785156" stroke="#cc0000" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1071)"></path><rect id="SvgjsRect1073" width="20" height="15" x="402.0028533935547" y="86.51136779785156" fill="#ffffff"></rect><text id="SvgjsText1074" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="84.88636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1075" dy="16" x="412.0028533935547"><tspan id="SvgjsTspan1076">M1</tspan></tspan></text></g><g id="SvgjsG1077"><path id="SvgjsPath1078" d="M363.0028533935547 204.01136779785156L461.0028533935547 203.01136779785156" stroke="#7f00ff" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1079)"></path><rect id="SvgjsRect1081" width="20" height="15" x="402.0028533935547" y="196.01136779785156" fill="#ffffff"></rect><text id="SvgjsText1082" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="194.38636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1083" dy="16" x="412.0028533935547"><tspan id="SvgjsTspan1084">M2</tspan></tspan></text></g><g id="SvgjsG1085"><path id="SvgjsPath1086" d="M160.0028533935547 120.01136779785156L263.0028533935547 204.01136779785156" stroke="#7f00ff" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1087)"></path><rect id="SvgjsRect1089" width="20" height="15" x="201.5028533935547" y="154.51136779785156" fill="#ffffff"></rect><text id="SvgjsText1090" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="152.88636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1091" dy="16" x="211.5028533935547"><tspan id="SvgjsTspan1092">M2</tspan></tspan></text></g><g id="SvgjsG1093"><path id="SvgjsPath1094" d="M461.0028533935547 94.01136779785156L363.0028533935547 204.01136779785156" stroke-dasharray="8,5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1095)"></path><rect id="SvgjsRect1097" width="85" height="15" x="369.5028533935547" y="141.51136779785156" fill="#ffffff"></rect><text id="SvgjsText1098" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="85px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="139.88636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1099" dy="16" x="412.0028533935547"><tspan id="SvgjsTspan1100">通知M1收到了</tspan></tspan></text></g><g id="SvgjsG1101"><path id="SvgjsPath1102" d="M127.00285339355469 320.01136779785156L205.0028533935547 320.01136779785156" stroke="#cc0000" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1103)"></path></g><g id="SvgjsG1105" transform="translate(205.0028533935547,300.01136779785156)"><path id="SvgjsPath1106" d="M 0 0L 149 0L 149 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1107"><text id="SvgjsText1108" font-family="微软雅黑" text-anchor="start" font-size="13px" width="149px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1109" dy="16" x="0"><tspan id="SvgjsTspan1110">M1, 顺序在前: 先发送</tspan></tspan></text></g></g><g id="SvgjsG1111"><path id="SvgjsPath1112" d="M354.0028533935547 320.01136779785156L419.0028533935547 320.01136779785156" stroke="#7f00ff" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1113)"></path></g><g id="SvgjsG1115" transform="translate(419.0028533935547,300.01136779785156)"><path id="SvgjsPath1116" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1117"><text id="SvgjsText1118" font-family="微软雅黑" text-anchor="start" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1119" dy="16" x="0"><tspan id="SvgjsTspan1120">M2后发送</tspan></tspan></text></g></g></svg></p> <p>解决方案： （1）保证生产者 - MQServer - 消费者是一对一对一的关系</p> <p><svg id="SvgjsSvg1121" width="620.9943084716797" height="364.99998474121094" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1122"><marker id="SvgjsMarker1170" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1171" d="M0,2 L14,6 L0,11 L0,2" fill="#cc0000" stroke="#cc0000" stroke-width="2"></path></marker><marker id="SvgjsMarker1178" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1179" d="M0,2 L14,6 L0,11 L0,2" fill="#cc0000" stroke="#cc0000" stroke-width="2"></path></marker><marker id="SvgjsMarker1186" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1187" d="M0,2 L14,6 L0,11 L0,2" fill="#7f00ff" stroke="#7f00ff" stroke-width="2"></path></marker><marker id="SvgjsMarker1194" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1195" d="M0,2 L14,6 L0,11 L0,2" fill="#7f00ff" stroke="#7f00ff" stroke-width="2"></path></marker><marker id="SvgjsMarker1202" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1203" d="M0,2 L14,6 L0,11 L0,2" fill="#cc0000" stroke="#cc0000" stroke-width="2"></path></marker><marker id="SvgjsMarker1212" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1213" d="M0,2 L14,6 L0,11 L0,2" fill="#7f00ff" stroke="#7f00ff" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1123" width="620.9943084716797" height="364.99998474121094" fill="#ffffff"></rect><g id="SvgjsG1124" transform="translate(25.002853393554688,25.011367797851562)"><path id="SvgjsPath1125" d="M 0 4Q 0 0 4 0L 166 0Q 170 0 170 4L 170 266Q 170 270 166 270L 4 270Q 0 270 0 266Z" stroke-dasharray="3,4" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1126"><text id="SvgjsText1127" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="150px" fill="#323232" font-weight="400" align="bottom" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="246.875" transform="rotate(0)"><tspan id="SvgjsTspan1128" dy="21" x="85"><tspan id="SvgjsTspan1129">生产者集群</tspan></tspan></text></g></g><g id="SvgjsG1130" transform="translate(60.00285339355469,110.01136779785156)"><path id="SvgjsPath1131" d="M 0 0L 100 0L 100 50L 0 50Z" stroke="none" fill-opacity="1" fill="#3399ff"></path><g id="SvgjsG1132"><text id="SvgjsText1133" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1134" dy="21" x="50"><tspan id="SvgjsTspan1135">生产者</tspan></tspan></text></g></g><g id="SvgjsG1136" transform="translate(228.0028533935547,25.011367797851562)"><path id="SvgjsPath1137" d="M 0 4Q 0 0 4 0L 166 0Q 170 0 170 4L 170 266Q 170 270 166 270L 4 270Q 0 270 0 266Z" stroke-dasharray="3,4" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1138"><text id="SvgjsText1139" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="150px" fill="#323232" font-weight="400" align="bottom" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="246.875" transform="rotate(0)"><tspan id="SvgjsTspan1140" dy="21" x="85"><tspan id="SvgjsTspan1141">MQ集群</tspan></tspan></text></g></g><g id="SvgjsG1142" transform="translate(263.0028533935547,84.01136779785156)"><path id="SvgjsPath1143" d="M 0 0L 100 0L 100 116L 0 116Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1144"><text id="SvgjsText1145" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="40.875" transform="rotate(0)"><tspan id="SvgjsTspan1146" dy="16" x="50"><tspan id="SvgjsTspan1147">S1</tspan></tspan><tspan id="SvgjsTspan1148" dy="16" x="50"><tspan id="SvgjsTspan1149">MQ Server</tspan></tspan></text></g></g><g id="SvgjsG1150" transform="translate(426.0028533935547,25.011367797851562)"><path id="SvgjsPath1151" d="M 0 4Q 0 0 4 0L 166 0Q 170 0 170 4L 170 266Q 170 270 166 270L 4 270Q 0 270 0 266Z" stroke-dasharray="3,4" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1152"><text id="SvgjsText1153" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="150px" fill="#323232" font-weight="400" align="bottom" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="246.875" transform="rotate(0)"><tspan id="SvgjsTspan1154" dy="21" x="85"><tspan id="SvgjsTspan1155">消费者集群</tspan></tspan></text></g></g><g id="SvgjsG1156" transform="translate(461.0028533935547,69.01136779785156)"><path id="SvgjsPath1157" d="M 0 0L 100 0L 100 50L 0 50Z" stroke="none" fill-opacity="1" fill="#3399ff"></path><g id="SvgjsG1158"><text id="SvgjsText1159" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1160" dy="21" x="50"><tspan id="SvgjsTspan1161">消费者 1</tspan></tspan></text></g></g><g id="SvgjsG1162" transform="translate(461.0028533935547,178.01136779785156)"><path id="SvgjsPath1163" d="M 0 0L 100 0L 100 50L 0 50Z" stroke="none" fill-opacity="1" fill="#3399ff"></path><g id="SvgjsG1164"><text id="SvgjsText1165" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="80px" fill="#ffffff" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1166" dy="21" x="50"><tspan id="SvgjsTspan1167">消费者 2</tspan></tspan></text></g></g><g id="SvgjsG1168"><path id="SvgjsPath1169" d="M160.0028533935547 135.01136779785156L263.0028533935547 110.01136779785156" stroke="#cc0000" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1170)"></path><rect id="SvgjsRect1172" width="20" height="15" x="201.5028533935547" y="115.01136779785156" fill="#ffffff"></rect><text id="SvgjsText1173" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="113.38636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1174" dy="16" x="211.5028533935547"><tspan id="SvgjsTspan1175">M1</tspan></tspan></text></g><g id="SvgjsG1176"><path id="SvgjsPath1177" d="M362.0028533935547 109.01136779785156L461.0028533935547 94.01136779785156" stroke="#cc0000" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1178)"></path><rect id="SvgjsRect1180" width="20" height="15" x="401.5028533935547" y="94.01136779785156" fill="#ffffff"></rect><text id="SvgjsText1181" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="92.38636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1182" dy="16" x="411.5028533935547"><tspan id="SvgjsTspan1183">M1</tspan></tspan></text></g><g id="SvgjsG1184"><path id="SvgjsPath1185" d="M362.0028533935547 178.01136779785156L461.0028533935547 203.01136779785156" stroke="#7f00ff" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1186)"></path><rect id="SvgjsRect1188" width="20" height="15" x="401.5028533935547" y="183.01136779785156" fill="#ffffff"></rect><text id="SvgjsText1189" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="181.38636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1190" dy="16" x="411.5028533935547"><tspan id="SvgjsTspan1191">M2</tspan></tspan></text></g><g id="SvgjsG1192"><path id="SvgjsPath1193" d="M160.0028533935547 135.01136779785156L263.0028533935547 172.01136779785156" stroke="#7f00ff" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1194)"></path><rect id="SvgjsRect1196" width="20" height="15" x="201.5028533935547" y="146.01136779785156" fill="#ffffff"></rect><text id="SvgjsText1197" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="144.38636779785156" transform="rotate(0)"><tspan id="SvgjsTspan1198" dy="16" x="211.5028533935547"><tspan id="SvgjsTspan1199">M2</tspan></tspan></text></g><g id="SvgjsG1200"><path id="SvgjsPath1201" d="M127.00285339355469 320.01136779785156L205.0028533935547 320.01136779785156" stroke="#cc0000" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1202)"></path></g><g id="SvgjsG1204" transform="translate(205.0028533935547,300.01136779785156)"><path id="SvgjsPath1205" d="M 0 0L 149 0L 149 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1206"><text id="SvgjsText1207" font-family="微软雅黑" text-anchor="start" font-size="13px" width="149px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1208" dy="16" x="0"><tspan id="SvgjsTspan1209">M1, 顺序在前: 先发送</tspan></tspan></text></g></g><g id="SvgjsG1210"><path id="SvgjsPath1211" d="M354.0028533935547 320.01136779785156L419.0028533935547 320.01136779785156" stroke="#7f00ff" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1212)"></path></g><g id="SvgjsG1214" transform="translate(419.0028533935547,300.01136779785156)"><path id="SvgjsPath1215" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1216"><text id="SvgjsText1217" font-family="微软雅黑" text-anchor="start" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1218" dy="16" x="0"><tspan id="SvgjsTspan1219">M2后发送</tspan></tspan></text></g></g></svg></p> <p>缺陷：</p> <ul><li>并行度就会成为消息系统的瓶颈（吞吐量不够）</li> <li>更多的异常处理，比如：只要消费端出现问题，就会导致整个处理流程阻塞，我 们不得不花费更多的精力来解决阻塞的问题。（2）通过合理的设计或者将问题分解 来规避。</li> <li>不关注乱序的应用实际大量存在</li> <li>队列无序并不意味着消息无序 所以从业务层面来保证消息的顺序而不仅仅是依 赖于消息系统，是一种更合理的方式。</li></ul> <p>**消息的重复问题 **</p> <p>造成消息重复的根本原因是：网络不可达。</p> <p>所以解决这个问题的办法就是绕过这个问题。那么问题就变成了：如果消费端收 到两条一样的消息，应该怎样处理？</p> <p>消费端处理消息的业务逻辑保持幂等性。只要保持幂等性，不管来多少条重复消 息，最后处理的结果都一样。保证每条消息都有唯一编号且保证消息处理成功与 去重表的日志同时出现。利用一张日志表来记录已经处理成功的消息的 ID，如 果新到的消息 ID 已经在日志表中，那么就不再处理这条消息。</p> <h2 id="什么是rabbitmq"><a href="#什么是rabbitmq" class="header-anchor">#</a> 什么是RabbitMQ？</h2> <p>RabbitMQ是一款开源的，Erlang编写的，基于AMQP协议的消息中间件</p> <h2 id="rabbitmq-的使用场景"><a href="#rabbitmq-的使用场景" class="header-anchor">#</a> Rabbitmq 的使用场景</h2> <p>（1）服务间异步通信</p> <p>（2）顺序消费</p> <p>（3）定时任务</p> <p>（4）请求削峰</p> <h2 id="rabbitmq基本概念"><a href="#rabbitmq基本概念" class="header-anchor">#</a> RabbitMQ基本概念</h2> <ul><li>Broker： 简单来说就是消息队列服务器实体</li> <li>Exchange： 消息交换机，它指定消息按什么规则，路由到哪个队列</li> <li>Queue： 消息队列载体，每个消息都会被投入到一个或多个队列</li> <li>Binding： 绑定，它的作用就是把exchange和queue按照路由规则绑定起来</li> <li>Routing Key： 路由关键字，exchange根据这个关键字进行消息投递</li> <li>VHost： vhost 可以理解为虚拟 broker ，即 mini-RabbitMQ server。其内部 均含有独立的 queue、exchange 和 binding 等，但最最重要的是，其拥有独立的 权限系统，可以做到 vhost 范围的用户控制。当然，从 RabbitMQ 的全局角度， vhost 可以作为不同权限隔离的手段（一个典型的例子就是不同的应用可以跑在不同 的 vhost 中）。</li> <li>Producer： 消息生产者，就是投递消息的程序</li> <li>Consumer： 消息消费者，就是接受消息的程序</li> <li>Channel： 消息通道，在客户端的每个连接里，可建立多个channel，每个 channel代表一个会话任务</li></ul> <p>由Exchange、Queue、RoutingKey三个才能决定一个从Exchange到Queue的 唯一的线路。</p> <h2 id="rabbitmq的工作模式"><a href="#rabbitmq的工作模式" class="header-anchor">#</a> RabbitMQ的工作模式</h2> <h3 id="一-simple模式-即最简单的收发模式"><a href="#一-simple模式-即最简单的收发模式" class="header-anchor">#</a> 一.simple模式（即最简单的收发模式）</h3> <p><svg id="SvgjsSvg1220" width="512.9971313476562" height="223.99147033691406" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1221"><marker id="SvgjsMarker1259" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1260" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1263" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1264" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1267" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1268" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1222" width="512.9971313476562" height="223.99147033691406" fill="#ffffff"></rect><g id="SvgjsG1223" transform="translate(25.008544921875,79.00000762939453)"><path id="SvgjsPath1224" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#99ffff"></path><g id="SvgjsG1225"><text id="SvgjsText1226" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1227" dy="25" x="50"><tspan id="SvgjsTspan1228">P</tspan></tspan></text></g></g><g id="SvgjsG1229" transform="translate(164.008544921875,79.00000762939453)"><path id="SvgjsPath1230" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1231" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1232" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1233" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1234" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1235"><text id="SvgjsText1236" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1237"><text id="SvgjsText1238" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1239"><text id="SvgjsText1240" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1241"><text id="SvgjsText1242" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1243"><text id="SvgjsText1244" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1245" transform="translate(388.008544921875,139.00000762939453)"><path id="SvgjsPath1246" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1247"><text id="SvgjsText1248" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1249" dy="25" x="50"><tspan id="SvgjsTspan1250">C2</tspan></tspan></text></g></g><g id="SvgjsG1251" transform="translate(388.008544921875,25.00000762939453)"><path id="SvgjsPath1252" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1253"><text id="SvgjsText1254" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1255" dy="25" x="50"><tspan id="SvgjsTspan1256">C1</tspan></tspan></text></g></g><g id="SvgjsG1257"><path id="SvgjsPath1258" d="M333.008544921875 109.00000762939453L388.008544921875 55.00000762939453" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1259)"></path></g><g id="SvgjsG1261"><path id="SvgjsPath1262" d="M333.008544921875 109.00000762939453L388.008544921875 169.00000762939453" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1263)"></path></g><g id="SvgjsG1265"><path id="SvgjsPath1266" d="M125.008544921875 109.00000762939453L164.008544921875 109.00000762939453" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1267)"></path></g></svg></p> <p>1.消息产生消息，将消息放入队列</p> <p>2.消息的消费者(consumer) 监听 消息队列,如果队列中有消息,就消费掉,消息被 拿走后,自动从队列中删除(隐患 消息可能没有被消费者正确处理,已经从队列中消失了,造成消息的丢失，这里可以设置成手动的ack,但如果设置成手动ack，处 理完后要及时发送ack消息给队列，否则会造成内存溢出)。</p> <h3 id="二-work工作模式-资源的竞争"><a href="#二-work工作模式-资源的竞争" class="header-anchor">#</a> 二.work工作模式(资源的竞争)</h3> <p>1.消息产生者将消息放入队列消费者可以有多个,消费者1,消费者2同时监听同一 个队列,消息被消费。C1 C2共同争抢当前的消息队列内容,谁先拿到谁负责消费 消息(隐患：高并发情况下,默认会产生某一个消息被多个消费者共同使用,可以设 置一个开关(syncronize) 保证一条消息只能被一个消费者使用)。</p> <h3 id="三-publish-subscribe发布订阅-共享资源"><a href="#三-publish-subscribe发布订阅-共享资源" class="header-anchor">#</a> 三.publish/subscribe发布订阅(共享资源)</h3> <p><svg id="SvgjsSvg1269" width="636.9885864257812" height="260" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1270"><marker id="SvgjsMarker1308" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1309" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1328" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1329" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1338" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1339" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1342" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1343" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1346" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1347" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1271" width="636.9885864257812" height="260" fill="#ffffff"></rect><g id="SvgjsG1272" transform="translate(25.000015258789062,115.00853729248047)"><path id="SvgjsPath1273" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#99ffff"></path><g id="SvgjsG1274"><text id="SvgjsText1275" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1276" dy="25" x="50"><tspan id="SvgjsTspan1277">P</tspan></tspan></text></g></g><g id="SvgjsG1278" transform="translate(292.00001525878906,61.00853729248047)"><path id="SvgjsPath1279" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1280" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1281" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1282" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1283" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1284"><text id="SvgjsText1285" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1286"><text id="SvgjsText1287" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1288"><text id="SvgjsText1289" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1290"><text id="SvgjsText1291" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1292"><text id="SvgjsText1293" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1294" transform="translate(512.0000152587891,175.00853729248047)"><path id="SvgjsPath1295" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1296"><text id="SvgjsText1297" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1298" dy="25" x="50"><tspan id="SvgjsTspan1299">C2</tspan></tspan></text></g></g><g id="SvgjsG1300" transform="translate(512.0000152587891,61.00853729248047)"><path id="SvgjsPath1301" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1302"><text id="SvgjsText1303" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1304" dy="25" x="50"><tspan id="SvgjsTspan1305">C1</tspan></tspan></text></g></g><g id="SvgjsG1306"><path id="SvgjsPath1307" d="M461.00001525878906 91.00853729248047L512.0000152587891 91.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1308)"></path></g><g id="SvgjsG1310" transform="translate(292.00001525878906,175.00853729248047)"><path id="SvgjsPath1311" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1312" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1313" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1314" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1315" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1316"><text id="SvgjsText1317" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1318"><text id="SvgjsText1319" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1320"><text id="SvgjsText1321" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1322"><text id="SvgjsText1323" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1324"><text id="SvgjsText1325" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1326"><path id="SvgjsPath1327" d="M461.00001525878906 205.00853729248047L512.0000152587891 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1328)"></path></g><g id="SvgjsG1330" transform="translate(153.00001525878906,115.00853729248047)"><path id="SvgjsPath1331" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#9999ff"></path><g id="SvgjsG1332"><text id="SvgjsText1333" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1334" dy="25" x="50"><tspan id="SvgjsTspan1335">X</tspan></tspan></text></g></g><g id="SvgjsG1336"><path id="SvgjsPath1337" d="M253.00001525878906 145.00853729248047L292.00001525878906 91.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1338)"></path></g><g id="SvgjsG1340"><path id="SvgjsPath1341" d="M253.00001525878906 145.00853729248047L292.00001525878906 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1342)"></path></g><g id="SvgjsG1344"><path id="SvgjsPath1345" d="M125.00001525878906 145.00853729248047L153.00001525878906 145.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1346)"></path></g><g id="SvgjsG1348" transform="translate(316.50001525878906,25.008544921875)"><path id="SvgjsPath1349" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1350"><text id="SvgjsText1351" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1352" dy="16" x="60"><tspan id="SvgjsTspan1353">amq.gen-RQ6...</tspan></tspan></text></g></g><g id="SvgjsG1354" transform="translate(316.50001525878906,138.008544921875)"><path id="SvgjsPath1355" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1356"><text id="SvgjsText1357" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1358" dy="16" x="60"><tspan id="SvgjsTspan1359">amq.gen-As8...</tspan></tspan></text></g></g></svg></p> <p>1、每个消费者监听自己的队列；</p> <p>2、生产者将消息发给broker，由交换机将消息转发到绑定此交换机的每个队 列，每个绑定交换机的队列都将接收到消息。</p> <h3 id="四-routing路由模式"><a href="#四-routing路由模式" class="header-anchor">#</a> 四.routing路由模式</h3> <p><svg id="SvgjsSvg1360" width="656.9885864257812" height="260" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1361"><marker id="SvgjsMarker1399" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1400" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1419" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1420" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1429" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1430" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1437" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1438" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1445" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1446" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1461" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1462" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1362" width="656.9885864257812" height="260" fill="#ffffff"></rect><g id="SvgjsG1363" transform="translate(25.000015258789062,115.00853729248047)"><path id="SvgjsPath1364" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#99ffff"></path><g id="SvgjsG1365"><text id="SvgjsText1366" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1367" dy="25" x="50"><tspan id="SvgjsTspan1368">P</tspan></tspan></text></g></g><g id="SvgjsG1369" transform="translate(312.00001525878906,61.00853729248047)"><path id="SvgjsPath1370" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1371" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1372" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1373" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1374" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1375"><text id="SvgjsText1376" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1377"><text id="SvgjsText1378" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1379"><text id="SvgjsText1380" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1381"><text id="SvgjsText1382" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1383"><text id="SvgjsText1384" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1385" transform="translate(532.0000152587891,175.00853729248047)"><path id="SvgjsPath1386" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1387"><text id="SvgjsText1388" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1389" dy="25" x="50"><tspan id="SvgjsTspan1390">C2</tspan></tspan></text></g></g><g id="SvgjsG1391" transform="translate(532.0000152587891,61.00853729248047)"><path id="SvgjsPath1392" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1393"><text id="SvgjsText1394" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1395" dy="25" x="50"><tspan id="SvgjsTspan1396">C1</tspan></tspan></text></g></g><g id="SvgjsG1397"><path id="SvgjsPath1398" d="M481.00001525878906 91.00853729248047L532.0000152587891 91.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1399)"></path></g><g id="SvgjsG1401" transform="translate(312.00001525878906,175.00853729248047)"><path id="SvgjsPath1402" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1403" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1404" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1405" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1406" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1407"><text id="SvgjsText1408" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1409"><text id="SvgjsText1410" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1411"><text id="SvgjsText1412" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1413"><text id="SvgjsText1414" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1415"><text id="SvgjsText1416" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1417"><path id="SvgjsPath1418" d="M481.00001525878906 205.00853729248047L532.0000152587891 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1419)"></path></g><g id="SvgjsG1421" transform="translate(153.00001525878906,115.00853729248047)"><path id="SvgjsPath1422" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#9999ff"></path><g id="SvgjsG1423"><text id="SvgjsText1424" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1425" dy="25" x="50"><tspan id="SvgjsTspan1426">X</tspan></tspan></text></g></g><g id="SvgjsG1427"><path id="SvgjsPath1428" d="M253.00001525878906 145.00853729248047L312.00001525878906 91.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1429)"></path><rect id="SvgjsRect1431" width="45" height="15" x="260.00001525878906" y="110.50853729248047" fill="#ffffff"></rect><text id="SvgjsText1432" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="45px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="108.88353729248047" transform="rotate(0)"><tspan id="SvgjsTspan1433" dy="16" x="282.50001525878906"><tspan id="SvgjsTspan1434">orange</tspan></tspan></text></g><g id="SvgjsG1435"><path id="SvgjsPath1436" d="M253.00001525878906 145.00853729248047L312.00001525878906 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1437)"></path><rect id="SvgjsRect1439" width="33" height="15" x="266.00001525878906" y="167.50853729248047" fill="#ffffff"></rect><text id="SvgjsText1440" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="33px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="165.88353729248047" transform="rotate(0)"><tspan id="SvgjsTspan1441" dy="16" x="282.50001525878906"><tspan id="SvgjsTspan1442">black</tspan></tspan></text></g><g id="SvgjsG1443"><path id="SvgjsPath1444" d="M125.00001525878906 145.00853729248047L153.00001525878906 145.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1445)"></path></g><g id="SvgjsG1447" transform="translate(316.50001525878906,25.008544921875)"><path id="SvgjsPath1448" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1449"><text id="SvgjsText1450" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1451" dy="16" x="60"><tspan id="SvgjsTspan1452">Q1</tspan></tspan></text></g></g><g id="SvgjsG1453" transform="translate(336.50001525878906,138.008544921875)"><path id="SvgjsPath1454" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1455"><text id="SvgjsText1456" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1457" dy="16" x="60"><tspan id="SvgjsTspan1458">Q2</tspan></tspan></text></g></g><g id="SvgjsG1459"><path id="SvgjsPath1460" d="M203.00001525878906 175.00853729248047C 203.00001525878906 220.22977124291575 266.7787813083538 205.00853729248047 312.00001525878906 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1461)"></path><rect id="SvgjsRect1463" width="36" height="15" x="222.54205252737586" y="199.4665000238937" fill="#ffffff"></rect><text id="SvgjsText1464" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="36px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="197.8415000238937" transform="rotate(0)"><tspan id="SvgjsTspan1465" dy="16" x="240.54205252737586"><tspan id="SvgjsTspan1466">green</tspan></tspan></text></g><g id="SvgjsG1467" transform="translate(143.00001525878906,75.00853729248047)"><path id="SvgjsPath1468" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1469"><text id="SvgjsText1470" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1471" dy="16" x="60"><tspan id="SvgjsTspan1472">type=direct</tspan></tspan></text></g></g></svg></p> <p>1.消息生产者将消息发送给交换机按照路由判断,路由是字符串(info) 当前产生的 消息携带路由字符(对象的方法),交换机根据路由的key,只能匹配上路由key对应的消息队列,对应的消费者才能消费消息;</p> <p>2.根据业务功能定义路由字符串</p> <p>3.从系统的代码逻辑中获取对应的功能字符串,将消息任务扔到对应的队列中。</p> <p>4.业务场景:error 通知;EXCEPTION;错误通知的功能;传统意义的错误通知;客户 通知;利用key路由,可以将程序中的错误封装成消息传入到消息队列中,开发者可 以自定义消费者,实时接收错误;</p> <h3 id="五-topic-主题模式-路由模式的一种"><a href="#五-topic-主题模式-路由模式的一种" class="header-anchor">#</a> 五.topic 主题模式(路由模式的一种)</h3> <p><svg id="SvgjsSvg1473" width="656.9885864257812" height="260" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1474"><marker id="SvgjsMarker1512" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1513" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1532" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1533" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1542" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1543" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1550" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1551" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1558" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1559" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1574" markerWidth="16" markerHeight="12" refX="16" refY="6" viewBox="0 0 16 12" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1575" d="M0,2 L14,6 L0,11 L0,2" fill="#323232" stroke="#323232" stroke-width="2"></path></marker></defs><rect id="SvgjsRect1475" width="656.9885864257812" height="260" fill="#ffffff"></rect><g id="SvgjsG1476" transform="translate(25.000015258789062,115.00853729248047)"><path id="SvgjsPath1477" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#99ffff"></path><g id="SvgjsG1478"><text id="SvgjsText1479" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1480" dy="25" x="50"><tspan id="SvgjsTspan1481">P</tspan></tspan></text></g></g><g id="SvgjsG1482" transform="translate(312.00001525878906,61.00853729248047)"><path id="SvgjsPath1483" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1484" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1485" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1486" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1487" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1488"><text id="SvgjsText1489" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1490"><text id="SvgjsText1491" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1492"><text id="SvgjsText1493" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1494"><text id="SvgjsText1495" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1496"><text id="SvgjsText1497" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1498" transform="translate(532.0000152587891,175.00853729248047)"><path id="SvgjsPath1499" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1500"><text id="SvgjsText1501" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1502" dy="25" x="50"><tspan id="SvgjsTspan1503">C2</tspan></tspan></text></g></g><g id="SvgjsG1504" transform="translate(532.0000152587891,61.00853729248047)"><path id="SvgjsPath1505" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#66b2ff"></path><g id="SvgjsG1506"><text id="SvgjsText1507" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1508" dy="25" x="50"><tspan id="SvgjsTspan1509">C1</tspan></tspan></text></g></g><g id="SvgjsG1510"><path id="SvgjsPath1511" d="M481.00001525878906 91.00853729248047L532.0000152587891 91.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1512)"></path></g><g id="SvgjsG1514" transform="translate(312.00001525878906,175.00853729248047)"><path id="SvgjsPath1515" d="M0 0L33.800000000000004 0L33.800000000000004 60 L0 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1516" d="M33.800000000000004 0L67.60000000000001 0L67.60000000000001 60 L33.800000000000004 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1517" d="M67.60000000000001 0L101.4 0L101.4 60 L67.60000000000001 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1518" d="M101.39999999999999 0L135.21689999999998 0L135.21689999999998 60 L101.39999999999999 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><path id="SvgjsPath1519" d="M135.20000000000002 0L169 0L169 60 L135.20000000000002 60Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ff6666"></path><g id="SvgjsG1520"><text id="SvgjsText1521" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1522"><text id="SvgjsText1523" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1524"><text id="SvgjsText1525" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1526"><text id="SvgjsText1527" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g><g id="SvgjsG1528"><text id="SvgjsText1529" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="34px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="18" transform="rotate(0)"></text></g></g><g id="SvgjsG1530"><path id="SvgjsPath1531" d="M481.00001525878906 205.00853729248047L532.0000152587891 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1532)"></path></g><g id="SvgjsG1534" transform="translate(153.00001525878906,115.00853729248047)"><path id="SvgjsPath1535" d="M 0 30C 0 -10 100 -10 100 30C 100 70 0 70 0 30Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#9999ff"></path><g id="SvgjsG1536"><text id="SvgjsText1537" font-family="微软雅黑" text-anchor="middle" font-size="20px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="20px" weight="400" font-style="" opacity="1" y="15" transform="rotate(0)"><tspan id="SvgjsTspan1538" dy="25" x="50"><tspan id="SvgjsTspan1539">X</tspan></tspan></text></g></g><g id="SvgjsG1540"><path id="SvgjsPath1541" d="M253.00001525878906 145.00853729248047L312.00001525878906 91.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1542)"></path><rect id="SvgjsRect1544" width="62" height="15" x="251.50001525878906" y="110.50853729248047" fill="#ffffff"></rect><text id="SvgjsText1545" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="62px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="108.88353729248047" transform="rotate(0)"><tspan id="SvgjsTspan1546" dy="16" x="282.50001525878906"><tspan id="SvgjsTspan1547"><em>.orange.</em></tspan></tspan></text></g><g id="SvgjsG1548"><path id="SvgjsPath1549" d="M253.00001525878906 145.00853729248047L312.00001525878906 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1550)"></path><rect id="SvgjsRect1552" width="55" height="15" x="255.00001525878906" y="167.50853729248047" fill="#ffffff"></rect><text id="SvgjsText1553" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="55px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="165.88353729248047" transform="rotate(0)"><tspan id="SvgjsTspan1554" dy="16" x="282.50001525878906"><tspan id="SvgjsTspan1555"><em>.</em>.rabbit</tspan></tspan></text></g><g id="SvgjsG1556"><path id="SvgjsPath1557" d="M125.00001525878906 145.00853729248047L153.00001525878906 145.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1558)"></path></g><g id="SvgjsG1560" transform="translate(336.50001525878906,25.008544921875)"><path id="SvgjsPath1561" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1562"><text id="SvgjsText1563" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1564" dy="16" x="60"><tspan id="SvgjsTspan1565">Q1</tspan></tspan></text></g></g><g id="SvgjsG1566" transform="translate(336.50001525878906,138.008544921875)"><path id="SvgjsPath1567" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1568"><text id="SvgjsText1569" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1570" dy="16" x="60"><tspan id="SvgjsTspan1571">Q2</tspan></tspan></text></g></g><g id="SvgjsG1572"><path id="SvgjsPath1573" d="M203.00001525878906 175.00853729248047C 203.00001525878906 220.22977124291575 266.7787813083538 205.00853729248047 312.00001525878906 205.00853729248047" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1574)"></path><rect id="SvgjsRect1576" width="35" height="15" x="223.04205252737586" y="199.4665000238937" fill="#ffffff"></rect><text id="SvgjsText1577" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="35px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="197.8415000238937" transform="rotate(0)"><tspan id="SvgjsTspan1578" dy="16" x="240.54205252737586"><tspan id="SvgjsTspan1579">lazy.#</tspan></tspan></text></g><g id="SvgjsG1580" transform="translate(143.00001525878906,75.00853729248047)"><path id="SvgjsPath1581" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1582"><text id="SvgjsText1583" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.875" transform="rotate(0)"><tspan id="SvgjsTspan1584" dy="16" x="60"><tspan id="SvgjsTspan1585">type=topic</tspan></tspan></text></g></g></svg>
1.星号井号代表通配符</p> <p>2.星号代表多个单词,井号代表一个单词</p> <p>3.路由功能添加模糊匹配</p> <p>4.消息产生者产生消息,把消息交给交换机</p> <p>5.交换机根据key的规则模糊匹配到对应的队列,由队列的监听消费者接收消息消 费</p> <p>（在我的理解看来就是routing查询的一种模糊匹配，就类似sql的模糊查询方 式）</p> <h2 id="如何保证rabbitmq消息的顺序性"><a href="#如何保证rabbitmq消息的顺序性" class="header-anchor">#</a> 如何保证RabbitMQ消息的顺序性？</h2> <p>拆分多个 queue，每个 queue 一个 consumer，就是多一些 queue 而已，确 实是麻烦点；或者就一个 queue 但是对应一个 consumer，然后这个  consumer 内部用内存队列做排队，然后分发给底层不同的 worker 来处理。</p> <h1 id="消息如何分发"><a href="#消息如何分发" class="header-anchor">#</a> 消息如何分发？</h1> <p>若该队列至少有一个消费者订阅，消息将以循环（round-robin）的方式发送给消费者。每条消息只会分发给一个订阅的消费者（前提是消费者能够正常处理消息并进行确认）。通过路由可实现多消费的功能</p> <h1 id="消息怎么路由"><a href="#消息怎么路由" class="header-anchor">#</a> 消息怎么路由？</h1> <p>消息提供方-&gt;路由-&gt;一至多个队列消息发布到交换器时，消息将拥有一个路由键（routing key），在消息创建时设定。通过队列路由键，可以把队列绑定到交换器上。消息到达交换器后，RabbitMQ 会将消息的路由键与队列的路由键进行匹配（针对不同的交换器有不同的路由规则）；常用的交换器主要分为一下三种： fanout：如果交换器收到消息，将会广播到所有绑定的队列上 direct：如果路由键完全匹配，消息就被投递到相应的队列</p> <p>topic：可以使来自不同源头的消息能够到达同一个队列。 使用 topic 交换器时，可以使用通配符</p> <h1 id="消息基于什么传输"><a href="#消息基于什么传输" class="header-anchor">#</a> 消息基于什么传输？</h1> <p>由于 TCP 连接的创建和销毁开销较大，且并发数受系统资源限制，会造成性能瓶颈。RabbitMQ 使用信道的方式来传输数据。信道是建立在真实的 TCP 连接内的虚拟连接，且每条 TCP 连接上的信道数量没有限制。</p> <h1 id="如何保证消息不被重复消费-或者说-如何保证消息消费时的幂等性"><a href="#如何保证消息不被重复消费-或者说-如何保证消息消费时的幂等性" class="header-anchor">#</a> 如何保证消息不被重复消费？或者说，如何保证消息消费时的幂等性？</h1> <p>先说为什么会重复消费：正常情况下，消费者在消费消息的时候，消费完毕后，会发送一个确认消息给消息队列，消息队列就知道该消息被消费了，就会将该消息从消息队列中删除；但是因为网络传输等等故障，确认信息没有传送到消息队列，导致消息队列不知道自己已经消费过该消息了，再次将消息分发给其他的消费者。</p> <p>针对以上问题，一个解决思路是：保证消息的唯一性，就算是多次传输，不要让消息的多次消费带来影响；保证消息等幂性；比如：在写入消息队列的数据做唯一标示，消费消息时，根据唯一标识判断是否消费过；假设你有个系统，消费一条消息就往数据库里插入一条数据，要是你一个消息重复两次，你不就插入了两条，这数据不就错了？但是你要是消费到第二次的时据，从而保证了数据的正确性。</p> <h1 id="候-自己判断一下是否已经消费过了-若是就直接扔了-这样不就保留了一条数如何确保消息正确地发送至-rabbitmq-如何确保消息接收方消费了消息"><a href="#候-自己判断一下是否已经消费过了-若是就直接扔了-这样不就保留了一条数如何确保消息正确地发送至-rabbitmq-如何确保消息接收方消费了消息" class="header-anchor">#</a> 候，自己判断一下是否已经消费过了，若是就直接扔了，这样不就保留了一条数如何确保消息正确地发送至 RabbitMQ？ 如何确保消息接收方消费了消息？</h1> <p>发送方确认模式将信道设置成 confirm 模式（发送方确认模式），则所有在信道上发布的消息都会被指派一个唯一的 ID。</p> <p>一旦消息被投递到目的队列后，或者消息被写入磁盘后（可持久化的消息），信道会发送一个确认给生产者（包含消息唯一 ID）。</p> <p>如果 RabbitMQ 发生内部错误从而导致消息丢失，会发送一条 nack（notacknowledged，未确认）消息。</p> <p>发送方确认模式是异步的，生产者应用程序在等待确认的同时，可以继续发送消息。当确认消息到达生产者应用程序，生产者应用程序的回调方法就会被触发来处理确认消息。接收方确认机制消费者接收每一条消息后都必须进行确认（消息接收和消息确认是两个不同操作）。只有消费者确认了消息，RabbitMQ 才能安全地把消息从队列中删除。</p> <p>这里并没有用到超时机制，RabbitMQ 仅通过 Consumer 的连接中断来确认是否需要重新发送消息。也就是说，只要连接不中断，RabbitMQ 给了</p> <p>Consumer 足够长的时间来处理消息。保证数据的最终一致性；下面罗列几种特殊情况</p> <ul><li>如果消费者接收到消息，在确认之前断开了连接或取消订阅，RabbitMQ 会认为消息没有被分发，然后重新分发给下一个订阅的消费者。（可能存在消息重复消费的隐患，需要去重）</li> <li>如果消费者接收到消息却没有确认消息，连接也未断开，则 RabbitMQ 认为该消费者繁忙，将不会给该消费者分发更多的消息。</li></ul> <h1 id="如何保证rabbitmq消息的可靠传输"><a href="#如何保证rabbitmq消息的可靠传输" class="header-anchor">#</a> 如何保证RabbitMQ消息的可靠传输？</h1> <p>消息不可靠的情况可能是消息丢失，劫持等原因；丢失又分为：生产者丢失消息、消息列表丢失消息、消费者丢失消息；生产者丢失消息：从生产者弄丢数据这个角度来看，RabbitMQ提供 transaction和confirm模式来确保生产者不丢消息；</p> <p>transaction机制就是说：发送消息前，开启事务（channel.txSelect()）,然后发送消息，如果发送过程中出现什么异常，事务就会回滚</p> <p>（channel.txRollback()）,如果发送成功则提交事务</p> <p>（channel.txCommit()）。然而，这种方式有个缺点：吞吐量下降；</p> <p>confirm模式用的居多：一旦channel进入confirm模式，所有在该信道上发布的消息都将会被指派一个唯一的ID（从1开始），一旦消息被投递到所有匹配的队列之后；</p> <p>rabbitMQ就会发送一个ACK给生产者（包含消息的唯一ID），这就使得生产者知道消息已经正确到达目的队列了；</p> <p>如果rabbitMQ没能处理该消息，则会发送一个Nack消息给你，你可以进行重试操作。</p> <p>消息队列丢数据：消息持久化。</p> <p>处理消息队列丢数据的情况，一般是开启持久化磁盘的配置。</p> <p>这个持久化配置可以和confirm机制配合使用，你可以在消息持久化磁盘后，再给生产者发送一个Ack信号。</p> <p>这样，如果消息持久化磁盘之前，rabbitMQ阵亡了，那么生产者收不到Ack信号，生产者会自动重发。</p> <p>那么如何持久化呢？</p> <p>这里顺便说一下吧，其实也很容易，就下面两步</p> <p>\1. 将queue的持久化标识durable设置为true,则代表是一个持久的队列</p> <p>\2. 发送消息的时候将deliveryMode=2</p> <p>这样设置以后，即使rabbitMQ挂了，重启后也能恢复数据消费者丢失消息：消费者丢数据一般是因为采用了自动确认消息模式，改为手动确认消息即可！消费者在收到消息之后，处理消息之前，会自动回复RabbitMQ已收到消息；如果这时处理消息失败，就会丢失该消息；解决方案：处理消息成功后，手动回复确认消息。</p> <h1 id="为什么不应该对所有的-message-都使用持久化机制"><a href="#为什么不应该对所有的-message-都使用持久化机制" class="header-anchor">#</a> 为什么不应该对所有的 message 都使用持久化机制？</h1> <p>首先，必然导致性能的下降，因为写磁盘比写 RAM 慢的多，message 的吞吐量可能有 10 倍的差距。</p> <p>其次，message 的持久化机制用在 RabbitMQ 的内置 cluster 方案时会出现“坑爹”问题。矛盾点在于，若 message 设置了 persistent 属性，但 queue 未设置 durable 属性，那么当该 queue 的 owner node 出现异常后，在未重建该 queue 前，发往该 queue 的 message 将被 blackholed ；若 message 设置了 persistent 属性，同时 queue 也设置了 durable 属性，那么当 queue 的 owner node 异常且无法重启的情况下，则该 queue 无法在其他 node 上重建，只能等待其 owner node 重启后，才能恢复该 queue 的使用，而在这段时间内发送给该 queue 的 message 将被 blackholed 。</p> <p>所以，是否要对 message 进行持久化，需要综合考虑性能需要，以及可能遇到的问题。若想达到 100,000 条/秒以上的消息吞吐量（单 RabbitMQ 服务</p> <p>器），则要么使用其他的方式来确保 message 的可靠 delivery ，要么使用非常快速的存储系统以支持全持久化（例如使用 SSD）。另外一种处理原则是：</p> <p>仅对关键消息作持久化处理（根据业务重要程度），且应该保证关键消息的量不会导致性能瓶颈。</p> <h1 id="如何保证高可用的-rabbitmq-的集群"><a href="#如何保证高可用的-rabbitmq-的集群" class="header-anchor">#</a> 如何保证高可用的？RabbitMQ 的集群</h1> <p>RabbitMQ 是比较有代表性的，因为是基于主从（非分布式）做高可用性的，</p> <p>我们就以 RabbitMQ 为例子讲解第一种 MQ 的高可用性怎么实现。RabbitMQ 有三种模式：单机模式、普通集群模式、镜像集群模式。</p> <p>单机模式，就是 Demo 级别的，一般就是你本地启动了玩玩儿的?，没人生产用单机模式普通集群模式，意思就是在多台机器上启动多个 RabbitMQ 实例，每个机器启动一个。你创建的 queue，只会放在一个 RabbitMQ 实例上，但是每个实例都同步 queue 的元数据（元数据可以认为是 queue 的一些配置信息，通过元数据，可以找到 queue 所在实例）。你消费的时候，实际上如果连接到了另外一个实例，那么那个实例会从 queue 所在实例上拉取数据过来。这方案主要是提高吞吐量的，就是说让集群中多个节点来服务某个 queue 的读写操作。</p> <p>镜像集群模式：这种模式，才是所谓的 RabbitMQ 的高可用模式。跟普通集群模式不一样的是，在镜像集群模式下，你创建的 queue，无论元数据还是 queue 里的消息都会存在于多个实例上，就是说，每个 RabbitMQ 节点都有这个 queue 的一个完整镜像，包含 queue 的全部数据的意思。然后每次你写消息到 queue 的时候，都会自动把消息同步到多个实例的 queue 上。</p> <p>RabbitMQ 有很好的管理控制台，就是在后台新增一个策略，这个策略是镜像集群模式的策略，指定的时候是可以要求数据同步到所有节点的，也可以要求同步到指定数量的节点，再次创建 queue 的时候，应用这个策略，就会自动将数据同步到其他的节点上去了。这样的话，好处在于，你任何一个机器宕机了，没事儿，其它机器（节点）还包含了这个 queue 的完整数据，别的 consumer 都可以到其它节点上去消费数据。坏处在于，第一，这个性能开销也太大了吧，消息需要同步到所有机器上，导致网络带宽压力和消耗很重！RabbitMQ 一个 queue 的数据都是放在一个节点里的，镜像集群下，也是每个节点都放这个queue 的完整数据。</p> <p>如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，说说怎么解决？</p> <p>消息积压处理办法：临时紧急扩容：</p> <p>先修复 consumer 的问题，确保其恢复消费速度，然后将现有 cnosumer 都停掉。</p> <p>新建一个 topic，partition 是原来的 10 倍，临时建立好原先 10 倍的 queue 数量。</p> <p>然后写一个临时的分发数据的 consumer 程序，这个程序部署上去消费积压的</p> <p>数据，消费之后不做耗时的处理，直接均匀轮询写入临时建立好的 10 倍数量的 queue。</p> <p>接着临时征用 10 倍的机器来部署 consumer，每一批 consumer 消费一个临时 queue 的数据。这种做法相当于是临时将 queue 资源和 consumer 资源扩大 10 倍，以正常的 10 倍速度来消费数据。</p> <p>等快速消费完积压数据之后，得恢复原先部署的架构，重新用原先的 consumer 机器来消费消息。</p> <p>MQ中消息失效：假设你用的是 RabbitMQ，RabbtiMQ 是可以设置过期时间</p> <p>的，也就是 TTL。如果消息在 queue 中积压超过一定的时间就会被 RabbitMQ 给清理掉，这个数据就没了。那这就是第二个坑了。这就不是说数据会大量积压在 mq 里，而是大量的数据会直接搞丢。我们可以采取一个方案，就是批量重导，这个我们之前线上也有类似的场景干过。就是大量积压的时候，我们当时就直接丢弃数据了，然后等过了高峰期以后，比如大家一起喝咖啡熬夜到晚上12 点以后，用户都睡觉了。这个时候我们就开始写程序，将丢失的那批数据，写个临时程序，一点一点的查出来，然后重新灌入 mq 里面去，把白天丢的数据给他补回来。也只能是这样了。假设 1 万个订单积压在 mq 里面，没有处理，其中 1000 个订单都丢了，你只能手动写程序把那 1000 个订单给查出来，手动发到 mq 里去再补一次。</p> <p>mq消息队列块满了：如果消息积压在 mq 里，你很长时间都没有处理掉，此时导致 mq 都快写满了，咋办？这个还有别的办法吗？没有，谁让你第一个方案执行的太慢了，你临时写程序，接入数据来消费，消费一个丢弃一个，都不要</p> <p>了，快速消费掉所有的消息。然后走第二个方案，到了晚上再补数据吧。</p> <h1 id="设计mq思路"><a href="#设计mq思路" class="header-anchor">#</a> 设计MQ思路</h1> <p>比如说这个消息队列系统，我们从以下几个角度来考虑一下：首先这个 mq 得支持可伸缩性吧，就是需要的时候快速扩容，就可以增加吞吐量和容量，那怎么搞？设计个分布式的系统呗，参照一下 kafka 的设计理念，</p> <p>broker -&gt; topic -&gt; partition，每个 partition 放一个机器，就存一部分数据。</p> <p>如果现在资源不够了，简单啊，给 topic 增加 partition，然后做数据迁移，增加机器，不就可以存放更多数据，提供更高的吞吐量了？其次你得考虑一下这个 mq 的数据要不要落地磁盘吧？那肯定要了，落磁盘才能保证别进程挂了数据就丢了。那落磁盘的时候怎么落啊？顺序写，这样就没有</p> <p>磁盘随机读写的寻址开销，磁盘顺序读写的性能是很高的，这就是 kafka 的思路。</p> <p>其次你考虑一下你的 mq 的可用性啊？这个事儿，具体参考之前可用性那个环节讲解的 kafka 的高可用保障机制。多副本 -&gt; leader &amp; follower -&gt; broker 挂了重新选举 leader 即可对外服务。</p> <p>能不能支持数据 0 丢失啊？可以的，参考我们之前说的那个 kafka 数据零丢失方案。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/24/2021, 8:31:13 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.42575a28.js" defer></script><script src="/assets/js/2.0d7d09b8.js" defer></script><script src="/assets/js/122.dcd4190d.js" defer></script>
  </body>
</html>
