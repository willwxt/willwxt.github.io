<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | SUCKED BloG</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.42575a28.js" as="script"><link rel="preload" href="/assets/js/2.0d7d09b8.js" as="script"><link rel="preload" href="/assets/js/96.3a598fc5.js" as="script"><link rel="prefetch" href="/assets/js/10.1a30ebe5.js"><link rel="prefetch" href="/assets/js/100.022f696a.js"><link rel="prefetch" href="/assets/js/101.06eb0acb.js"><link rel="prefetch" href="/assets/js/102.e944c220.js"><link rel="prefetch" href="/assets/js/103.45b9da9a.js"><link rel="prefetch" href="/assets/js/104.cf53f5d1.js"><link rel="prefetch" href="/assets/js/105.200d7fe5.js"><link rel="prefetch" href="/assets/js/106.a0cc3502.js"><link rel="prefetch" href="/assets/js/107.4a71d17e.js"><link rel="prefetch" href="/assets/js/108.d7a39a75.js"><link rel="prefetch" href="/assets/js/109.35619cf9.js"><link rel="prefetch" href="/assets/js/11.f78ae8b3.js"><link rel="prefetch" href="/assets/js/110.f667d72e.js"><link rel="prefetch" href="/assets/js/111.de83ce6f.js"><link rel="prefetch" href="/assets/js/112.417d40bf.js"><link rel="prefetch" href="/assets/js/113.0f26c1ca.js"><link rel="prefetch" href="/assets/js/114.c7014acb.js"><link rel="prefetch" href="/assets/js/115.b502c0f1.js"><link rel="prefetch" href="/assets/js/116.10fb230e.js"><link rel="prefetch" href="/assets/js/117.f7cb9e2a.js"><link rel="prefetch" href="/assets/js/118.978d3075.js"><link rel="prefetch" href="/assets/js/119.09272191.js"><link rel="prefetch" href="/assets/js/12.140aa2af.js"><link rel="prefetch" href="/assets/js/120.32b5dbd7.js"><link rel="prefetch" href="/assets/js/121.8d618bbb.js"><link rel="prefetch" href="/assets/js/122.dcd4190d.js"><link rel="prefetch" href="/assets/js/123.2ee061d1.js"><link rel="prefetch" href="/assets/js/124.5a3760a7.js"><link rel="prefetch" href="/assets/js/125.a874a4bc.js"><link rel="prefetch" href="/assets/js/126.c6c6b7e6.js"><link rel="prefetch" href="/assets/js/127.38c35051.js"><link rel="prefetch" href="/assets/js/128.8d775ac8.js"><link rel="prefetch" href="/assets/js/129.6100ddb1.js"><link rel="prefetch" href="/assets/js/13.b2a6e590.js"><link rel="prefetch" href="/assets/js/130.9a83da2a.js"><link rel="prefetch" href="/assets/js/131.22de7670.js"><link rel="prefetch" href="/assets/js/132.f88798bf.js"><link rel="prefetch" href="/assets/js/133.925bbfed.js"><link rel="prefetch" href="/assets/js/134.481fad71.js"><link rel="prefetch" href="/assets/js/135.c3efb09b.js"><link rel="prefetch" href="/assets/js/136.758c447a.js"><link rel="prefetch" href="/assets/js/137.dcde1032.js"><link rel="prefetch" href="/assets/js/138.616a346b.js"><link rel="prefetch" href="/assets/js/139.b58dd07f.js"><link rel="prefetch" href="/assets/js/14.15374560.js"><link rel="prefetch" href="/assets/js/140.62b4c7ea.js"><link rel="prefetch" href="/assets/js/15.ffd155fa.js"><link rel="prefetch" href="/assets/js/16.feb1b022.js"><link rel="prefetch" href="/assets/js/17.6d491eb6.js"><link rel="prefetch" href="/assets/js/18.03ddaa95.js"><link rel="prefetch" href="/assets/js/19.021bbcc8.js"><link rel="prefetch" href="/assets/js/20.8aa708b0.js"><link rel="prefetch" href="/assets/js/21.59d7a21e.js"><link rel="prefetch" href="/assets/js/22.21597439.js"><link rel="prefetch" href="/assets/js/23.77303f0b.js"><link rel="prefetch" href="/assets/js/24.0789ed5b.js"><link rel="prefetch" href="/assets/js/25.244a12a8.js"><link rel="prefetch" href="/assets/js/26.a6ee95e4.js"><link rel="prefetch" href="/assets/js/27.9e0f0e9d.js"><link rel="prefetch" href="/assets/js/28.189031c5.js"><link rel="prefetch" href="/assets/js/29.b3100d33.js"><link rel="prefetch" href="/assets/js/3.2a5d4cd5.js"><link rel="prefetch" href="/assets/js/30.fe8fe8c0.js"><link rel="prefetch" href="/assets/js/31.86fec3f7.js"><link rel="prefetch" href="/assets/js/32.24cac061.js"><link rel="prefetch" href="/assets/js/33.f1db2ed0.js"><link rel="prefetch" href="/assets/js/34.c220692f.js"><link rel="prefetch" href="/assets/js/35.9e7b4779.js"><link rel="prefetch" href="/assets/js/36.0cb1d1bc.js"><link rel="prefetch" href="/assets/js/37.7d1fcf79.js"><link rel="prefetch" href="/assets/js/38.bc9bc4b3.js"><link rel="prefetch" href="/assets/js/39.10801a2a.js"><link rel="prefetch" href="/assets/js/4.b4d9a5aa.js"><link rel="prefetch" href="/assets/js/40.c980543d.js"><link rel="prefetch" href="/assets/js/41.3f4581d8.js"><link rel="prefetch" href="/assets/js/42.60b85cdf.js"><link rel="prefetch" href="/assets/js/43.1338528d.js"><link rel="prefetch" href="/assets/js/44.786fc51f.js"><link rel="prefetch" href="/assets/js/45.d65f6744.js"><link rel="prefetch" href="/assets/js/46.543c2b26.js"><link rel="prefetch" href="/assets/js/47.59f19ed2.js"><link rel="prefetch" href="/assets/js/48.60de6b25.js"><link rel="prefetch" href="/assets/js/49.f3df62ef.js"><link rel="prefetch" href="/assets/js/5.013522c1.js"><link rel="prefetch" href="/assets/js/50.fd9871d6.js"><link rel="prefetch" href="/assets/js/51.1fb1863e.js"><link rel="prefetch" href="/assets/js/52.c06ce3f3.js"><link rel="prefetch" href="/assets/js/53.a3d55203.js"><link rel="prefetch" href="/assets/js/54.89ac64bc.js"><link rel="prefetch" href="/assets/js/55.ccf38d1e.js"><link rel="prefetch" href="/assets/js/56.ffb8595b.js"><link rel="prefetch" href="/assets/js/57.5f1bd695.js"><link rel="prefetch" href="/assets/js/58.7463616d.js"><link rel="prefetch" href="/assets/js/59.ea4eb5dd.js"><link rel="prefetch" href="/assets/js/6.72ad7c85.js"><link rel="prefetch" href="/assets/js/60.a2add219.js"><link rel="prefetch" href="/assets/js/61.3eae0362.js"><link rel="prefetch" href="/assets/js/62.801d1658.js"><link rel="prefetch" href="/assets/js/63.b47a17bb.js"><link rel="prefetch" href="/assets/js/64.d5e2bdea.js"><link rel="prefetch" href="/assets/js/65.24d540f4.js"><link rel="prefetch" href="/assets/js/66.09a1ae52.js"><link rel="prefetch" href="/assets/js/67.75bd38e7.js"><link rel="prefetch" href="/assets/js/68.1fe6956e.js"><link rel="prefetch" href="/assets/js/69.d3306c2d.js"><link rel="prefetch" href="/assets/js/7.60760bb7.js"><link rel="prefetch" href="/assets/js/70.95aa4503.js"><link rel="prefetch" href="/assets/js/71.7065ebf0.js"><link rel="prefetch" href="/assets/js/72.55ae5081.js"><link rel="prefetch" href="/assets/js/73.c7624eee.js"><link rel="prefetch" href="/assets/js/74.63bcc7bd.js"><link rel="prefetch" href="/assets/js/75.e2731e20.js"><link rel="prefetch" href="/assets/js/76.1711af80.js"><link rel="prefetch" href="/assets/js/77.f1c4e2d3.js"><link rel="prefetch" href="/assets/js/78.900bc856.js"><link rel="prefetch" href="/assets/js/79.a1b8c47b.js"><link rel="prefetch" href="/assets/js/8.0c261cf2.js"><link rel="prefetch" href="/assets/js/80.7cf435bf.js"><link rel="prefetch" href="/assets/js/81.fa33b2af.js"><link rel="prefetch" href="/assets/js/82.cdabd386.js"><link rel="prefetch" href="/assets/js/83.879fc50c.js"><link rel="prefetch" href="/assets/js/84.7e460788.js"><link rel="prefetch" href="/assets/js/85.339356d5.js"><link rel="prefetch" href="/assets/js/86.d526418c.js"><link rel="prefetch" href="/assets/js/87.12877e38.js"><link rel="prefetch" href="/assets/js/88.d5a7d193.js"><link rel="prefetch" href="/assets/js/89.2f4a62c2.js"><link rel="prefetch" href="/assets/js/9.50eda380.js"><link rel="prefetch" href="/assets/js/90.6d83f5bf.js"><link rel="prefetch" href="/assets/js/91.f3364825.js"><link rel="prefetch" href="/assets/js/92.158fcc7a.js"><link rel="prefetch" href="/assets/js/93.0c4e5f88.js"><link rel="prefetch" href="/assets/js/94.c5725f80.js"><link rel="prefetch" href="/assets/js/95.dc61d501.js"><link rel="prefetch" href="/assets/js/97.712aa8be.js"><link rel="prefetch" href="/assets/js/98.e757fe7a.js"><link rel="prefetch" href="/assets/js/99.1418024a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SUCKED BloG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/question/04redis/#redis多数据类型-使用-底层" class="sidebar-link">Redis多数据类型 使用+底层</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#redis-io模型" class="sidebar-link">Redis IO模型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#说一下redis在项目中的应用场景" class="sidebar-link">说一下redis在项目中的应用场景？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#遇到过缓存穿透吗-详细描述一下。" class="sidebar-link">遇到过缓存穿透吗？详细描述一下。</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#缓存击穿" class="sidebar-link">缓存击穿</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#缓存雪崩" class="sidebar-link">缓存雪崩</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#redis是怎么删除过期key的" class="sidebar-link">Redis是怎么删除过期key的？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#缓存是如何淘汰的" class="sidebar-link">缓存是如何淘汰的</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#如何进行缓存预热" class="sidebar-link">如何进行缓存预热？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#数据库与缓存不一致如何解决" class="sidebar-link">数据库与缓存不一致如何解决？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/04redis/#简述一下主从不一致的问题" class="sidebar-link">简述一下主从不一致的问题？</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <p><strong>概念</strong>: 高性能, 内存数据库缓存</p> <h4 id="对比memcached"><a href="#对比memcached" class="header-anchor">#</a> 对比memcached</h4> <p>稍微重量级, 支持的类型和api操作更多, 支持持久化</p> <h2 id="redis多数据类型-使用-底层"><a href="#redis多数据类型-使用-底层" class="header-anchor">#</a> Redis多数据类型 使用+底层</h2> <h2 id="redis-io模型"><a href="#redis-io模型" class="header-anchor">#</a> Redis IO模型</h2> <ul><li>单线程的worker, 保证了指令顺序执行</li> <li>6.x之后引入多线程的</li></ul> <h2 id="说一下redis在项目中的应用场景"><a href="#说一下redis在项目中的应用场景" class="header-anchor">#</a> 说一下redis在项目中的应用场景？</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，5大value类型：zset, set, list, hash, 根据我的redis课有场景的介绍
2，基本上就是用作缓存~！
3，存session, 验证码.. 为的是服务无状态，延申思考，看你的项目有哪些数据结构或对象，在单机里需要单机锁，在多机需要分布式锁，抽出来放入redis中；
4，对于大企业而言, 更重要的是业务无锁化
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li><p>redis是单线程还是多线程？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，无论什么版本，工作线程就是一个
2，6.x高版本出现了IO多线程
3，使用上来说，没有变化
------
3，[去学一下系统IO课]，你要真正的理解面向IO模型编程的时候，有内核的事，从内核把数据搬运到程序里这是第一步，然后，搬运回来的数据做的计算式第二步，netty
4，单线程，满足redis的串行原子，只不过IO多线程后，把输入/输出放到更多的线程里去并行，好处如下：1，执行时间缩短，更快；2，更好的压榨系统及硬件的资源(网卡能够高效的使用)；
*，客户端被读取的顺序不能被保障, 在一个连接里的顺序可以保证
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>redis存在线程安全的问题吗？为什么？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>重复2中的单线程串行
redis可以保障内部串行
外界使用的时候要保障，业务上要自行保障顺序~！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h2 id="遇到过缓存穿透吗-详细描述一下。"><a href="#遇到过缓存穿透吗-详细描述一下。" class="header-anchor">#</a> 遇到过缓存穿透吗？详细描述一下。</h2> <p>无值数据频繁访问: 解决: key null; 布隆过滤器; 加分布式锁;</p> <h2 id="缓存击穿"><a href="#缓存击穿" class="header-anchor">#</a> 缓存击穿</h2> <p>热点数据打到数据库(可能是过期,可能是初始状态下访问); 加锁;</p> <h2 id="缓存雪崩"><a href="#缓存雪崩" class="header-anchor">#</a> 缓存雪崩</h2> <p>大量的key失效, 并且高并发访问; 不同的key, 需要用自己的锁, 细化锁粒度;</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>以上问题，核心就是避免DB无效/重复请求，结合图去理解
涉及一些架构思想上的提升
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="redis是怎么删除过期key的"><a href="#redis是怎么删除过期key的" class="header-anchor">#</a> Redis是怎么删除过期key的？</h2> <ol><li><p>缓存如何回收的？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，后台在轮询，分段分批的删除哪些过期的key (定期删除)
2，请求的时候判断时候已经过期了 (惰性删除)
尽量的把内存无用空间回收回来~！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h2 id="缓存是如何淘汰的"><a href="#缓存是如何淘汰的" class="header-anchor">#</a> 缓存是如何淘汰的</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>0，内存空间不足的情况下：
1，淘汰机制里有不允许淘汰
2，lru/lfu/random/TTL
3，全空间淘汰
4，设置过过期的key的集合中淘汰
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="如何进行缓存预热"><a href="#如何进行缓存预热" class="header-anchor">#</a> 如何进行缓存预热？</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，提前把数据塞入redis，(你知道那些是热数据吗？肯定不知道，会造成上线很多数据没有缓存命中)
2，开发逻辑上也要规避差集(你没缓存的,没猜到的热点数据)，会造成击穿，穿透，雪崩，实施456中的锁方案
3，一劳永逸，未来也不怕了
*，结合4，5，6点去看，看图理解
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="数据库与缓存不一致如何解决"><a href="#数据库与缓存不一致如何解决" class="header-anchor">#</a> 数据库与缓存不一致如何解决？</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，恶心点的，我们可以使用分布式事务来解决，（意义不大），顶多读多，写稀有情况下
结合图去思考
1，redis是缓存，更倾向于稍微的有时差(先更数据库, 再更缓存/删缓存)
2，还是减少DB的操作
3，真的要落地，咱就canal + binlog吧
背景了解: 缓存中间件本就不是用来处理数据一致性问题的---在单机状况下, 应用缓存持久化都需要经过: 应用 - pagecache - 磁盘; 一般情况下数据先保存在页缓存中, 根据操作系统的设置刷写磁盘, 此时断电仍然会丢失数据; 如果为了保证数据安全, 每次修改都fsync, 则性能会急剧下降;
*即便单机的情况下都有数据不一致的问题, 就算分布式下保证数据一致又有什么用...
*扩展: 超大型项目将写操作放入MQ,再由mysql和redis消费,并将架构封装成中台,对开发人员透明
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="简述一下主从不一致的问题"><a href="#简述一下主从不一致的问题" class="header-anchor">#</a> 简述一下主从不一致的问题？</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，redis的确默认是弱一致性，异步的同步
2，锁不能用主从(单实例/分片集群/redlock)==&gt;redisson
3，在配置中提供了必须有多少个Client连接能同步，你可以配置同步因子，趋向于强制一性
4，wait 2 0  小心
5，34点就有点违背redis的初衷了
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li><p>描述一下redis持久化原理？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>当前线程阻塞服务 不聊
异步后台进程完成持久
fork(进程) + copyonwrite
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>Redis有哪些持久化方式？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，RDB，AOF；主从同步也算持久化；
2，高版本：开启AOF，AOF是可以通过执行日志得到全部内存数据的方式，但是追求性能：
2.1，体积变大，重复无效指令  重写，后台用线程把内存的kv生成指令写个新的aof
2.2，4.x 新增更有性能模式：把重写方式换成直接RDB放到aof文件的头部，比2.1的方法快了，再追加日志
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Redis也打不住了，万级流量会打到DB上，该怎么处理？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>见456
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>redis中的事务三条指令是什么，第三条指令到达后执行失败了，怎么处理</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>见图, 失败就算失败, 其他继续执行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>为什么使用setnx？redis实现分布式锁的指令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1，好东西，原子（不存在的情况下完成创建）
2，如果要做分布式锁，就要用set k v nx ex  (不存在，过期时间，避免死锁); 或者lua脚本
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>分布式锁实现，理论：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p>首先,为什么使用Redis
硬盘太慢: 数据库数据越来越大,增删改需要维护索引,并发量大的时候带宽不足
Redis对比memcached : mem的value没有类型概念,一般存json格式的字符串;而redis可以存各种类型,并且每种类型提供了一系列操作api;Redis可以持久化;memcached更加轻量
这里会引申到redis使用epoll进行IO通信
Redis的worker是单线程的,免去加锁的过程
list: 同向命令-栈; 反向命令-队列; 阻塞队列;
set: 乱序, 去重的; 集合操作, 随机事件 SRANDMEMBER k1 1 : 随机取数,正数取去重,负数可以重复; 应用场景 抽奖
zset (sorted set): 按score排序, 去重的; 除了元素本身,还有分值维度
key的有效期: set mutex 123 NX PX 30000 (设置过期时间30秒) 过期时间不会随着被访问到而延长, 一旦发生写,剔除过期时间
redis的过期策略: 定期删除+懒删除: 1.首先遍历每个db进行定期删除,按照比例删除一部分key,保证过程中不占用太多资源 2.访问key时顺便查看过期时间,如果过期直接删除</p> <p>-- redis管道
-- 消息订阅: publish channel hello 发布; SUBSCRIBE channel 订阅; &quot;聊天室&quot;架构: 发布订阅处理实时,sorted_set处理热点,数据库存储全量
-- redis事务: multi开启, exec提交, 先提交的整个事务先生效; WATCH: CAS监控.如果事务中需要操作的对象期间被别的任务所更改,相关事务不会被执行,但不支持回滚
-- redis不支持回滚: redis事务失败时不回滚,而是执行后续命令; 1.因为redis只会因语法失败 2.保证redis的简单,快速</p> <p>第一：Redis 核心数据结构都有哪些？String类型都有哪些特点？
String,bitmap,list,hash,set,zset(sorted set)
String特点: 二进制安全的字符串, 数值计算incr, 原子操作setnx, 设置ttl存活时间, 截取字符串, 正反向索引
二进制安全: 通过字节流交互,编码不影响数据存储,底层按字节存储,STRLEN计算字节数量,一个数字1字节,UTF-8中文3字节</p> <p>第二：Redis值类型中 hash 和 string 有什么区别呢？实际工作中如何选择？
hash是一个string类型的kv映射表, 更适合存储object, 当需要存储一个对象, 并且该对象有较多属性, 如果属性还有修改的需求, 推荐使用hash存储</p> <p>第三：Redis 持久化是如何工作的？Redis在持久化过程中和可以对外服务么？如果可以的话，Redis又是如何处理新命令的？
RDB(redis db快照)和AOF(appendonly file日志)
RDB: 生成指定时间的整个redis的快照 - 命令save(阻塞,不提供服务)和bgsave(子线程,非阻塞); copyonwrite机制, 配置文件是使用bgsave
AOF: 将redis的写操作记录到文件中(类似于mysql的binlog) - fsync,由操作系统/每秒/每次 进行持久化
可以提供对外服务吗 - save不可以, bgsave可以
在fork子进程的时候,只拷贝指针,如果遇到写操作,将操作数据复制一份给子进程,子进程持久化,父进程提供服务</p> <p>第四：Redis 持久化方式Rdb和Aof的优缺点
RDB特点: 1.不支持拉链,只有一个dump.rdb,需要运维拉版本; 2.丢失数据相对AOF多; 3.java序列化,恢复速度较快
AOF特点: 1.丢失数据相对少 2.AOF较RDB优先恢复 3.日志追加导致日志不断,恢复速度慢 4.redis4.0开始RDB+AOF混合使用
重写: 为了解决AOF的日志无限增加,合并重复的命令(4.0开始RDB+AOF混合使用)
重写的两个参数: 1.当AOF文件大小超过了上次重写的文件大小的百分之多少时进行重写 2.文件大小超过多少才允许重写</p> <p>第五：Redis 内存不够时，如何处理新的请求？
提供了6种淘汰策略 volatile-lru volatile-ttl volatile-random allkeys-lru allkeys-random noeviction
volatile是在过期时间的key中选择 allkeys是全部key中选择 lru移除最久未使用的 random完全随机 ttl选择最先过期的
noeviction 不移除任何数据,返回一个写错误,如果其他命令最终没有适合移除的key,同样返回错误</p> <p>第六：Redis 是如何处理过期数据的？
redis的过期策略: 定期删除+懒删除: 1.首先遍历每个db进行定期删除,按照策略删除一部分key,保证过程中不占用太多资源 2.访问key时顺便查看过期时间,如果过期直接删除
--具体流程是,随机抽样(expire字典表中)一些(10还是20)key,过期的key在抽样中如果超过25%,进行下一轮抽样和删除,直到低于25%</p> <p>第七：Redis 内存淘汰算法 LRU/ LFU 可以讲一下原理么？
LRU: 最久未使用. 双向链表(根据使用情况排序) + 哈希表(用来存储和查找)
LFU: 最小访问频率, 小顶堆(按频率排序) + 哈希表(用来存储和查找), LeetCode中使用双hash表实现
但是redis的LRU实现是在每个key中维护一个时间戳(24位),找到距离当前时间最久的key进行淘汰,即便如此还是在随机取样的N个key中进行淘汰
redis的LFU把24位记录分成 16(时间戳)+ 8(访问频率), redis会根据最近使用时间和访问频率两个条件进行评估后再进行淘汰</p> <p>第八：Redis 有序数据结构zset底层原理有了解过么？
跳跃表/跳表 skip list;
zset还使用了ziplist(压缩过的链表数组)和dict(map)
为什么使用跳表而不是树? 跳表速度不慢,相比平衡树范围查询更方便; 平衡树的实现更复杂,尤其是树的结构变化
作者说, 1.skiplist比btree消耗内存更少 2.范围查询时跳表的性能很好 3.更容易实现</p> <p>第九：Redis 位图应用场景及实现原理可以讲一下么？
bitmap数据类型, 操作:setbit getbit bitpos bitcount(二进制统计) bitop(与或操作)
setbit k1 1 1 :按字节存储 00000000 -&gt; 01000000 也就是ASCII的@符号
setbit k1 7 1 : 01000000 -&gt; 01000001 也就是字符A
bitcount 0 0 (统计第1个字节bit为1的个数)下标是按字节读取而不是位
使用场景1: 统计用户登录天数: setbit tom 0 1 ; setbit tom 364 1 : 代表tom这年第一天和第365天登录了, 比如 bitcount -1 -2 : 最后16天的登录情况
使用场景2: 统计某天/某时间窗口的用户登录数量: setbit 20200909 1 1 : 表示这一天1号用户登录过; bitop or destkey 20200909 20200910 进行或运算取这两天的交集,再通过bitcount 0 -1计算这段时间内登录过的(去重的)用户数量</p> <p>第十：Redis 的缓存穿透/缓存雪崩/缓存重建/这类问题，可以讲讲么
缓存穿透: 从前端接受的查询是你系统根本不存在的数据,通过布隆过滤器解决,或者布谷鸟过滤器,空key
空key: 将不存在的数据缓存空key: 1.占内存 2.如果此时数据库加上了这个key会导致数据不一致
布隆过滤器: 用小空间解决大量数据匹配的问题
首先将数据库中所有数据用过算法映射到一张bitmap中, 如果要查询的key经过同样算法映射到bitmap没有数据的位置,说明key不存在
特点在于: 通过计算和bitmap进行有效过滤,但数据库频繁修改会带来bitmap同步问题</p> <p>缓存击穿(热点数据集中失效): key不存在(过期或是LRU/LFU清理掉了),大量同key请求访问数据库
1.对于热点key的大量请求,加锁,只允许一个请求去数据库查询,其他请求进入等待,把结果更新回到redis后,才允许其他请求访问
这会有很多问题(分布式协调问题),拿到锁的请求挂了导致死锁;访问数据库超时;但是数据一致性可以得到保证;
2.设置key永不超时(或者说预先更新缓存),启动单独的线程构建缓存.(根本避免危害,但无法保证强一致性,代码复杂度增加)</p> <p>缓存雪崩: 大量的访问到达数据库.(缓存直接down或大量key同时失效)
其次对于雪崩: 主要思路 1.防止key的同时大量失效,参考击穿 2.限流
1.设置随机过期时间防止key同时失效 2.客户端限流,避免大量请求(Hystrix) 3.redis集群保证可用性</p> <p>缓存重建: 缓存击穿时如何重建缓存, 1.加锁 2.设置key永不超时</p> <p>第十二：Redis 单线程和Redis6.0 的多线程是如何工作的？
6.0以后提供了IO thread, 计算worker依旧还单线程, 但是和客户端之间的IO读写是多线程的(每个IO/客户端都可以保证他的指令是有序的)</p> <p>单点故障,容量有限,压力过大/Redis Cluster/缓存一致性
集群,主从,选举,哨兵</p> <p>主从复制: 主机数据更新后,自动同步到从机,master写,slaver读. slaveof [ip] [port]; 增量复制队列大小设置; AKF的x轴
问题: 1.从机意外关闭,重启后增量添加丢失数据; 2.主机意外关闭,从机还是只读,从机需要slaveof no one; 3.单点故障需要人工维护;
哨兵: 替代人工维护解决单点故障,实现高可用. --sentinel,所有哨兵在master上发布消息,互相发现;
主观下线(单机做出的下线判断SDOWN)和客观下线(多个哨兵对同一个服务器判断并经过交流之后SDOWN-&gt; ODOWN)
定期任务: 1.每秒向所有主服务器/从服务器/哨兵发送PING命令 2.如果指定时间窗口内一直无效返回,被视为SDOWN 3.达到指定数量的哨兵对服务器SDOWN,则标记客观下线
4.客观下线后对这个客观下线主服务器的从服务器加快INFO的发送频率(10s-&gt;1s) 5.没有足够数量的哨兵同意主服务器下线,客观下线状态会被移除
6.主服务器下线后,哨兵进行投票,完成故障转移后,哨兵自动修改自己的配置文件
故障转移: 1.主机客观下线 2.对当前纪元(Epoch)自增,尝试在这个纪元中当选 3.重复当选 4.选出一个从机,升级为主机 5.发布配置给其他哨兵,让其他从机SLAVEOF新主机
哨兵选择主机规则: 从机两轮淘汰-&gt;复制偏移量-&gt;最小运行ID</p> <p>第十一：Redis 集群分片原理是怎样的？
集群分片: 将数据分发到不同的redis, 每个redis存储所有key的一个子集; 缺点: 1.不支持多key操作比如求交集 2.不支持多key的事务 3.备份文件复杂 4.扩容缩容较复杂
原理:
分区方法: 范围分区,哈希,一致性哈希,哈希槽
一致性哈希算法: 哈希环,将节点均摊到环的各处,新加入的元素映射到环的某个位置,经过顺时针寻找到第一个节点位置,进行存储;
特点: 1.容错性好,一个节点挂了可以由下个节点承担 2.扩展性好,可以随时加节点 3.虽然容错和扩展好,但是需要缓存重建 4.容易出现数据倾斜(优化:虚拟节点细分)
redis哈希槽: redis包含16384个哈希槽,将这些槽自定义分配到各个主机上;扩展时只要把槽位转移给新主机负责就可以(容错同理)
分区实现方案: 客户端分区,代理分区,查询路由
查询路由: 请求由redis转发(重定向)到正确的redis节点
代理层分片: twemproxy, 代理层实现的分片
redis预分片: 先搞个几十个redis实例分片,到时候新加服务器只要把其中一部分拿到新的服务器就行了</p> <p>缓存一致性
mysql和redis的一致性: 1.更新mysql先删redis,加锁,再更新redis 2.mysql的binlog增量订阅-消息队列-redis消费(最终一致性)
redis集群的一致性: 1.redis保证最终一致性,保证高吞吐量 2.主机挂了,数据未同步到从机,会出现数据丢失</p> <p>Redis作为分布式锁: 1.set nx 2.设置过期时间 3.多线程监控,延长过期时间</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/10/2021, 7:36:08 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.42575a28.js" defer></script><script src="/assets/js/2.0d7d09b8.js" defer></script><script src="/assets/js/96.3a598fc5.js" defer></script>
  </body>
</html>
