<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概述 | SUCKED BloG</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.42575a28.js" as="script"><link rel="preload" href="/assets/js/2.0d7d09b8.js" as="script"><link rel="preload" href="/assets/js/25.244a12a8.js" as="script"><link rel="prefetch" href="/assets/js/10.1a30ebe5.js"><link rel="prefetch" href="/assets/js/100.022f696a.js"><link rel="prefetch" href="/assets/js/101.06eb0acb.js"><link rel="prefetch" href="/assets/js/102.e944c220.js"><link rel="prefetch" href="/assets/js/103.45b9da9a.js"><link rel="prefetch" href="/assets/js/104.cf53f5d1.js"><link rel="prefetch" href="/assets/js/105.200d7fe5.js"><link rel="prefetch" href="/assets/js/106.a0cc3502.js"><link rel="prefetch" href="/assets/js/107.4a71d17e.js"><link rel="prefetch" href="/assets/js/108.d7a39a75.js"><link rel="prefetch" href="/assets/js/109.35619cf9.js"><link rel="prefetch" href="/assets/js/11.f78ae8b3.js"><link rel="prefetch" href="/assets/js/110.f667d72e.js"><link rel="prefetch" href="/assets/js/111.de83ce6f.js"><link rel="prefetch" href="/assets/js/112.417d40bf.js"><link rel="prefetch" href="/assets/js/113.0f26c1ca.js"><link rel="prefetch" href="/assets/js/114.c7014acb.js"><link rel="prefetch" href="/assets/js/115.b502c0f1.js"><link rel="prefetch" href="/assets/js/116.10fb230e.js"><link rel="prefetch" href="/assets/js/117.f7cb9e2a.js"><link rel="prefetch" href="/assets/js/118.978d3075.js"><link rel="prefetch" href="/assets/js/119.09272191.js"><link rel="prefetch" href="/assets/js/12.140aa2af.js"><link rel="prefetch" href="/assets/js/120.32b5dbd7.js"><link rel="prefetch" href="/assets/js/121.8d618bbb.js"><link rel="prefetch" href="/assets/js/122.dcd4190d.js"><link rel="prefetch" href="/assets/js/123.2ee061d1.js"><link rel="prefetch" href="/assets/js/124.5a3760a7.js"><link rel="prefetch" href="/assets/js/125.a874a4bc.js"><link rel="prefetch" href="/assets/js/126.c6c6b7e6.js"><link rel="prefetch" href="/assets/js/127.38c35051.js"><link rel="prefetch" href="/assets/js/128.8d775ac8.js"><link rel="prefetch" href="/assets/js/129.6100ddb1.js"><link rel="prefetch" href="/assets/js/13.b2a6e590.js"><link rel="prefetch" href="/assets/js/130.9a83da2a.js"><link rel="prefetch" href="/assets/js/131.22de7670.js"><link rel="prefetch" href="/assets/js/132.f88798bf.js"><link rel="prefetch" href="/assets/js/133.925bbfed.js"><link rel="prefetch" href="/assets/js/134.481fad71.js"><link rel="prefetch" href="/assets/js/135.c3efb09b.js"><link rel="prefetch" href="/assets/js/136.758c447a.js"><link rel="prefetch" href="/assets/js/137.dcde1032.js"><link rel="prefetch" href="/assets/js/138.616a346b.js"><link rel="prefetch" href="/assets/js/139.b58dd07f.js"><link rel="prefetch" href="/assets/js/14.15374560.js"><link rel="prefetch" href="/assets/js/140.62b4c7ea.js"><link rel="prefetch" href="/assets/js/15.ffd155fa.js"><link rel="prefetch" href="/assets/js/16.feb1b022.js"><link rel="prefetch" href="/assets/js/17.6d491eb6.js"><link rel="prefetch" href="/assets/js/18.03ddaa95.js"><link rel="prefetch" href="/assets/js/19.021bbcc8.js"><link rel="prefetch" href="/assets/js/20.8aa708b0.js"><link rel="prefetch" href="/assets/js/21.59d7a21e.js"><link rel="prefetch" href="/assets/js/22.21597439.js"><link rel="prefetch" href="/assets/js/23.77303f0b.js"><link rel="prefetch" href="/assets/js/24.0789ed5b.js"><link rel="prefetch" href="/assets/js/26.a6ee95e4.js"><link rel="prefetch" href="/assets/js/27.9e0f0e9d.js"><link rel="prefetch" href="/assets/js/28.189031c5.js"><link rel="prefetch" href="/assets/js/29.b3100d33.js"><link rel="prefetch" href="/assets/js/3.2a5d4cd5.js"><link rel="prefetch" href="/assets/js/30.fe8fe8c0.js"><link rel="prefetch" href="/assets/js/31.86fec3f7.js"><link rel="prefetch" href="/assets/js/32.24cac061.js"><link rel="prefetch" href="/assets/js/33.f1db2ed0.js"><link rel="prefetch" href="/assets/js/34.c220692f.js"><link rel="prefetch" href="/assets/js/35.9e7b4779.js"><link rel="prefetch" href="/assets/js/36.0cb1d1bc.js"><link rel="prefetch" href="/assets/js/37.7d1fcf79.js"><link rel="prefetch" href="/assets/js/38.bc9bc4b3.js"><link rel="prefetch" href="/assets/js/39.10801a2a.js"><link rel="prefetch" href="/assets/js/4.b4d9a5aa.js"><link rel="prefetch" href="/assets/js/40.c980543d.js"><link rel="prefetch" href="/assets/js/41.3f4581d8.js"><link rel="prefetch" href="/assets/js/42.60b85cdf.js"><link rel="prefetch" href="/assets/js/43.1338528d.js"><link rel="prefetch" href="/assets/js/44.786fc51f.js"><link rel="prefetch" href="/assets/js/45.d65f6744.js"><link rel="prefetch" href="/assets/js/46.543c2b26.js"><link rel="prefetch" href="/assets/js/47.59f19ed2.js"><link rel="prefetch" href="/assets/js/48.60de6b25.js"><link rel="prefetch" href="/assets/js/49.f3df62ef.js"><link rel="prefetch" href="/assets/js/5.013522c1.js"><link rel="prefetch" href="/assets/js/50.fd9871d6.js"><link rel="prefetch" href="/assets/js/51.1fb1863e.js"><link rel="prefetch" href="/assets/js/52.c06ce3f3.js"><link rel="prefetch" href="/assets/js/53.a3d55203.js"><link rel="prefetch" href="/assets/js/54.89ac64bc.js"><link rel="prefetch" href="/assets/js/55.ccf38d1e.js"><link rel="prefetch" href="/assets/js/56.ffb8595b.js"><link rel="prefetch" href="/assets/js/57.5f1bd695.js"><link rel="prefetch" href="/assets/js/58.7463616d.js"><link rel="prefetch" href="/assets/js/59.ea4eb5dd.js"><link rel="prefetch" href="/assets/js/6.72ad7c85.js"><link rel="prefetch" href="/assets/js/60.a2add219.js"><link rel="prefetch" href="/assets/js/61.3eae0362.js"><link rel="prefetch" href="/assets/js/62.801d1658.js"><link rel="prefetch" href="/assets/js/63.b47a17bb.js"><link rel="prefetch" href="/assets/js/64.d5e2bdea.js"><link rel="prefetch" href="/assets/js/65.24d540f4.js"><link rel="prefetch" href="/assets/js/66.09a1ae52.js"><link rel="prefetch" href="/assets/js/67.75bd38e7.js"><link rel="prefetch" href="/assets/js/68.1fe6956e.js"><link rel="prefetch" href="/assets/js/69.d3306c2d.js"><link rel="prefetch" href="/assets/js/7.60760bb7.js"><link rel="prefetch" href="/assets/js/70.95aa4503.js"><link rel="prefetch" href="/assets/js/71.7065ebf0.js"><link rel="prefetch" href="/assets/js/72.55ae5081.js"><link rel="prefetch" href="/assets/js/73.c7624eee.js"><link rel="prefetch" href="/assets/js/74.63bcc7bd.js"><link rel="prefetch" href="/assets/js/75.e2731e20.js"><link rel="prefetch" href="/assets/js/76.1711af80.js"><link rel="prefetch" href="/assets/js/77.f1c4e2d3.js"><link rel="prefetch" href="/assets/js/78.900bc856.js"><link rel="prefetch" href="/assets/js/79.a1b8c47b.js"><link rel="prefetch" href="/assets/js/8.0c261cf2.js"><link rel="prefetch" href="/assets/js/80.7cf435bf.js"><link rel="prefetch" href="/assets/js/81.fa33b2af.js"><link rel="prefetch" href="/assets/js/82.cdabd386.js"><link rel="prefetch" href="/assets/js/83.879fc50c.js"><link rel="prefetch" href="/assets/js/84.7e460788.js"><link rel="prefetch" href="/assets/js/85.339356d5.js"><link rel="prefetch" href="/assets/js/86.d526418c.js"><link rel="prefetch" href="/assets/js/87.12877e38.js"><link rel="prefetch" href="/assets/js/88.d5a7d193.js"><link rel="prefetch" href="/assets/js/89.2f4a62c2.js"><link rel="prefetch" href="/assets/js/9.50eda380.js"><link rel="prefetch" href="/assets/js/90.6d83f5bf.js"><link rel="prefetch" href="/assets/js/91.f3364825.js"><link rel="prefetch" href="/assets/js/92.158fcc7a.js"><link rel="prefetch" href="/assets/js/93.0c4e5f88.js"><link rel="prefetch" href="/assets/js/94.c5725f80.js"><link rel="prefetch" href="/assets/js/95.dc61d501.js"><link rel="prefetch" href="/assets/js/96.3a598fc5.js"><link rel="prefetch" href="/assets/js/97.712aa8be.js"><link rel="prefetch" href="/assets/js/98.e757fe7a.js"><link rel="prefetch" href="/assets/js/99.1418024a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SUCKED BloG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>概述</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h4 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h4> <blockquote><p>NGINX redis netty tomcat</p> <p>网络IO, socket IO, 文件系统IO</p> <p>API使用, 底层封装, java的io到nio的过程</p> <p>BIO, NIO, 多路复用器, AIO</p> <p>Netty现在是多路复用器, 在等linux的AIO</p></blockquote> <h4 id="安装jdk1-4问题"><a href="#安装jdk1-4问题" class="header-anchor">#</a> 安装jdk1.4问题</h4> <blockquote><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/lib/ld-linux.so.2: bad ELF interpreter: 没有那个文件或目录
<span class="token function">sudo</span> yum <span class="token function">install</span> ld-linux.so.2  <span class="token comment">#即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></blockquote> <h4 id="测试java-bio"><a href="#测试java-bio" class="header-anchor">#</a> 测试java BIO</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">strace</span> <span class="token comment">#linux指令, 把用户程序在执行时内核的系统调用</span>
<span class="token function">strace</span> -ff -o out /opt/j2sdk1.4.2_19/bin/java *.java
-ff <span class="token comment">#把每个线程都跟踪到</span>
-o out	<span class="token comment">#把追踪日志写到out开头的文件中</span>

<span class="token function">netstat</span> -natp	<span class="token comment">#查看网络状态 -t tcp</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>启动后, 新建了8个文件前缀为out的文件, 代表了创建的8个线程</p> <p>查看日志, 搜索端口号(8090), 看到</p></blockquote> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># socket 创建socket 3 并返回 , java中的创建socket最终是这个系统调用</span>
socket(AF_INET6<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> IPPROTO_IP) = 3
setsockopt(3<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_REUSEADDR<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 4) = 0
<span class="token comment"># bind 绑定socket 3 绑定端口为8090 = 绑定成功</span>
bind(3<span class="token punctuation">,</span> <span class="token punctuation">{</span>sa_family=AF_INET6<span class="token punctuation">,</span> sin6_port=htons(8090)<span class="token punctuation">,</span> inet_pton(AF_INET6<span class="token punctuation">,</span> <span class="token string">&quot;::&quot;</span><span class="token punctuation">,</span> <span class="token important">&amp;sin6_addr)</span><span class="token punctuation">,</span> sin6_flowinfo=0<span class="token punctuation">,</span> sin6_scope_id=0<span class="token punctuation">}</span><span class="token punctuation">,</span> 24) = 0
listen(3<span class="token punctuation">,</span> 20) = 0
<span class="token comment"># 打印 1是标准输出</span>
write(1<span class="token punctuation">,</span> <span class="token string">&quot;step01 : new ServerSocket(8090)&quot;</span><span class="token punctuation">,</span> 31) = 31
write(1<span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> 1) = 1
<span class="token punctuation">...</span>
<span class="token comment"># 阻塞, 也就是 socket.accept(); 对象调方法, 函数里处理谁</span>
accept(3<span class="token punctuation">,</span> 
<span class="token comment"># 以上每行是 系统的调用 = 返回对象</span>

man 2 socket <span class="token comment"># 指令查看2类系统调用下的 函数socket的源码 可以看下RETURN VALUE </span>
lsof <span class="token punctuation">-</span>p 25659	<span class="token comment"># 显示打开的文件 -p 进程id</span>
<span class="token comment"># 25659 java程序 3u u表示读写都可以 3监听 8090</span>
java 25659 root 3u IPv6 1260686 0t0 TCP <span class="token important">*:8090</span> (LISTEN)

tail <span class="token punctuation">-</span>f out.25659	<span class="token comment"># 使用tail跟踪</span>
nc localhost 8090	<span class="token comment"># 连接本机8090端口, 连接后查看日志变化</span>
<span class="token comment"># accept返回了5, 也就是客户端描述符</span>
accept(3<span class="token punctuation">,</span> <span class="token punctuation">{</span>sa_family=AF_INET6<span class="token punctuation">,</span> sin6_port=htons(45410)<span class="token punctuation">,</span> inet_pton(AF_INET6<span class="token punctuation">,</span> <span class="token string">&quot;::1&quot;</span><span class="token punctuation">,</span> <span class="token important">&amp;sin6_addr)</span><span class="token punctuation">,</span> sin6_flowinfo=0<span class="token punctuation">,</span> sin6_scope_id=0<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span>) = 5
lsof <span class="token punctuation">-</span>p 25659	<span class="token comment"># 创建了客户端 5 ESTABLISHED</span>
java 25659 root 5u IPv6 1259878 0t0 TCP localhost<span class="token punctuation">:</span>8090<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>localhost<span class="token punctuation">:</span>45410 (ESTABLISHED)
<span class="token punctuation">...</span>
clone(child_stack<span class="token punctuation">...</span>child_tidptr=0xea158ba8) = 26485
<span class="token comment"># java的new thread().start() 会调用clone, 中间传递一些如vm,文件,内存空间等信息, 返回新的线程ID 26485</span>
<span class="token comment"># java中的线程是不是内核级的进程或线程 -是,java中的线程就是操作系统的线程或轻量级进程</span>
cd /proc/26659/task	<span class="token comment"># 查看进程及其线程(轻量级进程)</span>
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25659
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25660
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25661
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25662
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25663
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25664
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25665
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 25666
dr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>xr<span class="token punctuation">-</span>x. 7 root root 0 7月   3 19<span class="token punctuation">:</span>25 26485
<span class="token comment"># 为什么使用clone, 共享内存堆空间, 线程栈/进程栈是隔离的, 只能在一个CPU上跑</span>
less <span class="token punctuation">-</span>N out.26485	<span class="token comment"># 查看</span>
recv(5<span class="token punctuation">,</span>
<span class="token comment"># 阻塞接受, 客户端5的行为, 客户端发送 ooxx</span>
<span class="token comment"># 接收到行为, 并继续阻塞</span>
recv(5<span class="token punctuation">,</span> <span class="token string">&quot;ooxx\n&quot;</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">,</span> 0) = 5
ioctl(5<span class="token punctuation">,</span> FIONREAD<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>) = 0
write(1<span class="token punctuation">,</span> <span class="token string">&quot;ooxx&quot;</span><span class="token punctuation">,</span> 4) = 4
write(1<span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> 1) = 1
recv(5<span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h4 id="总结-bio"><a href="#总结-bio" class="header-anchor">#</a> 总结, BIO</h4> <blockquote><p>监听 - 接收/阻塞 - 返回 5 - 克隆线程 - 继续接收/阻塞</p> <div class="language- extra-class"><pre><code>  											|-- recv/阻塞
</code></pre></div><p>BIO弊端</p> <p>每连接 每线程, 一一对应, 连接数多的时候</p> <p>C10K问题, 如果服务器接收1万连接</p> <p>此时需要10000个线程(进程), CPU调度压力很大, 浪费资源</p> <p>弊端来源于阻塞, 因为所有上级应用都是调用内核, 需要内核支持非阻塞的能力</p></blockquote> <h4 id="nio"><a href="#nio" class="header-anchor">#</a> NIO</h4> <blockquote><p>NIO 就是 accept, read, write 返回 -1 不会卡住</p> <p>不需要新建线程了</p> <p>accept后 返回 5 或 -1 如果是 5 就放进链表里面反复读取</p> <p>read 5 返回 N个字节 0 或 -1 断开链接 分别处理即可</p> <p>C10K 只在一个线程里面, 或分成一个线程接收装进list, 数个线程分片遍历list (netty的boss和work模型)</p> <p>弊端 1线程 C10K 问题</p> <p>调用的过程, 用户态, 内核态 切换, 保护现场(计组), 假设1万个连接, 1个发来数据, 一个循环里全量遍历(系统调用)O(n)造成9999个浪费</p> <p>实际上是程序和内核的调用太远, 需要较高的代价</p></blockquote> <h4 id="多路复用器-select-poll-epoll"><a href="#多路复用器-select-poll-epoll" class="header-anchor">#</a> 多路复用器 select poll epoll</h4> <blockquote><p>内核的select系统调用, 传参读, 写, 事件, 允许</p> <p><code>man 2 select</code></p> <p>先监听, 程序调用</p> <p>select(3) , 询问有没有连接?</p> <p>accept(3) = 5 如果有连接, 返回 5</p> <p>select(3, 5), 继续询问有没有连接, 且有没有数据?</p> <p>如果有数据到达, 连接</p> <p>accept(3) = 6, recv(5) .. 再将5放入select循环</p> <p>select 传参数据量限制 1024fd</p> <p>弊端</p> <p>每次循环重复传递数据</p> <p>每次调用内核需要遍历参数</p> <p>让内核开辟空间存储参数</p></blockquote> <h4 id="epoll"><a href="#epoll" class="header-anchor">#</a> epoll</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">man</span> <span class="token number">2</span> epoll_create 
epoll_create	<span class="token comment"># 开辟内存空间, 返回id(内存空间)</span>
epoll_ctl		<span class="token comment"># 对指定id的内存空间, 控制需要监听的对象, 监听的事件</span>
epoll_wait		<span class="token comment"># 对指定id放置事件集合并返回使用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <blockquote><p>多路复用器只能给application返回状态</p> <p>不能够读取数据, 程序自己需要调用rw IO</p> <p>同步IO模型/IO同步模型, 无论是在当前线程还是其他线程, 都是application自己读写, 分为BIO NIO</p> <p>异步IO模型, 没有阻塞, 调用了内核的方法并有回调函数, 内核帮你读写IO, application直接得到数据, 如WIN的IOCP</p> <p>java nio 中的 selector 是linux的多路复用器(select poll epoll)</p> <p>默认优先使用内核支持的, 启动时配置参数选择使用哪个多路复用器, 所有网络IO应用都是一样</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/12/2021, 5:58:39 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.42575a28.js" defer></script><script src="/assets/js/2.0d7d09b8.js" defer></script><script src="/assets/js/25.244a12a8.js" defer></script>
  </body>
</html>
