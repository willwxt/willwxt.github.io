<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM | SUCKED BloG</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.42575a28.js" as="script"><link rel="preload" href="/assets/js/2.0d7d09b8.js" as="script"><link rel="preload" href="/assets/js/27.9e0f0e9d.js" as="script"><link rel="prefetch" href="/assets/js/10.1a30ebe5.js"><link rel="prefetch" href="/assets/js/100.022f696a.js"><link rel="prefetch" href="/assets/js/101.06eb0acb.js"><link rel="prefetch" href="/assets/js/102.e944c220.js"><link rel="prefetch" href="/assets/js/103.45b9da9a.js"><link rel="prefetch" href="/assets/js/104.cf53f5d1.js"><link rel="prefetch" href="/assets/js/105.200d7fe5.js"><link rel="prefetch" href="/assets/js/106.a0cc3502.js"><link rel="prefetch" href="/assets/js/107.4a71d17e.js"><link rel="prefetch" href="/assets/js/108.d7a39a75.js"><link rel="prefetch" href="/assets/js/109.35619cf9.js"><link rel="prefetch" href="/assets/js/11.f78ae8b3.js"><link rel="prefetch" href="/assets/js/110.f667d72e.js"><link rel="prefetch" href="/assets/js/111.de83ce6f.js"><link rel="prefetch" href="/assets/js/112.417d40bf.js"><link rel="prefetch" href="/assets/js/113.0f26c1ca.js"><link rel="prefetch" href="/assets/js/114.c7014acb.js"><link rel="prefetch" href="/assets/js/115.b502c0f1.js"><link rel="prefetch" href="/assets/js/116.10fb230e.js"><link rel="prefetch" href="/assets/js/117.f7cb9e2a.js"><link rel="prefetch" href="/assets/js/118.978d3075.js"><link rel="prefetch" href="/assets/js/119.09272191.js"><link rel="prefetch" href="/assets/js/12.140aa2af.js"><link rel="prefetch" href="/assets/js/120.32b5dbd7.js"><link rel="prefetch" href="/assets/js/121.8d618bbb.js"><link rel="prefetch" href="/assets/js/122.dcd4190d.js"><link rel="prefetch" href="/assets/js/123.2ee061d1.js"><link rel="prefetch" href="/assets/js/124.5a3760a7.js"><link rel="prefetch" href="/assets/js/125.a874a4bc.js"><link rel="prefetch" href="/assets/js/126.c6c6b7e6.js"><link rel="prefetch" href="/assets/js/127.38c35051.js"><link rel="prefetch" href="/assets/js/128.8d775ac8.js"><link rel="prefetch" href="/assets/js/129.6100ddb1.js"><link rel="prefetch" href="/assets/js/13.b2a6e590.js"><link rel="prefetch" href="/assets/js/130.9a83da2a.js"><link rel="prefetch" href="/assets/js/131.22de7670.js"><link rel="prefetch" href="/assets/js/132.f88798bf.js"><link rel="prefetch" href="/assets/js/133.925bbfed.js"><link rel="prefetch" href="/assets/js/134.481fad71.js"><link rel="prefetch" href="/assets/js/135.c3efb09b.js"><link rel="prefetch" href="/assets/js/136.758c447a.js"><link rel="prefetch" href="/assets/js/137.dcde1032.js"><link rel="prefetch" href="/assets/js/138.616a346b.js"><link rel="prefetch" href="/assets/js/139.b58dd07f.js"><link rel="prefetch" href="/assets/js/14.15374560.js"><link rel="prefetch" href="/assets/js/140.62b4c7ea.js"><link rel="prefetch" href="/assets/js/15.ffd155fa.js"><link rel="prefetch" href="/assets/js/16.feb1b022.js"><link rel="prefetch" href="/assets/js/17.6d491eb6.js"><link rel="prefetch" href="/assets/js/18.03ddaa95.js"><link rel="prefetch" href="/assets/js/19.021bbcc8.js"><link rel="prefetch" href="/assets/js/20.8aa708b0.js"><link rel="prefetch" href="/assets/js/21.59d7a21e.js"><link rel="prefetch" href="/assets/js/22.21597439.js"><link rel="prefetch" href="/assets/js/23.77303f0b.js"><link rel="prefetch" href="/assets/js/24.0789ed5b.js"><link rel="prefetch" href="/assets/js/25.244a12a8.js"><link rel="prefetch" href="/assets/js/26.a6ee95e4.js"><link rel="prefetch" href="/assets/js/28.189031c5.js"><link rel="prefetch" href="/assets/js/29.b3100d33.js"><link rel="prefetch" href="/assets/js/3.2a5d4cd5.js"><link rel="prefetch" href="/assets/js/30.fe8fe8c0.js"><link rel="prefetch" href="/assets/js/31.86fec3f7.js"><link rel="prefetch" href="/assets/js/32.24cac061.js"><link rel="prefetch" href="/assets/js/33.f1db2ed0.js"><link rel="prefetch" href="/assets/js/34.c220692f.js"><link rel="prefetch" href="/assets/js/35.9e7b4779.js"><link rel="prefetch" href="/assets/js/36.0cb1d1bc.js"><link rel="prefetch" href="/assets/js/37.7d1fcf79.js"><link rel="prefetch" href="/assets/js/38.bc9bc4b3.js"><link rel="prefetch" href="/assets/js/39.10801a2a.js"><link rel="prefetch" href="/assets/js/4.b4d9a5aa.js"><link rel="prefetch" href="/assets/js/40.c980543d.js"><link rel="prefetch" href="/assets/js/41.3f4581d8.js"><link rel="prefetch" href="/assets/js/42.60b85cdf.js"><link rel="prefetch" href="/assets/js/43.1338528d.js"><link rel="prefetch" href="/assets/js/44.786fc51f.js"><link rel="prefetch" href="/assets/js/45.d65f6744.js"><link rel="prefetch" href="/assets/js/46.543c2b26.js"><link rel="prefetch" href="/assets/js/47.59f19ed2.js"><link rel="prefetch" href="/assets/js/48.60de6b25.js"><link rel="prefetch" href="/assets/js/49.f3df62ef.js"><link rel="prefetch" href="/assets/js/5.013522c1.js"><link rel="prefetch" href="/assets/js/50.fd9871d6.js"><link rel="prefetch" href="/assets/js/51.1fb1863e.js"><link rel="prefetch" href="/assets/js/52.c06ce3f3.js"><link rel="prefetch" href="/assets/js/53.a3d55203.js"><link rel="prefetch" href="/assets/js/54.89ac64bc.js"><link rel="prefetch" href="/assets/js/55.ccf38d1e.js"><link rel="prefetch" href="/assets/js/56.ffb8595b.js"><link rel="prefetch" href="/assets/js/57.5f1bd695.js"><link rel="prefetch" href="/assets/js/58.7463616d.js"><link rel="prefetch" href="/assets/js/59.ea4eb5dd.js"><link rel="prefetch" href="/assets/js/6.72ad7c85.js"><link rel="prefetch" href="/assets/js/60.a2add219.js"><link rel="prefetch" href="/assets/js/61.3eae0362.js"><link rel="prefetch" href="/assets/js/62.801d1658.js"><link rel="prefetch" href="/assets/js/63.b47a17bb.js"><link rel="prefetch" href="/assets/js/64.d5e2bdea.js"><link rel="prefetch" href="/assets/js/65.24d540f4.js"><link rel="prefetch" href="/assets/js/66.09a1ae52.js"><link rel="prefetch" href="/assets/js/67.75bd38e7.js"><link rel="prefetch" href="/assets/js/68.1fe6956e.js"><link rel="prefetch" href="/assets/js/69.d3306c2d.js"><link rel="prefetch" href="/assets/js/7.60760bb7.js"><link rel="prefetch" href="/assets/js/70.95aa4503.js"><link rel="prefetch" href="/assets/js/71.7065ebf0.js"><link rel="prefetch" href="/assets/js/72.55ae5081.js"><link rel="prefetch" href="/assets/js/73.c7624eee.js"><link rel="prefetch" href="/assets/js/74.63bcc7bd.js"><link rel="prefetch" href="/assets/js/75.e2731e20.js"><link rel="prefetch" href="/assets/js/76.1711af80.js"><link rel="prefetch" href="/assets/js/77.f1c4e2d3.js"><link rel="prefetch" href="/assets/js/78.900bc856.js"><link rel="prefetch" href="/assets/js/79.a1b8c47b.js"><link rel="prefetch" href="/assets/js/8.0c261cf2.js"><link rel="prefetch" href="/assets/js/80.7cf435bf.js"><link rel="prefetch" href="/assets/js/81.fa33b2af.js"><link rel="prefetch" href="/assets/js/82.cdabd386.js"><link rel="prefetch" href="/assets/js/83.879fc50c.js"><link rel="prefetch" href="/assets/js/84.7e460788.js"><link rel="prefetch" href="/assets/js/85.339356d5.js"><link rel="prefetch" href="/assets/js/86.d526418c.js"><link rel="prefetch" href="/assets/js/87.12877e38.js"><link rel="prefetch" href="/assets/js/88.d5a7d193.js"><link rel="prefetch" href="/assets/js/89.2f4a62c2.js"><link rel="prefetch" href="/assets/js/9.50eda380.js"><link rel="prefetch" href="/assets/js/90.6d83f5bf.js"><link rel="prefetch" href="/assets/js/91.f3364825.js"><link rel="prefetch" href="/assets/js/92.158fcc7a.js"><link rel="prefetch" href="/assets/js/93.0c4e5f88.js"><link rel="prefetch" href="/assets/js/94.c5725f80.js"><link rel="prefetch" href="/assets/js/95.dc61d501.js"><link rel="prefetch" href="/assets/js/96.3a598fc5.js"><link rel="prefetch" href="/assets/js/97.712aa8be.js"><link rel="prefetch" href="/assets/js/98.e757fe7a.js"><link rel="prefetch" href="/assets/js/99.1418024a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SUCKED BloG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/other/index.html" class="nav-link">
  index
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  question
</a></div><div class="nav-item"><a href="/audition/index.html" class="nav-link">
  audition
</a></div><div class="nav-item"><a href="/point/index.html" class="nav-link">
  point
</a></div><div class="nav-item"><a href="/work/index.html" class="nav-link">
  work
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="url" class="dropdown-title"><span class="title">url</span> <span class="arrow down"></span></button> <button type="button" aria-label="url" class="mobile-dropdown-title"><span class="title">url</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/config.html" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="https://git.code.tencent.com/u/nampy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯工蜂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/willwxt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://nbcb.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/point/01java/JVM01.html#第一节" class="sidebar-link">第一节</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/point/01java/JVM01.html#jvm入门" class="sidebar-link">JVM入门</a></li><li class="sidebar-sub-header"><a href="/point/01java/JVM01.html#class文件结构-class-file-format" class="sidebar-link">class文件结构 Class File Format</a></li></ul></li><li><a href="/point/01java/JVM01.html#第二节-class-loading-linking-initializing" class="sidebar-link">第二节 Class Loading Linking Initializing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/point/01java/JVM01.html#第三节课-类加载-关于对象的一些问题-内存屏障" class="sidebar-link">第三节课 类加载 关于对象的一些问题 内存屏障</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/point/01java/JVM01.html#jmm-java内存模型" class="sidebar-link">JMM Java内存模型</a></li></ul></li><li><a href="/point/01java/JVM01.html#第五节-jvm-runtime-data-area-and-jvm-instructions" class="sidebar-link">第五节 JVM Runtime Data Area and JVM Instructions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/point/01java/JVM01.html#jvm运行时数据区" class="sidebar-link">JVM运行时数据区</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jvm"><a href="#jvm" class="header-anchor">#</a> JVM</h1> <h2 id="第一节"><a href="#第一节" class="header-anchor">#</a> 第一节</h2> <h3 id="jvm入门"><a href="#jvm入门" class="header-anchor">#</a> JVM入门</h3> <h4 id="java从编码到执行"><a href="#java从编码到执行" class="header-anchor">#</a> java从编码到执行</h4> <p><img src="https://img-blog.csdnimg.cn/20200622135255828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595758642000"></p> <blockquote><p>x.java 执行 javac 生成 x.class 文件</p> <p>调用java命令, x.class被ClassLoader装载到内存里, java相关类库也被加载到内存里</p> <p>加载完成后调用字节码解释器或者JIT即时编译器进行 解释/翻译</p> <p>执行引擎执行</p></blockquote> <h6 id="面试-java是解释还是编译的"><a href="#面试-java是解释还是编译的" class="header-anchor">#</a> 面试: java是解释还是编译的?</h6> <blockquote><p>解释和编译都有, 当有一些特定代码, 执行次数较多的时候, JVM会通过即时编译器生成二进制文件, 以后运行相同代码直接交给操作系统调用, 不需要再通过解释器, 效率高很多</p></blockquote> <h6 id="用到jvm的许多语言"><a href="#用到jvm的许多语言" class="header-anchor">#</a> 用到JVM的许多语言</h6> <blockquote><p>任何语言编译成class, 就可以在JVM上面运行, 任何语言-class-jvm</p> <p>JVM只是一种标准/规范, 有多种实现</p> <p>java SE 是拥有 java语言规范 和 jvm规范</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200622135505663.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595759092263"></p> <p><img src="https://img-blog.csdnimg.cn/20200622140344132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595759246211"></p> <h6 id="不会讲的编译过程-涉及编译原理"><a href="#不会讲的编译过程-涉及编译原理" class="header-anchor">#</a> 不会讲的编译过程, 涉及编译原理</h6> <p><img src="https://img-blog.csdnimg.cn/20200622140406462.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_16,color_FFFFFF,t_70" alt="1595759522946"></p> <h6 id="常见的jvm实现"><a href="#常见的jvm实现" class="header-anchor">#</a> 常见的JVM实现</h6> <p><img src="https://img-blog.csdnimg.cn/20200622140540644.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_16,color_FFFFFF,t_70" alt="1595759654832"></p> <h6 id="jdk-jre-jvm"><a href="#jdk-jre-jvm" class="header-anchor">#</a> JDK JRE JVM</h6> <p><img src="https://img-blog.csdnimg.cn/20200622141039876.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_16,color_FFFFFF,t_70" alt="1595765535767"></p> <h3 id="class文件结构-class-file-format"><a href="#class文件结构-class-file-format" class="header-anchor">#</a> class文件结构 Class File Format</h3> <blockquote><ul><li>其实不用, 没人考, 用于建立知识体系</li></ul> <p>打开编译后的class文件, 是二进制字节流, 可以使用16进制格式打开</p></blockquote> <h6 id="magic-number"><a href="#magic-number" class="header-anchor">#</a> magic number</h6> <blockquote><p>CAFE BABE</p></blockquote> <h6 id="minor-version-major-version-小版本号-大版本号"><a href="#minor-version-major-version-小版本号-大版本号" class="header-anchor">#</a> minor version + major version 小版本号+大版本号</h6> <blockquote><p>00 00 00 34 转换成十进制, 52.0</p></blockquote> <h6 id="constant-pool-count-常量池数量-和-常量池"><a href="#constant-pool-count-常量池数量-和-常量池" class="header-anchor">#</a> constant_pool_count 常量池数量 和 常量池</h6> <blockquote><p>最复杂的 0位被预留</p> <p>用来存类具体信息的常量池列表, 常量特别多</p> <p>常量池列表参数会互相引用, 或者被后面的所有列表所引用</p> <p>Ljava/lang/String ([IIJ)J</p></blockquote> <h6 id="access-flags"><a href="#access-flags" class="header-anchor">#</a> access_flags</h6> <blockquote><p>用进制位数来代表修饰符 public super..</p></blockquote> <h6 id="this-class"><a href="#this-class" class="header-anchor">#</a> this_class</h6> <h6 id="super-class"><a href="#super-class" class="header-anchor">#</a> super_class</h6> <h6 id="interface-count"><a href="#interface-count" class="header-anchor">#</a> interface_count</h6> <h6 id="fields-count"><a href="#fields-count" class="header-anchor">#</a> fields_count</h6> <h6 id="methods-count"><a href="#methods-count" class="header-anchor">#</a> methods_count</h6> <blockquote><p>方法的实现 重要的是属性中的Code方法表 Java的汇编 JVM文档中有码表</p></blockquote> <h6 id="attributes-count"><a href="#attributes-count" class="header-anchor">#</a> attributes_count</h6> <blockquote><p>里面最终要的是存着的代码Code</p></blockquote> <h5 id="观察class工具"><a href="#观察class工具" class="header-anchor">#</a> 观察class工具</h5> <blockquote><p><code>javap -v</code></p> <p>JBE</p> <p>JClassLib IDEA插件</p></blockquote> <h2 id="第二节-class-loading-linking-initializing"><a href="#第二节-class-loading-linking-initializing" class="header-anchor">#</a> 第二节 Class Loading Linking Initializing</h2> <h4 id="类加载-初始化"><a href="#类加载-初始化" class="header-anchor">#</a> 类加载, 初始化</h4> <p><img src="https://img-blog.csdnimg.cn/20200623142346795.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595811574102"></p> <blockquote><ol><li><p>loading 读取</p></li> <li><p>linking</p> <ol><li>verification 校验</li> <li>preparation class静态变量先赋值成默认值</li> <li>resolution 把class文件中的引用变为真正内存中的</li></ol></li> <li><p>initializing 静态变量赋值为初始值</p></li></ol></blockquote> <h4 id="classloader-类加载器"><a href="#classloader-类加载器" class="header-anchor">#</a> ClassLoader 类加载器</h4> <p><img src="https://img-blog.csdnimg.cn/20200623143826967.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595822453377"></p> <blockquote><p>JVM本身有类加载器层次, 分别加载不同的class</p> <p>任何一个class都是被ClassLoader load到内存里的</p> <ul><li><p>Bootstrap : 最顶层加载器, C++代码实现的, 加载rt.jar(runtime)等核心类, 如果打印是Null, 说明是他加载的, 所有ClassLoader都是他load的</p></li> <li><p>Extension : 加载扩展jar包 ExtClassLoader</p></li> <li><p>Application : classpath 我们写的 AppClassLoader</p></li> <li><p>Custom ClassLoader : 自定义类加载器</p></li></ul> <p>按顺序上层是下层的父加载器, 和继承无关, 只是顺序关系, 源码表现为当前ClassLoader中的一个ClassLoader属性</p></blockquote> <h6 id="class类对象"><a href="#class类对象" class="header-anchor">#</a> class类对象</h6> <blockquote><p>把class文件load到内存的过程, 是把二进制内容放进内存, 同时生成class类的对象, 这个对象指向二进制内容</p> <p>存储在 metaspace</p></blockquote> <h6 id="类加载过程-loading"><a href="#类加载过程-loading" class="header-anchor">#</a> 类加载过程 Loading</h6> <blockquote><p>双亲委派..</p> <p>首先, 每个加载器都有自己的缓存, 先查看自身的缓存, 是否已经加载过这个class, 是就返回, 否则就往上委派, 如果到顶后还是没有找到, 就查找jar包并向下委派, 最终返回或报classNotFound</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200623150313364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595824013737"></p> <h6 id="面试题-为什么loading过程使用双亲委派"><a href="#面试题-为什么loading过程使用双亲委派" class="header-anchor">#</a> 面试题 为什么loading过程使用双亲委派</h6> <blockquote><p>安全考虑</p> <ul><li>自己定义java.lang.Strng, 如果最底层自己实现的ClassLoader可以直接加载, 可以覆盖最顶层的String, 存在安全问题</li></ul> <p>资源浪费</p></blockquote> <h6 id="launcher类"><a href="#launcher类" class="header-anchor">#</a> Launcher类</h6> <blockquote><p>这些类加载器加载位置是由Launcher类封装的</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200623151841789.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595825224869"></p> <h4 id="自定义类加载器-classloader"><a href="#自定义类加载器-classloader" class="header-anchor">#</a> 自定义类加载器 ClassLoader</h4> <p><img src="https://img-blog.csdnimg.cn/20200623151852948.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595849697029"></p> <blockquote><p>稍微读一读<code>abstract class ClassLoader</code>源码, 需要一些设计模式概念</p> <p>想要加载一个类, 调用<code>ClassLoader</code>的<code>loadClass</code>方法, 返回一个Class的对象</p> <p>继承ClassLoader只要实现findClass()方法即可, 模板方法</p> <p>loadClass源码: 先找已加载的类, 如果没有递归调用parent的loadClass方法, 如果都没找到, 调用findClass方法</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200623151907988.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595850793291"></p> <p><img src="https://img-blog.csdnimg.cn/20200623154019787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_16,color_FFFFFF,t_70" alt="1595851021416"></p> <blockquote><p>继承ClassLoader, 重写findClass, 方法中读取文件为二进制字节数组, 然后调用defineClass返回该对象</p> <p>框架和类库一般有自己的ClassLoader</p> <p>自定义加密ClassLoader</p> <p>Compiler API 自行了解</p></blockquote> <h6 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h6> <blockquote><p>这里初始化就是指 类的初始化</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200623162403393.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595852821299"></p> <h6 id="编译"><a href="#编译" class="header-anchor">#</a> 编译</h6> <blockquote><p>默认 mixed-mod 混合模式</p> <p>Hotspot 热点 -XX:CompileThreshold = 10000</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200623172040219.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595853494315"></p> <h2 id="第三节课-类加载-关于对象的一些问题-内存屏障"><a href="#第三节课-类加载-关于对象的一些问题-内存屏障" class="header-anchor">#</a> 第三节课 类加载 关于对象的一些问题 内存屏障</h2> <blockquote><p>双亲委派机制是可以被打破的 - 重写loadClass方法</p> <p>热部署 : 先加载路径下的class 再双亲委派</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200624100352962.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595857305927"></p> <ol><li>Loading</li> <li>Linking
<ol><li>Verification
<ol><li>验证文件是否符合JVM规定</li></ol></li> <li>Preparation
<ol><li>静态成员变量赋默认值</li></ol></li> <li>Resolution
<ol><li>将类、方法、属性等符号引用解析为直接引用
常量池中的各种符号引用解析为指针、偏移量等内存地址的直接引用</li></ol></li></ol></li> <li>Initializing
<ol><li>调用类初始化代码 <code>&lt;clinit&gt;</code>，给静态成员变量赋初始值</li></ol></li></ol> <h6 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>c2_classloader</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T001_ClassLoadingProcedure</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行到这一步时，下一行的count仍然是默认值0，调用构造方法后，count变为1,</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 执行到这一步时，上一行的count=1被这一行的count=2覆盖</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h6 id="new对象过程也分成两步"><a href="#new对象过程也分成两步" class="header-anchor">#</a> new对象过程也分成两步</h6> <ol><li>申请内存</li> <li>将数据赋默认值</li> <li>调用初始化代码, 将值赋给数据</li></ol> <h6 id="dcl单例的指令重排序问题"><a href="#dcl单例的指令重排序问题" class="header-anchor">#</a> DCL单例的指令重排序问题</h6> <p><img src="https://img-blog.csdnimg.cn/20200624103504753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595859035484"></p> <blockquote><p>new 申请内存完毕</p> <p>invokespecial 调用构造方法</p> <p>astore_1 将对象赋值给引用</p></blockquote> <h3 id="jmm-java内存模型"><a href="#jmm-java内存模型" class="header-anchor">#</a> JMM Java内存模型</h3> <p>硬件层的并发优化基础知识</p> <p><img src="https://img-blog.csdnimg.cn/20200624104142661.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595859803941"></p> <h6 id="解决l3缓存共享数据问题"><a href="#解决l3缓存共享数据问题" class="header-anchor">#</a> 解决L3缓存共享数据问题</h6> <ol><li>总线锁</li> <li>缓存锁, MESI等的 Cache缓存一致性协议的实现</li></ol> <p><img src="https://img-blog.csdnimg.cn/20200624104651827.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595860460845"></p> <h6 id="cache-line-伪共享问题-缓存行对齐解决"><a href="#cache-line-伪共享问题-缓存行对齐解决" class="header-anchor">#</a> cache line 伪共享问题 缓存行对齐解决</h6> <blockquote><p>缓存块读64bytes, 多线程下缓存锁造成多CPU缓存之间持续同步</p></blockquote> <h6 id="cpu乱序执行"><a href="#cpu乱序执行" class="header-anchor">#</a> cpu乱序执行</h6> <blockquote><p>cpu为了提高效率, 打乱没有依赖关系的指令顺序, 运行</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200624110333610.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595862000713"></p> <h6 id="合并写-writecombinebuffer"><a href="#合并写-writecombinebuffer" class="header-anchor">#</a> 合并写 WriteCombineBuffer</h6> <blockquote><p>一般是4个字节大小, 由于ALU 速度最快, 在写入L1的同时写入一个CombineBuffer, 写满后直接给L2</p> <ul><li>补充: 直接写到L2</li></ul></blockquote> <h6 id="乱序执行的证明"><a href="#乱序执行的证明" class="header-anchor">#</a> 乱序执行的证明</h6> <blockquote><p>T04_Disorder.java</p></blockquote> <h6 id="特定情况下解决乱序问题-保证有序性-使用内存屏障"><a href="#特定情况下解决乱序问题-保证有序性-使用内存屏障" class="header-anchor">#</a> 特定情况下解决乱序问题, 保证有序性, 使用内存屏障</h6> <blockquote><p>硬件级别CPU内存屏障</p> <p>以下是Intel CPU的内存屏障, 屏障前后保证顺序, 可以保证一定的读写顺序</p> <p>lock... 指令</p> <p>执行时候锁住内存来确保执行顺序</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200624111930798.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595863192064"></p> <h6 id="jvm级别规范-jsr133"><a href="#jvm级别规范-jsr133" class="header-anchor">#</a> JVM级别规范 JSR133</h6> <blockquote><p>JSR内存屏障 JVM的实现也是汇编命令</p> <p>四种屏障</p> <p>LoadLoad</p> <p>StoreStore</p> <p>LoadStore</p> <p>StoreLoad</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200624112202189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595910218063"></p> <h6 id="volatile-实现"><a href="#volatile-实现" class="header-anchor">#</a> volatile 实现</h6> <blockquote><ol><li><p>字节码 ACC_VOLATILE</p></li> <li><p>JVM</p> <ul><li>在volatile内存区的 写操作和读操作的前后都加上屏障</li></ul></li> <li><p>OS和硬件层面</p> <ul><li><p>使用hsdis(hotspot Dis Assembler)观察汇编</p></li> <li><p>Windows 中是用 lock 实现</p></li> <li><p><a href="https://blog.csdn.net/qq_26222859/article/details/52235930" target="_blank" rel="noopener noreferrer">Blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></li></ol></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>volatile的实现细节
JVM层面

StoreStoreBarrier						LoadLoadBarrier
volatile写操作							  volatile读操作
StoreLoadBarrier						LoadStoreBarrier
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h6 id="synchronized-实现"><a href="#synchronized-实现" class="header-anchor">#</a> synchronized 实现</h6> <blockquote><ol><li>字节码 ACC_SYNCHRONIZED</li></ol> <ul><li>monitorenter monitorexit</li></ul> <ol start="2"><li>JVM层面</li></ol> <ul><li>C++ 调用了OS提供的同步机制</li></ul> <ol start="3"><li>OS和硬件层面</li></ol> <ul><li><p>lock 指令实现 , lock 将后面这条指令执行的过程中将操作的内存区域锁定</p></li> <li><p><a href="(https://blog.csdn.net/21aspnet/article/details/88571740)">OSblog</a></p></li></ul></blockquote> <p><img src="https://img-blog.csdnimg.cn/202006251043017.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595941280785"></p> <p><img src="https://img-blog.csdnimg.cn/20200625104319309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595941314062"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>as if serial 
不管如何重排序, 单线程执行结果不会改变
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200625104744447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595941195279"></p> <p><img src="https://img-blog.csdnimg.cn/20200625104900549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595941680273"></p> <h4 id="对象内存布局"><a href="#对象内存布局" class="header-anchor">#</a> 对象内存布局</h4> <blockquote><p>对象大小, 和JVM配置, 和电脑是64位/32位有关</p> <p><code>java -XX:+PrintCommandLineFlags -version</code> 打印命令行参数</p></blockquote> <h5 id="普通对象"><a href="#普通对象" class="header-anchor">#</a> 普通对象</h5> <blockquote><ol><li>对象头 8个字节</li> <li>ClassPointer指针, 指向该对象唯一的Class对象</li> <li>实例数据, 保存的基本类型以及引用类型</li> <li>Padding对齐, 对齐保证块读效率, 保证是8字节的倍数</li></ol></blockquote> <h5 id="数组对象"><a href="#数组对象" class="header-anchor">#</a> 数组对象</h5> <blockquote><ol><li>对象头 8个字节</li> <li>ClassPointer 4/8字节</li> <li>数组长度</li> <li>数组数据</li> <li>Padding 对齐</li></ol></blockquote> <h5 id="对象的大小"><a href="#对象的大小" class="header-anchor">#</a> 对象的大小</h5> <h6 id="java-agent"><a href="#java-agent" class="header-anchor">#</a> Java Agent</h6> <blockquote><p>截获加载的class , 可以读取class大小, 可以对class进行修改</p> <p>Instrumentation</p> <p>Premain-Class 指定main方法之前执行的class, JVM自动调用class内的 premain方法</p> <p>premain方法获取到Instrumentation对象后, 可以调用它的getObjectSize()获取size</p> <p>打包成jar, 作为另一个java项目的 agent , 使用时需要指定javaagent的JVM参数</p></blockquote> <h6 id="object"><a href="#object" class="header-anchor">#</a> Object</h6> <blockquote><p>对象头 8 + 压缩的ClassPointer 4 + Padding = 16 字节</p></blockquote> <h6 id="数组-空的int"><a href="#数组-空的int" class="header-anchor">#</a> 数组 空的int[]</h6> <blockquote><p>对象头 8 + 压缩ClassPointer 4 + 数组长度 4 = 16 字节</p> <p>如果关闭压缩Class指针 <code>-XX:-UseCompressedClassPointers</code></p> <p>对象头 8 + 不压缩ClassPointer 8 + 数组长度 4 + padding = 24 字节</p></blockquote> <p>带参数的Class</p> <blockquote><p>如果Class中有普通对象指针 ordinary object pointers</p> <p><code>-XX:+UseCompressedOops</code> 选项会压缩Oops</p></blockquote> <h5 id="对象头具体包括什么"><a href="#对象头具体包括什么" class="header-anchor">#</a> 对象头具体包括什么</h5> <blockquote><p>每个版本不一样 定义在markOop.hpp 文件</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200625114204897.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595943510156"></p> <p><img src="https://img-blog.csdnimg.cn/20200625114214505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595943541638"></p> <blockquote><p>sync 锁标记</p> <p>gc 标记 分代年龄</p></blockquote> <p>对象的IdentityHashCode计算后, 无法进入偏向锁状态</p> <h5 id="对象定位"><a href="#对象定位" class="header-anchor">#</a> 对象定位</h5> <blockquote><ol><li>句柄池 首先指向拥有两个指针的句柄池(该对象+class对象), 再指向该对象</li> <li>直接指针 直接指向该对象</li></ol></blockquote> <h5 id="对象怎么分配"><a href="#对象怎么分配" class="header-anchor">#</a> 对象怎么分配</h5> <blockquote><p>GC课详细讲</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200625115051929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595944845432"></p> <h2 id="第五节-jvm-runtime-data-area-and-jvm-instructions"><a href="#第五节-jvm-runtime-data-area-and-jvm-instructions" class="header-anchor">#</a> 第五节 JVM Runtime Data Area and JVM Instructions</h2> <p>JVM运行时数据区 JVM指令集</p> <p><img src="https://img-blog.csdnimg.cn/20200626091109514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595981509669"></p> <h3 id="jvm运行时数据区"><a href="#jvm运行时数据区" class="header-anchor">#</a> JVM运行时数据区</h3> <p><img src="https://img-blog.csdnimg.cn/20200626091414763.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595981805578"></p> <h5 id="program-counter-程序计数器"><a href="#program-counter-程序计数器" class="header-anchor">#</a> Program Counter 程序计数器</h5> <blockquote><p>存放指令位置</p></blockquote> <h5 id="heap"><a href="#heap" class="header-anchor">#</a> Heap</h5> <blockquote><p>GC时候再聊</p></blockquote> <h5 id="jvm-stacks-每个线程开启的栈"><a href="#jvm-stacks-每个线程开启的栈" class="header-anchor">#</a> JVM stacks 每个线程开启的栈</h5> <h6 id="frame"><a href="#frame" class="header-anchor">#</a> frame</h6> <blockquote></blockquote> <h5 id="native-method-stacks-本地参数"><a href="#native-method-stacks-本地参数" class="header-anchor">#</a> native method stacks 本地参数</h5> <h5 id="direct-memory-直接内存"><a href="#direct-memory-直接内存" class="header-anchor">#</a> Direct Memory 直接内存</h5> <blockquote><p>NIO新加入, JVM不管理, 直接访问JVM外的内存空间(OS管理的), 参考C++</p></blockquote> <h5 id="method-area-方法区"><a href="#method-area-方法区" class="header-anchor">#</a> method area 方法区</h5> <blockquote><p>1.8 前 Perm Space 之后 Meta Space</p> <ol><li>Perm Space , 启动的时候指定大小, FGC不会清理</li> <li>Meta Space , 不设定的话最大就是物理内存, 会触发FGC清理,</li> <li>字符串常量放在Perm Space, 1.8开始 放在堆Heap</li></ol></blockquote> <h6 id="run-time-constant-pool"><a href="#run-time-constant-pool" class="header-anchor">#</a> run-time constant pool</h6> <blockquote><p>运行时的常量池</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200626091910326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595982370097"></p> <p><img src="https://img-blog.csdnimg.cn/20200626091930849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595982429121"></p> <p><img src="https://img-blog.csdnimg.cn/20200626091943211.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595982470802"></p> <p><img src="https://img-blog.csdnimg.cn/20200626091955765.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595982502457"></p> <p><img src="https://img-blog.csdnimg.cn/20200626092056794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595994770957"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Native Method Stacks	本地方法栈
一个Java虚拟机的实现可能会用到这个本地方法栈
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200626092108483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595994887642"></p> <h5 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h5> <blockquote><p>每个线程</p> <p>有自己的PC VMS NMS</p> <p>共享Heap 和 MethodArea</p></blockquote> <h6 id="为什么需要记录当前线程的执行地址"><a href="#为什么需要记录当前线程的执行地址" class="header-anchor">#</a> 为什么需要记录当前线程的执行地址?</h6> <blockquote><p>没执行地址怎么执行</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200626092208660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1595995157163"></p> <h5 id="栈帧frame-每个方法对应一个栈帧"><a href="#栈帧frame-每个方法对应一个栈帧" class="header-anchor">#</a> 栈帧Frame - 每个方法对应一个栈帧</h5> <blockquote><p>存储数据中间结果动态链接</p> <ul><li>局部变量/本地变量 Local Variable Table时</li> <li>操作数栈 Operand Stacks</li> <li>动态链接 Dynamic Linkings
<ul><li>从Class字节码中找到各方法的地址</li></ul></li> <li>return address
<ul><li>方法调用结束后的位置以及将返回值返回</li></ul></li></ul></blockquote> <h6 id="回到-i-i-的面试题-以下描述中压栈的都是操作数栈-operand-stack"><a href="#回到-i-i-的面试题-以下描述中压栈的都是操作数栈-operand-stack" class="header-anchor">#</a> 回到 i=i++ 的面试题 以下描述中压栈的都是操作数栈(Operand Stack)</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
i <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>0 bipush 8
2 istore_1
3 iload_1
4 iinc 1 by 1
7 istore_1
8 return
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><table><thead><tr><th>Nr.</th> <th>Start PC</th> <th>Length</th> <th>Index</th> <th></th></tr></thead> <tbody><tr><td>0</td> <td>0</td> <td>9</td> <td>0</td> <td>args</td></tr> <tr><td>1</td> <td>3</td> <td>6</td> <td>1</td> <td>i</td></tr></tbody></table> <h6 id="bipush"><a href="#bipush" class="header-anchor">#</a> bipush</h6> <blockquote><p>push byte 到 Operand Stack (操作数栈)里, 然后扩展成int值</p> <p>也就是把 8 压栈 (这里因为是8, byte就可以存, 如果大于127, 开始用 sipush (short)</p></blockquote> <h6 id="istore-n"><a href="#istore-n" class="header-anchor">#</a> istore_n</h6> <blockquote><p>出栈, 把值存到 local variable 局部变量表中 下标为 n 的位置</p> <p>把栈顶元素出栈, 弹出到局部变量表中下标为 n 的位置, 此处istore_1 局部变量表1的位置是 i , 也就将8赋值给了 i</p></blockquote> <h6 id="iload-n"><a href="#iload-n" class="header-anchor">#</a> iload_n</h6> <blockquote><p>从局部变量表按下标 n 拿值, 压栈</p> <p>把 i 的值 8 拿出来压栈里</p></blockquote> <h6 id="iinc-n-by-1"><a href="#iinc-n-by-1" class="header-anchor">#</a> iinc n by 1</h6> <blockquote><p>把局部变量表 位置1的数 加一</p> <p>这时候i = 9 了 (但是栈里面的数还是 8)</p> <p>然后又调用了 istore_1 , 将栈里的8又赋值给 i</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>0 bipush 8
2 istore_1
3 iinc 1 by 1
6 iload_1
7 istore_1
8 return
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
i <span class="token operator">=</span> <span class="token operator">++</span>i<span class="token punctuation">;</span><span class="token comment">//上图中的 iload_1 和 iinc 1 by 1 位置互换了, 变成先增加, 再将i的值 9 压栈</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/2020062610140417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1596083086677"></p> <blockquote><p>JVM是基于栈的指令集</p> <p>硬件都是基于寄存器</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200626105826131.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1596084468036"></p> <blockquote><p>将 3 和 4 压栈后执行 iadd 指令, 将3, 4 出栈, 把相加之和压栈</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200626110021642.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1596084600675"></p> <h5 id="创建对象的指令-dcl问题"><a href="#创建对象的指令-dcl问题" class="header-anchor">#</a> 创建对象的指令 DCL问题</h5> <h6 id="new"><a href="#new" class="header-anchor">#</a> new</h6> <blockquote><p>开辟内存空间(创建默认对象), 将内存地址压栈</p></blockquote> <h6 id="dup"><a href="#dup" class="header-anchor">#</a> dup</h6> <blockquote><p>将栈顶元素复制一份压栈</p></blockquote> <h6 id="invokespecial"><a href="#invokespecial" class="header-anchor">#</a> invokespecial</h6> <blockquote><p>执行构造方法, 初始化内存对象</p> <p>执行构造方法需要一份对象地址, 于是把栈顶元素弹出</p></blockquote> <h6 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h6> <p><img src="https://img-blog.csdnimg.cn/20200626110908449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1596109651788"></p> <blockquote><p>return的值会放到调用这个方法的栈帧的操作数栈的顶部, 就是把调用方法的返回值压栈了</p></blockquote> <h6 id="递归"><a href="#递归" class="header-anchor">#</a> 递归</h6> <p><img src="https://img-blog.csdnimg.cn/20200626111125916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70" alt="1596109871079"></p> <h6 id="iconst-n"><a href="#iconst-n" class="header-anchor">#</a> iconst_n</h6> <blockquote><p>压栈一个常量 n</p></blockquote> <h6 id="if-icmpne-n"><a href="#if-icmpne-n" class="header-anchor">#</a> if_icmpne n</h6> <blockquote><p>比较int值, 如果不相等跳到第n步执行, 如果相等向下运行</p></blockquote> <h6 id="ireturn"><a href="#ireturn" class="header-anchor">#</a> ireturn</h6> <blockquote><p>int值出栈并返回</p></blockquote> <h6 id="aload-n"><a href="#aload-n" class="header-anchor">#</a> aload_n</h6> <blockquote><p>将引用n的对象压栈</p></blockquote> <h6 id="isub-imul"><a href="#isub-imul" class="header-anchor">#</a> isub imul</h6> <blockquote><p>出栈两个int数进行减法/乘法</p></blockquote> <h6 id="invokevirtual"><a href="#invokevirtual" class="header-anchor">#</a> invokevirtual</h6> <blockquote><p>调用方法, 并将返回值压栈</p></blockquote> <h5 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h5> <blockquote><p>前面的 0 1 2 5 指这条指令所占的字节.. 占的多就会跳行</p> <ul><li><code>&lt;clinit&gt;</code> 静态语句块 static{}</li> <li><code>&lt;init&gt;</code> 构造方法</li> <li><code>_store</code> 出栈, 赋值给对应下标</li> <li><code>_load</code> 读取本地变量表对应下标的值, 压栈</li> <li><code>invoke_xxx</code></li></ul></blockquote> <h5 id="invoke指令"><a href="#invoke指令" class="header-anchor">#</a> invoke指令</h5> <h6 id="invokestatic-调用静态方法"><a href="#invokestatic-调用静态方法" class="header-anchor">#</a> invokeStatic 调用静态方法</h6> <h6 id="invokevirtual-2"><a href="#invokevirtual-2" class="header-anchor">#</a> invokeVirtual</h6> <blockquote><p>自带多态, 只是调用了所给对象的方法</p></blockquote> <h6 id="invokeinterface"><a href="#invokeinterface" class="header-anchor">#</a> invokeInterface</h6> <h6 id="invokespecial-2"><a href="#invokespecial-2" class="header-anchor">#</a> invokeSpecial</h6> <blockquote><p>可以直接定位, 不需要多态的方法</p> <p>private 方法, 构造方法</p></blockquote> <h6 id="invokedynamic"><a href="#invokedynamic" class="header-anchor">#</a> invokeDynamic</h6> <blockquote><p>JVM最难的指令</p> <p>lambda表达式, 反射, 其他动态语言scala kotlin，或者CGLib ASM，动态产生的class，会用到的指令</p> <p>每一个 lambda 表达式都会产生一个内部类</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/7/2021, 12:08:35 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.42575a28.js" defer></script><script src="/assets/js/2.0d7d09b8.js" defer></script><script src="/assets/js/27.9e0f0e9d.js" defer></script>
  </body>
</html>
