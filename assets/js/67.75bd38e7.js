(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{420:function(a,t,s){"use strict";s.r(t);var e=s(45),v=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"nbcb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nbcb"}},[a._v("#")]),a._v(" nbcb")]),a._v(" "),s("h2",{attrs:{id:"微服务开发培训-2021年04月"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微服务开发培训-2021年04月"}},[a._v("#")]),a._v(" 微服务开发培训(2021年04月)")]),a._v(" "),s("h4",{attrs:{id:"第一节课-微服务概述-简单的hello-world"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一节课-微服务概述-简单的hello-world"}},[a._v("#")]),a._v(" 第一节课: 微服务概述, 简单的hello world")]),a._v(" "),s("h4",{attrs:{id:"第二节-eureka-gateway-feign-resttemplate-讲解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二节-eureka-gateway-feign-resttemplate-讲解"}},[a._v("#")]),a._v(" 第二节: Eureka, Gateway, Feign/RestTemplate 讲解")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("概述:")]),a._v(" "),s("ol",[s("li",[a._v("RESTFUL: HTTP返回码规定 400为客户端错误, 500为服务端错误")]),a._v(" "),s("li",[a._v("主键查询的, 推荐将主键写在url中; 基于属性的写在url的?后作为参数")]),a._v(" "),s("li",[a._v("简单描述了 zuul, ribbon, monitor, hystrix, turbine")])])]),a._v(" "),s("li",[s("p",[a._v("Eureka")]),a._v(" "),s("ul",[s("li",[a._v("简单概述: 分为实例instance, 客户端client, 服务端server, 三个维度")]),a._v(" "),s("li",[a._v("调优参数 instance:\n"),s("ul",[s("li",[a._v("多久没收到心跳的超时时间, 默认90秒, 生产30秒")]),a._v(" "),s("li",[a._v("client多久给server发送一次心跳: 默认30秒, 生产10秒")]),a._v(" "),s("li",[a._v("是否使用ip地址: 生产true, 配合hostname使用")])])]),a._v(" "),s("li",[a._v("client:\n"),s("ul",[s("li",[a._v("是否注册到注册中心: 本地开发可以false")]),a._v(" "),s("li",[a._v("是否拉取服务列表: 肯定需要")]),a._v(" "),s("li",[a._v("拉取服务列表的间隔: 默认30秒, 生产10秒或5秒")])])]),a._v(" "),s("li",[a._v("server:\n"),s("ul",[s("li",[a._v("是否开启自我保护: 生产环境true")]),a._v(" "),s("li",[a._v("清理无效服务的间隔: 默认60秒, 生产30秒")])])])])]),a._v(" "),s("li",[s("p",[a._v("Gateway")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("应用: 灰度发布, 服务迁移(新接口上线, 原接口继续提供服务, 给调用方足够时间进行迁移)")])]),a._v(" "),s("li",[s("p",[a._v("流程: 请求, 匹配, 路由, 过滤, 转发到目标, 目标按原路径返回")])]),a._v(" "),s("li",[s("p",[a._v("使用: 推荐修改网关日志级别, info无法看到转发日志")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[a._v("reactor.ipc.netty：debug\norg.springframework.cloud.gateway：trace\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("断言: 是否转发, 控制用;   过滤器: 修改请求头, url")])]),a._v(" "),s("li",[s("p",[a._v("应用:")]),a._v(" "),s("ul",[s("li",[a._v("用filter实现计算请求耗时")]),a._v(" "),s("li",[a._v("网关和注册中心组合使用, ribbon决定一个实例调用")])])])])])]),a._v(" "),s("h4",{attrs:{id:"第三节-ribbon-hystrix-springadmin-apollo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三节-ribbon-hystrix-springadmin-apollo"}},[a._v("#")]),a._v(" 第三节: Ribbon, Hystrix, SpringAdmin, Apollo")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("Ribbon")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("7种负载均衡策略: 轮询, 最小并发, 权重, 重试...")])]),a._v(" "),s("li",[s("p",[a._v("使用apache abtest工具进行测试")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("ab -n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" -c "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" http://localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#用1个线程, 发送1000次")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("参数调优")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("全局配置 && 单个微服务配置")])]),a._v(" "),s("li",[s("p",[a._v("默认是开启重试, 可能会有重试报文, 行内接口幂等性没有保障, 目前只开启GET请求的重试")])]),a._v(" "),s("li",[s("p",[a._v("连接超时, 读取超时时间, 生产配置")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("ConnetTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("2000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("ReadTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("5000 (包括重试的时间)")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])])])])]),a._v(" "),s("li",[s("p",[a._v("Hystrix")]),a._v(" "),s("ul",[s("li",[a._v("隔离: 限制调用资源, 隔离不可用服务, 防止雪崩")]),a._v(" "),s("li",[a._v("降级: 降级接口返回兜底数据")]),a._v(" "),s("li",[a._v("熔断: 达到失败率后进行降级, 重试成功后恢复")]),a._v(" "),s("li",[a._v("缓存: 合并请求机制 (生产没有用,说是对代码有侵入性)")]),a._v(" "),s("li",[s("strong",[a._v("降级是客户端的策略, 和服务端无关")])]),a._v(" "),s("li",[a._v("熔断器状态: Closed(正常调用) - Open(调用降级) - Half-Open(一段时间会进入的半开状态)")]),a._v(" "),s("li",[a._v("配置\n"),s("ul",[s("li",[a._v("Hystrix请求的超时时间, 一般小于Ribbon的读取超时")]),a._v(" "),s("li",[a._v("在一个滑动窗口(默认10秒)中打开断路器的最少请求数")]),a._v(" "),s("li",[a._v("将开启的断路器置为半开状态的等待时间")]),a._v(" "),s("li",[a._v("错误百分比")]),a._v(" "),s("li",[a._v("配置Hystrix请求线程池")]),a._v(" "),s("li",[a._v("设置统计滑动窗口时间间隔")]),a._v(" "),s("li",[a._v("设置滑动窗口被分成多少个桶bucket")])])]),a._v(" "),s("li",[a._v("调优\n"),s("ul",[s("li",[a._v("隔离方案: 核心数量,最大数量..")]),a._v(" "),s("li",[a._v("线程隔离(会发生ThreadLocal数据丢失)")]),a._v(" "),s("li",[a._v("信号量隔离: 最大信号量")]),a._v(" "),s("li",[a._v("Hystrix超时时间 5秒")])])])])]),a._v(" "),s("li",[s("p",[a._v("Spring Boot Admin (行内用普罗米修斯)")]),a._v(" "),s("ul",[s("li",[a._v("搭建, 查看服务状态线程数内存, 测量请求, 查看运行时环境, 查看真正加载的配置, 定时任务, 动态修改日志级别, JVM, 线程, HeapDump, Web, Audit")])])]),a._v(" "),s("li",[s("p",[a._v("Apollo")]),a._v(" "),s("ul",[s("li",[a._v("概述: 依赖, @EnableApolloConfig, 配置")]),a._v(" "),s("li",[a._v("功能: 配置, 回滚, 灰度, 公共配置, 配置历史版本查看")])])])]),a._v(" "),s("h4",{attrs:{id:"第四节-水星平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第四节-水星平台"}},[a._v("#")]),a._v(" 第四节: 水星平台")]),a._v(" "),s("h4",{attrs:{id:"第五节-星云平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第五节-星云平台"}},[a._v("#")]),a._v(" 第五节: 星云平台")]),a._v(" "),s("p",[a._v("架构: 鄞州江北双中心双活(镜像副本)")]),a._v(" "),s("ul",[s("li",[a._v("旧架构\n"),s("ul",[s("li",[a._v("每个中心有四个域 网银APP, OA前置...")]),a._v(" "),s("li",[a._v("每个域都有单独一套微服务架构: 注册中心, 网关, 属于该域的微服务")]),a._v(" "),s("li",[a._v("域内调用，直接通过域内注册中心获取实例调用即可")]),a._v(" "),s("li",[a._v("跨域调用，（路由网关将微服务代理注册到注册中心）通过路由网关进行跨域调用")]),a._v(" "),s("li",[a._v("跨中心调用，根据全行注册中心转发调用")])])]),a._v(" "),s("li",[a._v("新架构\n"),s("ul",[s("li",[a._v("目的是去除的注册中心，只有全行注册中心，实现直接通过注册中心调用")])])])]),a._v(" "),s("p",[a._v("坑: 在星云空间站注册过程中域选择错误，此时脚本已经派发（Apollo配置），需要重新手动修改")]),a._v(" "),s("p",[a._v("边车 sidecar：一个系统需要一个边车进行代理（路由转发），服务被代理注册到注册中心 (目前用的少，还在试点，后续主推)")]),a._v(" "),s("p",[a._v("接口限流是使用guava令牌桶算法实现的")]),a._v(" "),s("p",[a._v("水星星云平台新老系统traceid兼容问题(skywalking和sleuth) (OpenTracing规范)")]),a._v(" "),s("p",[a._v("页面调用，注解跳过token校验，安全性请自己控制")]),a._v(" "),s("h4",{attrs:{id:"第六节-idea开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第六节-idea开发"}},[a._v("#")]),a._v(" 第六节: IDEA开发")]),a._v(" "),s("p",[a._v("略过")]),a._v(" "),s("h4",{attrs:{id:"第七节-单元测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第七节-单元测试"}},[a._v("#")]),a._v(" 第七节: 单元测试")]),a._v(" "),s("h2",{attrs:{id:"企业支撑系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#企业支撑系统"}},[a._v("#")]),a._v(" 企业支撑系统")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cbbank-athena\ncbbank-auth\ncbbank-dictionary\ncbbank-file\ncbbank-filescan-service\ncbbank-management\ncbbank-management-gateway\ncbbank-order\ncbbank-order-batch\ncbbank-order-exporter\ncbbank-signature\ncbbank-user\ncbbank-user-batch\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h4",{attrs:{id:"cbbank-auth"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cbbank-auth"}},[a._v("#")]),a._v(" cbbank-auth")]),a._v(" "),s("ul",[s("li",[a._v("通过客户号,用户号,登录版本,生成对应的login-token; 更新token中客户信息;")]),a._v(" "),s("li",[a._v("服务状态认证 (是否暂停, 是否服务关闭, 是否工作日交易);\n"),s("ul",[s("li",[a._v("强依赖于 cbbank-dictionary 参数中心 (服务暂停, 工作日)")])])]),a._v(" "),s("li",[a._v("用户认证, 验证客户、用户、账户、证件、权限;\n"),s("ul",[s("li",[a._v("强依赖于 cbbank-user 用户中心")])])])])])}),[],!1,null,null,null);t.default=v.exports}}]);