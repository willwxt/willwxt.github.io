(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{380:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h4",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("blockquote",[a("p",[t._v("NGINX redis netty tomcat")]),t._v(" "),a("p",[t._v("网络IO, socket IO, 文件系统IO")]),t._v(" "),a("p",[t._v("API使用, 底层封装, java的io到nio的过程")]),t._v(" "),a("p",[t._v("BIO, NIO, 多路复用器, AIO")]),t._v(" "),a("p",[t._v("Netty现在是多路复用器, 在等linux的AIO")])]),t._v(" "),a("h4",{attrs:{id:"安装jdk1-4问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk1-4问题"}},[t._v("#")]),t._v(" 安装jdk1.4问题")]),t._v(" "),a("blockquote",[a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("/lib/ld-linux.so.2: bad ELF interpreter: 没有那个文件或目录\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ld-linux.so.2  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#即可")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("h4",{attrs:{id:"测试java-bio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试java-bio"}},[t._v("#")]),t._v(" 测试java BIO")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("strace")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#linux指令, 把用户程序在执行时内核的系统调用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("strace")]),t._v(" -ff -o out /opt/j2sdk1.4.2_19/bin/java *.java\n-ff "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#把每个线程都跟踪到")]),t._v("\n-o out\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#把追踪日志写到out开头的文件中")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" -natp\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看网络状态 -t tcp")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("blockquote",[a("p",[t._v("启动后, 新建了8个文件前缀为out的文件, 代表了创建的8个线程")]),t._v(" "),a("p",[t._v("查看日志, 搜索端口号(8090), 看到")])]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# socket 创建socket 3 并返回 , java中的创建socket最终是这个系统调用")]),t._v("\nsocket(AF_INET6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SOCK_STREAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IPPROTO_IP) = 3\nsetsockopt(3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SOL_SOCKET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SO_REUSEADDR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 4) = 0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bind 绑定socket 3 绑定端口为8090 = 绑定成功")]),t._v("\nbind(3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("sa_family=AF_INET6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sin6_port=htons(8090)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inet_pton(AF_INET6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"::"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&sin6_addr)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sin6_flowinfo=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sin6_scope_id=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 24) = 0\nlisten(3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 20) = 0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打印 1是标准输出")]),t._v("\nwrite(1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"step01 : new ServerSocket(8090)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 31) = 31\nwrite(1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 1) = 1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 阻塞, 也就是 socket.accept(); 对象调方法, 函数里处理谁")]),t._v("\naccept(3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以上每行是 系统的调用 = 返回对象")]),t._v("\n\nman 2 socket "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指令查看2类系统调用下的 函数socket的源码 可以看下RETURN VALUE ")]),t._v("\nlsof "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p 25659\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示打开的文件 -p 进程id")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 25659 java程序 3u u表示读写都可以 3监听 8090")]),t._v("\njava 25659 root 3u IPv6 1260686 0t0 TCP "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*:8090")]),t._v(" (LISTEN)\n\ntail "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f out.25659\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用tail跟踪")]),t._v("\nnc localhost 8090\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接本机8090端口, 连接后查看日志变化")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# accept返回了5, 也就是客户端描述符")]),t._v("\naccept(3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("sa_family=AF_INET6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sin6_port=htons(45410)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inet_pton(AF_INET6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"::1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&sin6_addr)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sin6_flowinfo=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sin6_scope_id=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(") = 5\nlsof "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p 25659\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建了客户端 5 ESTABLISHED")]),t._v("\njava 25659 root 5u IPv6 1259878 0t0 TCP localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8090"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("45410 (ESTABLISHED)\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\nclone(child_stack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("child_tidptr=0xea158ba8) = 26485\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# java的new thread().start() 会调用clone, 中间传递一些如vm,文件,内存空间等信息, 返回新的线程ID 26485")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# java中的线程是不是内核级的进程或线程 -是,java中的线程就是操作系统的线程或轻量级进程")]),t._v("\ncd /proc/26659/task\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看进程及其线程(轻量级进程)")]),t._v("\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25659\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25660\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25661\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25662\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25663\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25664\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25665\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 25666\ndr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x. 7 root root 0 7月   3 19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("25 26485\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为什么使用clone, 共享内存堆空间, 线程栈/进程栈是隔离的, 只能在一个CPU上跑")]),t._v("\nless "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("N out.26485\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看")]),t._v("\nrecv(5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 阻塞接受, 客户端5的行为, 客户端发送 ooxx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收到行为, 并继续阻塞")]),t._v("\nrecv(5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ooxx\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8192")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0) = 5\nioctl(5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FIONREAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(") = 0\nwrite(1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ooxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 4) = 4\nwrite(1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 1) = 1\nrecv(5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br")])]),a("h4",{attrs:{id:"总结-bio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结-bio"}},[t._v("#")]),t._v(" 总结, BIO")]),t._v(" "),a("blockquote",[a("p",[t._v("监听 - 接收/阻塞 - 返回 5 - 克隆线程 - 继续接收/阻塞")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("  \t\t\t\t\t\t\t\t\t\t\t|-- recv/阻塞\n")])])]),a("p",[t._v("BIO弊端")]),t._v(" "),a("p",[t._v("每连接 每线程, 一一对应, 连接数多的时候")]),t._v(" "),a("p",[t._v("C10K问题, 如果服务器接收1万连接")]),t._v(" "),a("p",[t._v("此时需要10000个线程(进程), CPU调度压力很大, 浪费资源")]),t._v(" "),a("p",[t._v("弊端来源于阻塞, 因为所有上级应用都是调用内核, 需要内核支持非阻塞的能力")])]),t._v(" "),a("h4",{attrs:{id:"nio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nio"}},[t._v("#")]),t._v(" NIO")]),t._v(" "),a("blockquote",[a("p",[t._v("NIO 就是 accept, read, write 返回 -1 不会卡住")]),t._v(" "),a("p",[t._v("不需要新建线程了")]),t._v(" "),a("p",[t._v("accept后 返回 5 或 -1 如果是 5 就放进链表里面反复读取")]),t._v(" "),a("p",[t._v("read 5 返回 N个字节 0 或 -1 断开链接 分别处理即可")]),t._v(" "),a("p",[t._v("C10K 只在一个线程里面, 或分成一个线程接收装进list, 数个线程分片遍历list (netty的boss和work模型)")]),t._v(" "),a("p",[t._v("弊端 1线程 C10K 问题")]),t._v(" "),a("p",[t._v("调用的过程, 用户态, 内核态 切换, 保护现场(计组), 假设1万个连接, 1个发来数据, 一个循环里全量遍历(系统调用)O(n)造成9999个浪费")]),t._v(" "),a("p",[t._v("实际上是程序和内核的调用太远, 需要较高的代价")])]),t._v(" "),a("h4",{attrs:{id:"多路复用器-select-poll-epoll"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多路复用器-select-poll-epoll"}},[t._v("#")]),t._v(" 多路复用器 select poll epoll")]),t._v(" "),a("blockquote",[a("p",[t._v("内核的select系统调用, 传参读, 写, 事件, 允许")]),t._v(" "),a("p",[a("code",[t._v("man 2 select")])]),t._v(" "),a("p",[t._v("先监听, 程序调用")]),t._v(" "),a("p",[t._v("select(3) , 询问有没有连接?")]),t._v(" "),a("p",[t._v("accept(3) = 5 如果有连接, 返回 5")]),t._v(" "),a("p",[t._v("select(3, 5), 继续询问有没有连接, 且有没有数据?")]),t._v(" "),a("p",[t._v("如果有数据到达, 连接")]),t._v(" "),a("p",[t._v("accept(3) = 6, recv(5) .. 再将5放入select循环")]),t._v(" "),a("p",[t._v("select 传参数据量限制 1024fd")]),t._v(" "),a("p",[t._v("弊端")]),t._v(" "),a("p",[t._v("每次循环重复传递数据")]),t._v(" "),a("p",[t._v("每次调用内核需要遍历参数")]),t._v(" "),a("p",[t._v("让内核开辟空间存储参数")])]),t._v(" "),a("h4",{attrs:{id:"epoll"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#epoll"}},[t._v("#")]),t._v(" epoll")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("man")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" epoll_create \nepoll_create\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开辟内存空间, 返回id(内存空间)")]),t._v("\nepoll_ctl\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对指定id的内存空间, 控制需要监听的对象, 监听的事件")]),t._v("\nepoll_wait\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对指定id放置事件集合并返回使用")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("blockquote",[a("p",[t._v("多路复用器只能给application返回状态")]),t._v(" "),a("p",[t._v("不能够读取数据, 程序自己需要调用rw IO")]),t._v(" "),a("p",[t._v("同步IO模型/IO同步模型, 无论是在当前线程还是其他线程, 都是application自己读写, 分为BIO NIO")]),t._v(" "),a("p",[t._v("异步IO模型, 没有阻塞, 调用了内核的方法并有回调函数, 内核帮你读写IO, application直接得到数据, 如WIN的IOCP")]),t._v(" "),a("p",[t._v("java nio 中的 selector 是linux的多路复用器(select poll epoll)")]),t._v(" "),a("p",[t._v("默认优先使用内核支持的, 启动时配置参数选择使用哪个多路复用器, 所有网络IO应用都是一样")])])])}),[],!1,null,null,null);s.default=e.exports}}]);