(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{393:function(v,l,a){"use strict";a.r(l);var t=a(45),_=Object(t.a)({},(function(){var v=this,l=v.$createElement,a=v._self._c||l;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h1",{attrs:{id:"spring-cloud"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud"}},[v._v("#")]),v._v(" Spring Cloud")]),v._v(" "),a("h4",{attrs:{id:"第一节课-微服务概述-简单的hello-world"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一节课-微服务概述-简单的hello-world"}},[v._v("#")]),v._v(" 第一节课: 微服务概述, 简单的hello world")]),v._v(" "),a("h4",{attrs:{id:"第二节-eureka-gateway-feign-resttemplate-讲解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二节-eureka-gateway-feign-resttemplate-讲解"}},[v._v("#")]),v._v(" 第二节: Eureka, Gateway, Feign/RestTemplate 讲解")]),v._v(" "),a("ul",[a("li",[a("p",[v._v("概述:")]),v._v(" "),a("ol",[a("li",[v._v("RESTFUL: HTTP返回码规定 400为客户端错误, 500为服务端错误")]),v._v(" "),a("li",[v._v("主键查询的, 推荐将主键写在url中; 基于属性的写在url的?后作为参数")]),v._v(" "),a("li",[v._v("简单描述了 zuul, ribbon, monitor, hystrix, turbine")])])]),v._v(" "),a("li",[a("p",[v._v("Eureka")]),v._v(" "),a("ul",[a("li",[v._v("简单概述: 分为实例instance, 客户端client, 服务端server, 三个维度")]),v._v(" "),a("li",[v._v("调优参数 instance:\n"),a("ul",[a("li",[v._v("多久没收到心跳的超时时间, 默认90秒, 生产30秒")]),v._v(" "),a("li",[v._v("client多久给server发送一次心跳: 默认30秒, 生产10秒")]),v._v(" "),a("li",[v._v("是否使用ip地址: 生产true, 配合hostname使用")])])]),v._v(" "),a("li",[v._v("client:\n"),a("ul",[a("li",[v._v("是否注册到注册中心: 本地开发可以false")]),v._v(" "),a("li",[v._v("是否拉取服务列表: 肯定需要")]),v._v(" "),a("li",[v._v("拉取服务列表的间隔: 默认30秒, 生产10秒或5秒")])])]),v._v(" "),a("li",[v._v("server:\n"),a("ul",[a("li",[v._v("是否开启自我保护: 生产环境true")]),v._v(" "),a("li",[v._v("清理无效服务的间隔: 默认60秒, 生产30秒")])])])])]),v._v(" "),a("li",[a("p",[v._v("Gateway")]),v._v(" "),a("ul",[a("li",[a("p",[v._v("应用: 灰度发布, 服务迁移(新接口上线, 原接口继续提供服务, 给调用方足够时间进行迁移)")])]),v._v(" "),a("li",[a("p",[v._v("流程: 请求, 匹配, 路由, 过滤, 转发到目标, 目标按原路径返回")])]),v._v(" "),a("li",[a("p",[v._v("使用: 推荐修改网关日志级别, info无法看到转发日志")]),v._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[v._v("reactor.ipc.netty：debug\norg.springframework.cloud.gateway：trace\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br"),a("span",{staticClass:"line-number"},[v._v("2")]),a("br")])])]),v._v(" "),a("li",[a("p",[v._v("断言: 是否转发, 控制用;   过滤器: 修改请求头, url")])]),v._v(" "),a("li",[a("p",[v._v("应用:")]),v._v(" "),a("ul",[a("li",[v._v("用filter实现计算请求耗时")]),v._v(" "),a("li",[v._v("网关和注册中心组合使用, ribbon决定一个实例调用")])])])])])]),v._v(" "),a("h4",{attrs:{id:"第三节-ribbon-hystrix-springadmin-apollo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三节-ribbon-hystrix-springadmin-apollo"}},[v._v("#")]),v._v(" 第三节: Ribbon, Hystrix, SpringAdmin, Apollo")]),v._v(" "),a("ul",[a("li",[a("p",[v._v("Ribbon")]),v._v(" "),a("ul",[a("li",[a("p",[v._v("7种负载均衡策略: 轮询, 最小并发, 权重, 重试...")])]),v._v(" "),a("li",[a("p",[v._v("使用apache abtest工具进行测试")]),v._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[v._v("ab -n "),a("span",{pre:!0,attrs:{class:"token number"}},[v._v("1000")]),v._v(" -c "),a("span",{pre:!0,attrs:{class:"token number"}},[v._v("1")]),v._v(" http://localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("..")]),v._v(".\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[v._v("#用1个线程, 发送1000次")]),v._v("\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br")])])]),v._v(" "),a("li",[a("p",[v._v("参数调优")]),v._v(" "),a("ul",[a("li",[a("p",[v._v("全局配置 && 单个微服务配置")])]),v._v(" "),a("li",[a("p",[v._v("默认是开启重试, 可能会有重试报文, 行内接口幂等性没有保障, 目前只开启GET请求的重试")])]),v._v(" "),a("li",[a("p",[v._v("连接超时, 读取超时时间, 生产配置")]),v._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[v._v("ConnetTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(":")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[v._v("2000")]),v._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[v._v("ReadTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(":")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[v._v("5000 (包括重试的时间)")]),v._v("\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br"),a("span",{staticClass:"line-number"},[v._v("2")]),a("br")])])])])])])]),v._v(" "),a("li",[a("p",[v._v("Hystrix")]),v._v(" "),a("ul",[a("li",[v._v("隔离: 限制调用资源, 隔离不可用服务, 防止雪崩")]),v._v(" "),a("li",[v._v("降级: 降级接口返回兜底数据")]),v._v(" "),a("li",[v._v("熔断: 达到失败率后进行降级, 重试成功后恢复")]),v._v(" "),a("li",[v._v("缓存: 合并请求机制 (生产没有用,说是对代码有侵入性)")]),v._v(" "),a("li",[a("strong",[v._v("降级是客户端的策略, 和服务端无关")])]),v._v(" "),a("li",[v._v("熔断器状态: Closed(正常调用) - Open(调用降级) - Half-Open(一段时间会进入的半开状态)")]),v._v(" "),a("li",[v._v("配置\n"),a("ul",[a("li",[v._v("Hystrix请求的超时时间, 一般小于Ribbon的读取超时")]),v._v(" "),a("li",[v._v("在一个滑动窗口(默认10秒)中打开断路器的最少请求数")]),v._v(" "),a("li",[v._v("将开启的断路器置为半开状态的等待时间")]),v._v(" "),a("li",[v._v("错误百分比")]),v._v(" "),a("li",[v._v("配置Hystrix请求线程池")]),v._v(" "),a("li",[v._v("设置统计滑动窗口时间间隔")]),v._v(" "),a("li",[v._v("设置滑动窗口被分成多少个桶bucket")])])]),v._v(" "),a("li",[v._v("调优\n"),a("ul",[a("li",[v._v("隔离方案: 核心数量,最大数量..")]),v._v(" "),a("li",[v._v("线程隔离(会发生ThreadLocal数据丢失)")]),v._v(" "),a("li",[v._v("信号量隔离: 最大信号量")]),v._v(" "),a("li",[v._v("Hystrix超时时间 5秒")])])])])]),v._v(" "),a("li",[a("p",[v._v("Spring Boot Admin (行内用普罗米修斯)")]),v._v(" "),a("ul",[a("li",[v._v("搭建, 查看服务状态线程数内存, 测量请求, 查看运行时环境, 查看真正加载的配置, 定时任务, 动态修改日志级别, JVM, 线程, HeapDump, Web, Audit")])])]),v._v(" "),a("li",[a("p",[v._v("Apollo")]),v._v(" "),a("ul",[a("li",[v._v("概述: 依赖, @EnableApolloConfig, 配置")]),v._v(" "),a("li",[v._v("功能: 配置, 回滚, 灰度, 公共配置, 配置历史版本查看")])])])]),v._v(" "),a("h4",{attrs:{id:"第四节-水星平台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第四节-水星平台"}},[v._v("#")]),v._v(" 第四节: 水星平台")]),v._v(" "),a("h4",{attrs:{id:"第五节-星云平台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第五节-星云平台"}},[v._v("#")]),v._v(" 第五节: 星云平台")]),v._v(" "),a("p",[v._v("架构: 鄞州江北双中心双活(镜像副本)")]),v._v(" "),a("ul",[a("li",[v._v("旧架构\n"),a("ul",[a("li",[v._v("每个中心有四个域 网银APP, OA前置...")]),v._v(" "),a("li",[v._v("每个域都有单独一套微服务架构: 注册中心, 网关, 属于该域的微服务")]),v._v(" "),a("li",[v._v("域内调用，直接通过域内注册中心获取实例调用即可")]),v._v(" "),a("li",[v._v("跨域调用，（路由网关将微服务代理注册到注册中心）通过路由网关进行跨域调用")]),v._v(" "),a("li",[v._v("跨中心调用，根据全行注册中心转发调用")])])]),v._v(" "),a("li",[v._v("新架构\n"),a("ul",[a("li",[v._v("目的是去除的注册中心，只有全行注册中心，实现直接通过注册中心调用")])])])]),v._v(" "),a("p",[v._v("坑: 在星云空间站注册过程中域选择错误，此时脚本已经派发（Apollo配置），需要重新手动修改")]),v._v(" "),a("p",[v._v("边车 sidecar：一个系统需要一个边车进行代理（路由转发），服务被代理注册到注册中心 (目前用的少，还在试点，后续主推)")]),v._v(" "),a("p",[v._v("接口限流是使用guava令牌桶算法实现的")]),v._v(" "),a("p",[v._v("水星星云平台新老系统traceid兼容问题(skywalking和sleuth) (OpenTracing规范)")]),v._v(" "),a("p",[v._v("页面调用，注解跳过token校验，安全性请自己控制")])])}),[],!1,null,null,null);l.default=_.exports}}]);