(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{384:function(a,t,s){"use strict";s.r(t);var e=s(45),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"garbage-collector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#garbage-collector"}},[a._v("#")]),a._v(" Garbage Collector")]),a._v(" "),s("ul",[s("li",[a._v("GC tuning GC调优")])]),a._v(" "),s("h2",{attrs:{id:"第六节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第六节"}},[a._v("#")]),a._v(" 第六节")]),a._v(" "),s("h3",{attrs:{id:"垃圾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾"}},[a._v("#")]),a._v(" 垃圾")]),a._v(" "),s("blockquote",[s("p",[a._v("没有任何引用指向的对象")])]),a._v(" "),s("h3",{attrs:{id:"java-vs-c"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-vs-c"}},[a._v("#")]),a._v(" java vs C++")]),a._v(" "),s("blockquote",[s("p",[a._v("GC处理垃圾")]),a._v(" "),s("p",[a._v("开发效率高, 执行效率低")])]),a._v(" "),s("blockquote",[s("p",[a._v("手工处理垃圾")]),a._v(" "),s("ul",[s("li",[a._v("忘记回收 - 内存泄漏")]),a._v(" "),s("li",[a._v("回收多次 - 非法访问")])]),a._v(" "),s("p",[a._v("开发效率低, 执行效率高")])]),a._v(" "),s("h3",{attrs:{id:"如何找到垃圾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何找到垃圾"}},[a._v("#")]),a._v(" 如何找到垃圾")]),a._v(" "),s("h4",{attrs:{id:"reference-count-引用计数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reference-count-引用计数"}},[a._v("#")]),a._v(" reference count 引用计数")]),a._v(" "),s("h6",{attrs:{id:"rc-不能解决的-循环引用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rc-不能解决的-循环引用"}},[a._v("#")]),a._v(" RC 不能解决的 : 循环引用")]),a._v(" "),s("h4",{attrs:{id:"root-searching-根可达算法-背过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#root-searching-根可达算法-背过"}},[a._v("#")]),a._v(" Root Searching 根可达算法 背过")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627094213660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596115130557"}})]),a._v(" "),s("blockquote",[s("p",[a._v("从 roots 开始找, 如过引用不到的视为垃圾")]),a._v(" "),s("p",[a._v("包括")]),a._v(" "),s("ul",[s("li",[a._v("JVM stack 线程栈(main线程栈帧里面引用的对象)")]),a._v(" "),s("li",[a._v("native method stack 调用C, C++本地方法中引用的对象")]),a._v(" "),s("li",[a._v("run-time constant pool 常量池, 类对象T.class")]),a._v(" "),s("li",[a._v("static references in method area 静态变量引用到的对象")]),a._v(" "),s("li",[a._v("Clazz")])])]),a._v(" "),s("h4",{attrs:{id:"gc-algorithms-gc算法-背过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gc-algorithms-gc算法-背过"}},[a._v("#")]),a._v(" GC Algorithms GC算法 背过")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627174830189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596115546166"}})]),a._v(" "),s("h5",{attrs:{id:"mark-sweep-标记清理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mark-sweep-标记清理"}},[a._v("#")]),a._v(" Mark-Sweep 标记清理")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/2020062717491829.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596116873496"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627174953567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596117131864"}})]),a._v(" "),s("blockquote",[s("p",[a._v("标记可回收的, 然后回收")]),a._v(" "),s("p",[a._v("特点")]),a._v(" "),s("ul",[s("li",[a._v("算法相对简单, 存活对象比较多的情况下效率较高")]),a._v(" "),s("li",[a._v("两边扫描, 效率偏低, 容易产生碎片")])])]),a._v(" "),s("h5",{attrs:{id:"coping-拷贝"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coping-拷贝"}},[a._v("#")]),a._v(" Coping 拷贝")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627175148736.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596117227377"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627175227453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596117308749"}})]),a._v(" "),s("blockquote",[s("p",[a._v("将内存一分为二, 把搜索到的有用的对象全部copy到另侧, 直到最后清掉掉一侧")]),a._v(" "),s("p",[a._v("特点 适用于Eden区")]),a._v(" "),s("ul",[s("li",[a._v("适用于存活对象较少的情况, 只需扫描一次, 没有碎片")]),a._v(" "),s("li",[a._v("空间浪费(内存减半), 移动复制对象, 还要调整引用")])])]),a._v(" "),s("h5",{attrs:{id:"mark-compact-标记压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mark-compact-标记压缩"}},[a._v("#")]),a._v(" Mark-Compact 标记压缩")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627175338911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596117538042"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627175503161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596117649338"}})]),a._v(" "),s("blockquote",[s("p",[a._v("标记并在内存中从头排列")]),a._v(" "),s("ul",[s("li",[a._v("不会产生碎片, 不会内存减半")]),a._v(" "),s("li",[a._v("扫描两次, 移动对象, 修改引用")])])]),a._v(" "),s("h4",{attrs:{id:"堆内存逻辑分区-不适用不分代垃圾收集器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#堆内存逻辑分区-不适用不分代垃圾收集器"}},[a._v("#")]),a._v(" 堆内存逻辑分区 (不适用不分代垃圾收集器)")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627183644962.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596117885666"}})]),a._v(" "),s("h3",{attrs:{id:"jvm分代模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm分代模型"}},[a._v("#")]),a._v(" JVM分代模型")]),a._v(" "),s("blockquote",[s("p",[a._v("Epsilon, ZGC , Shenandoah 不使用逻辑分代模型")]),a._v(" "),s("p",[a._v("G1是逻辑分代, 物理不分代")])]),a._v(" "),s("h5",{attrs:{id:"逻辑分代模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#逻辑分代模型"}},[a._v("#")]),a._v(" 逻辑分代模型")]),a._v(" "),s("blockquote",[s("p",[a._v("把内存分为 新生代 + 老年代 + 永久代(1.7)/元数据区(1.8)")]),a._v(" "),s("p",[a._v("新生代, 老年代属于堆")])]),a._v(" "),s("h6",{attrs:{id:"新生代-new-young"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新生代-new-young"}},[a._v("#")]),a._v(" 新生代 new/young")]),a._v(" "),s("blockquote",[s("ul",[s("li",[a._v("eden")]),a._v(" "),s("li",[a._v("survivor")]),a._v(" "),s("li",[a._v("survivor")])]),a._v(" "),s("p",[a._v("默认比例 8:1:1")])]),a._v(" "),s("h6",{attrs:{id:"老年代-old-tenured"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#老年代-old-tenured"}},[a._v("#")]),a._v(" 老年代 old/tenured")]),a._v(" "),s("p",[a._v("比例默认1:2 NewRatio "),s("code",[a._v("java -XX:PrintFlagsFinal -version | grep NewRatio")])]),a._v(" "),s("h6",{attrs:{id:"永久代-元数据区-method-area-方法区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#永久代-元数据区-method-area-方法区"}},[a._v("#")]),a._v(" 永久代/元数据区 (method area 方法区)")]),a._v(" "),s("blockquote",[s("ul",[s("li",[a._v("存放Class数据 代码编译完的信息 字节码 动态生成的class")]),a._v(" "),s("li",[a._v("永久代必须指定大小, 而元数据允许不设置(无上限) - Perm Generation 容易溢出")]),a._v(" "),s("li",[a._v("字符串常量放在永久代, 1.8开始放在堆")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627180636132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596118341186"}})]),a._v(" "),s("blockquote",[s("p",[a._v("对象首先在栈上分配, 分配不下进入Eden区, 经过垃圾回收一次之后进入S1/S2(from/to) , 第二次垃圾回收后将Eden和S1的对象放入S2, 经过多次重复流程之后进入Old区")])]),a._v(" "),s("h4",{attrs:{id:"gc概念-专业名词-ygc-fullgc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gc概念-专业名词-ygc-fullgc"}},[a._v("#")]),a._v(" GC概念 专业名词 YGC FullGC")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627180740592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596118578404"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627180757667.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596118896735"}})]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("Minor/YGC(Young GC)")]),a._v(" : 在年轻代进行回收的 , 新生代空间不足")]),a._v(" "),s("p",[s("code",[a._v("MajorGC/FullGC")]),a._v(" : 整个区域进行回收, Old空间不足, "),s("code",[a._v("System.gc()")])])]),a._v(" "),s("h6",{attrs:{id:"栈上分配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#栈上分配"}},[a._v("#")]),a._v(" 栈上分配")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("线程私有")]),a._v(", "),s("strong",[a._v("小对象")])]),a._v(" "),s("p",[a._v("无逃逸 - 在某一段代码块里, 作用域小")]),a._v(" "),s("p",[a._v("支持标量替换 - 简单对象, 可以用普通类型来代替这个对象")])]),a._v(" "),s("h6",{attrs:{id:"线程本地分配-thread-local-allocation-buffer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程本地分配-thread-local-allocation-buffer"}},[a._v("#")]),a._v(" 线程本地分配 Thread Local Allocation Buffer")]),a._v(" "),s("blockquote",[s("p",[a._v("防止多线程抢占Eden区内存位置, 给每个线程独有的内存空间(默认为Eden大小的1%) 避免线程间争用")])]),a._v(" "),s("h6",{attrs:{id:"对象进入老年代"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象进入老年代"}},[a._v("#")]),a._v(" 对象进入老年代")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627182937537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596119681219"}})]),a._v(" "),s("blockquote",[s("p",[a._v("次数到达 或 s1 s2互相拷贝超过50%")])]),a._v(" "),s("h6",{attrs:{id:"动态年龄"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态年龄"}},[a._v("#")]),a._v(" 动态年龄")]),a._v(" "),s("blockquote",[s("p",[a._v("具体百分比")])]),a._v(" "),s("h6",{attrs:{id:"分配担保"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分配担保"}},[a._v("#")]),a._v(" 分配担保")]),a._v(" "),s("blockquote",[s("p",[a._v("survivor区满了, 还没YGC, 新来的对象直接进入老年代")])]),a._v(" "),s("h4",{attrs:{id:"总结-对象的生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结-对象的生命周期"}},[a._v("#")]),a._v(" 总结 对象的生命周期")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627183302453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596120184693"}})]),a._v(" "),s("h4",{attrs:{id:"常见的垃圾回收期-背过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的垃圾回收期-背过"}},[a._v("#")]),a._v(" 常见的垃圾回收期 背过")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627195409737.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596168544677"}})]),a._v(" "),s("h6",{attrs:{id:"serial-serial-old"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serial-serial-old"}},[a._v("#")]),a._v(" serial + serial Old")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627190046652.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596168742941"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627190331505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596169008731"}})]),a._v(" "),s("blockquote",[s("p",[a._v("当GC干活的时候, 所有工作线程全部停止 STW (stop-the-world)")]),a._v(" "),s("p",[a._v("safe point 线程需要找到安全点才能停止 (马上停止可能会有问题的情况下)")]),a._v(" "),s("p",[a._v("serial 最早的垃圾回收器, 现在用的极少")])]),a._v(" "),s("h6",{attrs:{id:"parallel-scavnge-parallel-old"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parallel-scavnge-parallel-old"}},[a._v("#")]),a._v(" Parallel Scavnge + Parallel Old")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627190411863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596169121914"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627190452589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596169239568"}})]),a._v(" "),s("blockquote",[s("p",[a._v("如果上线没有对JVM做任何指定GC的设置, 默认的就是 PS + PO")]),a._v(" "),s("p",[a._v("也是STW , 不过是多线程的GC")])]),a._v(" "),s("h6",{attrs:{id:"parnew-parallel-new"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parnew-parallel-new"}},[a._v("#")]),a._v(" ParNew (Parallel New)")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/2020062719054837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596169350075"}})]),a._v(" "),s("blockquote",[s("p",[a._v("和 Parallel Scavenge 相似, 只是为了兼容CMS进行了优化, 可以和CMS某些阶段一起运行")])]),a._v(" "),s("p",[a._v("ParNew VS Parallel Scavenge")]),a._v(" "),s("blockquote",[s("p",[a._v("ParNew 响应时间优先, 配合CMS")]),a._v(" "),s("p",[a._v("Parallel Scavenge 吞吐量优先")])]),a._v(" "),s("h6",{attrs:{id:"cms-非常重要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms-非常重要"}},[a._v("#")]),a._v(" CMS 非常重要")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627190743289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596169727392"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627191021114.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596170109790"}})]),a._v(" "),s("blockquote",[s("p",[a._v("concurrent mark sweep 并发")]),a._v(" "),s("p",[a._v("并发回收, 并发标记和工作线程可以同时运行")]),a._v(" "),s("p",[a._v("并发回收是因为无法忍受STW")]),a._v(" "),s("p",[a._v("CMS 的四个阶段")]),a._v(" "),s("ul",[s("li",[a._v("初始标记, 只标记根对象")]),a._v(" "),s("li",[a._v("并发标记, 最浪费时间的, 标记现有能找到的对象(根可达)")]),a._v(" "),s("li",[a._v("重新标记, 标记上个并发阶段发生改变的对象 (新的垃圾, 或者垃圾被重新引用, 取消垃圾标记)")]),a._v(" "),s("li",[a._v("并发清理, 并发过程中产生的垃圾(浮动垃圾), 需要下次CMS清理")])]),a._v(" "),s("p",[a._v("CMS 六个阶段还有预标记和整理")])]),a._v(" "),s("h5",{attrs:{id:"cms-缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms-缺点"}},[a._v("#")]),a._v(" CMS 缺点")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200627192748411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596202219383"}})]),a._v(" "),s("h6",{attrs:{id:"memory-fragmentation-内存碎片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#memory-fragmentation-内存碎片"}},[a._v("#")]),a._v(" Memory Fragmentation 内存碎片")]),a._v(" "),s("blockquote",[s("p",[a._v("因为是Mark Sweep, 会产生内存碎片, 当内存存不下的时候会使用 Serial Old 进行压缩, 慢")])]),a._v(" "),s("h6",{attrs:{id:"floating-garbage-浮动垃圾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#floating-garbage-浮动垃圾"}},[a._v("#")]),a._v(" Floating Garbage 浮动垃圾")]),a._v(" "),s("blockquote",[s("p",[a._v("没有清理的浮动垃圾, 也一样会导致内存满, 要用 Serial Old 标记清理")])]),a._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[a._v("Concurrent Mode Failure 解决方案, 降低触发CMS的阈值,")])]),a._v(" "),s("li",[s("p",[a._v("PromotionFailed")])])]),a._v(" "),s("p",[a._v("–XX:CMSInitiatingOccupancyFraction 92% 老年代占92%的时候产生FGC , 可以调低 保持老年代有足够的空间")])]),a._v(" "),s("h5",{attrs:{id:"并发标记的算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并发标记的算法"}},[a._v("#")]),a._v(" 并发标记的算法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("三色扫描算法\n\t- 白 灰 黑\n在并发标记时, 引用可能产生变化, 白色对象有可能被错误回收\n解决方案\n\tSATB\n\t- snapshot at the beginning 起始时做一个快照\n\t- 当B->D消失时, 要把这个引用推到GC的堆栈, 保证D还能被GC扫描到\n\tIncremental Update\n\t- 当一个白色对象被一个黑色引用\n\t- 将黑色对象重新标记为灰色, 让collector重新扫描\n\t\n  ---- (A黑)--  自己已经被标记, fields都标记完成\n  |\t  |\t\t|\n  V\t  |\t\tV\n (B灰) |\t   (C灰) 自己标记完成, 还没来得及标记fields\n  |\t  |\t\n  V\t  |\t\n (D白)<- 没有遍历到的节点\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br")])]),s("blockquote",[s("p",[a._v("CMS 使用 三色标记 + Incremental Update")]),a._v(" "),s("p",[a._v("G1 使用 三色标记 + SATB  写屏障指的RSet的额外指针记录")]),a._v(" "),s("p",[a._v("ZGC 使用 ColoredPointers 颜色指针 + LoadBarrier")]),a._v(" "),s("p",[a._v("Shenandoah 使用 ColoredPointers + WriteBarrier")])]),a._v(" "),s("h2",{attrs:{id:"第七节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第七节"}},[a._v("#")]),a._v(" 第七节")]),a._v(" "),s("h4",{attrs:{id:"常见垃圾回收期组合参数设定-参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见垃圾回收期组合参数设定-参考文档"}},[a._v("#")]),a._v(" 常见垃圾回收期组合参数设定 (参考文档)")]),a._v(" "),s("blockquote",[s("ul",[s("li",[a._v("-XX:+UseSerialGC = Serial New (DefNew) + Serial Old\n"),s("ul",[s("li",[a._v("小型程序。默认情况下不会是这种选项，HotSpot会根据计算及配置和JDK版本自动选择收集器")])])]),a._v(" "),s("li",[a._v("-XX:+UseParNewGC = ParNew + SerialOld\n"),s("ul",[s("li",[a._v("这个组合已经很少用（在某些版本中已经废弃）")])])]),a._v(" "),s("li",[a._v("-XX:+UseConc"),s("font",{attrs:{color:"red"}},[a._v("(urrent)")]),a._v("MarkSweepGC = ParNew + CMS + Serial Old\n"),s("ul",[s("li",[a._v("红色部分有些版本需要加上")])])],1),a._v(" "),s("li",[a._v("-XX:+UseParallelGC = Parallel Scavenge + Parallel Old (1.8默认) 【PS + SerialOld】\n"),s("ul",[s("li",[a._v("这是jdk1.8默认的GC组合")])])]),a._v(" "),s("li",[a._v("-XX:+UseParallelOldGC = Parallel Scavenge + Parallel Old\n"),s("ul",[s("li",[a._v("和上面其实是一样的")])])]),a._v(" "),s("li",[a._v("-XX:+UseG1GC = G1")]),a._v(" "),s("li",[a._v("Linux中没找到默认GC的查看方法，而windows中会打印UseParallelGC\n"),s("ul",[s("li",[a._v("java +XX:+PrintCommandLineFlags -version")]),a._v(" "),s("li",[a._v("通过GC的日志来分辨")])])]),a._v(" "),s("li",[a._v("Linux下1.8版本默认的垃圾回收器到底是什么？\n"),s("ul",[s("li",[a._v("1.8.0_181 默认（看不出来）Copy MarkCompact")]),a._v(" "),s("li",[a._v("1.8.0_222 默认 PS + PO")])])])])]),a._v(" "),s("h4",{attrs:{id:"java-命令行参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-命令行参数"}},[a._v("#")]),a._v(" java 命令行参数")]),a._v(" "),s("blockquote",[s("p",[a._v("java 命令以 "),s("code",[a._v("-")]),a._v("为开头的为标准参数, 所有java(Hotspot)版本都支持")]),a._v(" "),s("p",[a._v("以 "),s("code",[a._v("-X")]),a._v(" 开头的是非标准参数, 特定版本支持 "),s("code",[a._v("java -X")]),a._v(" 浏览参数列表")]),a._v(" "),s("p",[a._v("以 "),s("code",[a._v("-XX")]),a._v(" 开头是不稳定参数 , 每个版本有自己的参数, 可能版本之间互相不支持")]),a._v(" "),s("p",[a._v("参数多且难找:  "),s("code",[a._v("java -XX:+PrintFlagsFinal -version")])])]),a._v(" "),s("blockquote",[s("ul",[s("li",[a._v("java -XX:+PrintCommandLineFlags HelloGC")])]),a._v(" "),s("p",[a._v("打印默认命令行并执行class文件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("-XX:InitialHeapSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15932416")]),a._v(" -XX:MaxHeapSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("254918656")]),a._v(" -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops \n初始化堆大小"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("根据系统内存自动生成"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" 最大堆大小 打印命令行参数 压缩Class指针 压缩普通对象"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Oops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("指针\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("ul",[s("li",[a._v("java -Xmn10M -Xms40M -Xmx60M -XX:+PrintCommandLineFlags -XX:+PrintGC  HelloGC")])]),a._v(" "),s("p",[a._v("-Xmn设置新生代大小 -Xms设置堆初始大小 -Xmx设置堆最大")]),a._v(" "),s("p",[a._v("不要设置弹性的堆大小, 会浪费CPU资源, 一般设置一样的大小")]),a._v(" "),s("p",[a._v("-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCCause 额外打印信息")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("-XX:InitialHeapSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("41943040")]),a._v(" -XX:MaxHeapSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("62914560")]),a._v(" -XX:MaxNewSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10485760")]),a._v(" -XX:NewSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10485760")]),a._v(" -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+UseCompressedClassPointers -XX:+UseCompressedOops\nNewSize 新生代size\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  7839K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("7440K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("39936K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0925999")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# GC就是YGC (产生的原因) GC前后堆内存占用大小改变(总大小) 耗时")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  14769K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("14607K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("39936K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0747293")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  21928K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("21775K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("39936K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0577378")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  29099K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("28944K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("39936K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0796919")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  36269K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("36112K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("45076K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0103972")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 年轻代装不下, 直接扔Old区, 产生FGC")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Full GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  36112K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("36111K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("45076K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0037206")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  43437K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("43279K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("60416K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0834926")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  50604K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("50447K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("60416K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0611777")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Full GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  57774K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("57616K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("60416K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0040532")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Full GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  57616K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("57604K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("60416K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0027953")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nException "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java.lang.OutOfMemoryError: Java heap space\n\tat HelloGC.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("HelloGC.java:8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("ul",[s("li",[a._v("java -XX:+UseConcMarkSweepGC -XX:+PrintCommandLineFlags -XX:+PrintGC HelloGC")])]),a._v(" "),s("p",[a._v("使用CMS, 日志会记录一些CMS过程状态")]),a._v(" "),s("div",{staticClass:"language-BASH line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  15775K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("15653K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("21012K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0103442")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CMS Initial Mark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  19832K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("21012K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0242883")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  19832K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("19739K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("25124K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0125751")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  28017K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("27931K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("33348K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0128556")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CMS Final Remark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  32113K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("33348K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0039098")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  32112K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("32026K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("51476K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0099416")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Full GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  240923K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("240923K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("241600K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0018960")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Full GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  240923K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("240911K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("241600K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0348611")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nException "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CMS Initial Mark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  241420K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("241600K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0007835")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\njava.lang.OutOfMemoryError: Java heap space\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("ul",[s("li",[a._v("java -XX:+PrintFlagsInitial 默认参数值")]),a._v(" "),s("li",[a._v("java -XX:+PrintFlagsFinal 最终参数值")]),a._v(" "),s("li",[a._v("java -XX:+PrintFlagsFinal | grep xxx 找到对应的参数")]),a._v(" "),s("li",[a._v("java -XX:+PrintFlagsFinal -version |grep GC")])])]),a._v(" "),s("h4",{attrs:{id:"gc日志查看-日志格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gc日志查看-日志格式"}},[a._v("#")]),a._v(" GC日志查看 日志格式")]),a._v(" "),s("ul",[s("li",[a._v("java -Xmn10M -Xms40M -Xmx60M -XX:+PrintCommandLineFlags -XX:+PrintGCDetails  HelloGC")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("DefNew: 7839K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("272K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("9216K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0501925")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" 年轻代 GC前占用-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("GC后"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("年轻代size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" 耗时\n7839K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("7440K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("39936K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0503506")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" 堆 GC前占用-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("GC后"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("堆size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" 耗时\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Times: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.01")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("sys")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.05")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("real")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.05")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("time")]),a._v(" ls命令 占用用户/内核/实际 时间\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("DefNew: 7578K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("7578K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("9216K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0000167")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Tenured: 50196K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("50196K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("51200K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0048683")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \n57774K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("57616K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("60416K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Metaspace: 3091K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("3091K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("1056768K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0049403")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Times: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.01")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("sys")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("real")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.01")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Full GC "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Allocation Failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Tenured: 50196K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("50196K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("51200K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0025147")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \n57616K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("57604K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("60416K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Metaspace: 3091K-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("3091K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("1056768K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0025422")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Times: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("sys")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("real")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v(" secs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" \nException "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java.lang.OutOfMemoryError: Java heap space\n\tat HelloGC.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("HelloGC.java:8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nHeap "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 堆信息 GC只针对堆")]),a._v("\n def new generation   total 9216K, used 7731K "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("0x00000000fc400000, 0x00000000fce00000, 0x00000000fce00000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# [.. )参数分别是 内存开始地址, 内存used到的地址, 内存总大小结束地址")]),a._v("\n  eden space 8192K,  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("94")]),a._v("% used "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("0x00000000fc400000, 0x00000000fcb8cd90, 0x00000000fcc00000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  from space 1024K,   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("% used "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("0x00000000fcd00000, 0x00000000fcd00000, 0x00000000fce00000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  to   space 1024K,   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("% used "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("0x00000000fcc00000, 0x00000000fcc00000, 0x00000000fcd00000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n tenured generation   total 51200K, used 50196K "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("0x00000000fce00000, 0x0000000100000000, 0x0000000100000000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# tenured 是 old区 终身代")]),a._v("\n   the space 51200K,  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("98")]),a._v("% used "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("0x00000000fce00000, 0x00000000fff05098, 0x00000000fff05200, 0x0000000100000000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n Metaspace       used 3125K, capacity 4486K, committed 4864K, reserved 1056768K\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  capacity Metaspace的size; committed虚拟内存中申请的内存块; reserved虚拟内存保留")]),a._v("\n  class space    used 292K, capacity 386K, committed 512K, reserved 1048576K\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br")])]),s("h3",{attrs:{id:"jvm调优"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优"}},[a._v("#")]),a._v(" JVM调优")]),a._v(" "),s("h4",{attrs:{id:"需要了解的基础概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需要了解的基础概念"}},[a._v("#")]),a._v(" 需要了解的基础概念")]),a._v(" "),s("h5",{attrs:{id:"吞吐量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#吞吐量"}},[a._v("#")]),a._v(" 吞吐量")]),a._v(" "),s("p",[a._v("业务代码时间 / (业务代码执行时间 + 垃圾回收时间)")]),a._v(" "),s("h5",{attrs:{id:"响应时间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#响应时间"}},[a._v("#")]),a._v(" 响应时间")]),a._v(" "),s("p",[a._v("STW越短, 响应时间越好")]),a._v(" "),s("h5",{attrs:{id:"平衡以上两者关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#平衡以上两者关系"}},[a._v("#")]),a._v(" 平衡以上两者关系")]),a._v(" "),s("p",[a._v("大数据计算, 数据挖掘, 注重吞吐量, 推荐 PS + PO")]),a._v(" "),s("p",[a._v("网站, api调用, GUI, 注重响应时间, 推荐 (1.8 G1) G1虽然响应时间快, 但是比较占用CPU资源, 吞吐量比CMS低15%")]),a._v(" "),s("h4",{attrs:{id:"调优概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调优概念"}},[a._v("#")]),a._v(" 调优概念")]),a._v(" "),s("ol",[s("li",[a._v("根据需求进行JVM规划和预调优")]),a._v(" "),s("li",[a._v("优化运行JVM运行环境（慢，卡顿）")]),a._v(" "),s("li",[a._v("解决JVM运行过程中出现的各种问题(如OOM)")]),a._v(" "),s("li",[a._v("重启reboot")])]),a._v(" "),s("h4",{attrs:{id:"从规划开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从规划开始"}},[a._v("#")]),a._v(" 从规划开始")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("调优从 业务场景, 业务流程 开始")])]),a._v(" "),s("li",[s("p",[a._v("调优前提是能够从压力测试中看到结果...")])]),a._v(" "),s("li",[s("p",[a._v("非要总结操作步骤的话:")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("根据业务场景, 选择合适的 "),s("u",[a._v("垃圾回收器组合")])]),a._v(" "),s("ol",[s("li",[a._v("业务偏向响应时间, 吞吐量, 还是两者兼顾")])])]),a._v(" "),s("li",[s("p",[a._v("计算内存需求 (很难计算, 比较看经验值, 可能可大可小)")])]),a._v(" "),s("li",[s("p",[a._v("CPU 越强越好")])]),a._v(" "),s("li",[s("p",[a._v("设定参数")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("年代大小, 升级年龄")])]),a._v(" "),s("li",[s("p",[a._v("日志参数")]),a._v(" "),s("ol",[s("li",[s("p",[s("code",[a._v("-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCCause")])]),a._v(" "),s("p",[a._v("这里的命令是5个20M的日志文件循环使用(更新)")])]),a._v(" "),s("li",[s("p",[a._v("或者每天产生一个日志文件")])])])])])]),a._v(" "),s("li",[s("p",[a._v("观察日志情况")])])])])]),a._v(" "),s("h4",{attrs:{id:"问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[a._v("#")]),a._v(" 问题")]),a._v(" "),s("h5",{attrs:{id:"电商每日百万订单-订单处理系统需要什么配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#电商每日百万订单-订单处理系统需要什么配置"}},[a._v("#")]),a._v(" 电商每日百万订单, 订单处理系统需要什么配置?")]),a._v(" "),s("ul",[s("li",[a._v("先找到交易高峰时期, 每秒多少笔交易 比如1000笔/秒, 根据CPU处理时间和每个订单前后产生的对象大小来判断内存是否足够, 因为CPU处理快的话, 产生的对象用完了, 一次YGC就能清理掉")]),a._v(" "),s("li",[a._v("实际应用中应该拿服务器进行压测, 不行就升级CPU和内存")])]),a._v(" "),s("h5",{attrs:{id:"_12306春运抢票支撑-偏架构设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12306春运抢票支撑-偏架构设计"}},[a._v("#")]),a._v(" 12306春运抢票支撑 (偏架构设计)")]),a._v(" "),s("ul",[s("li",[a._v("CDN - LVS - NGINX - 业务系统(单机10K并发)")])]),a._v(" "),s("h5",{attrs:{id:"优化环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化环境"}},[a._v("#")]),a._v(" 优化环境")]),a._v(" "),s("h6",{attrs:{id:"文档网站响应慢-原-1-5g-扩到-16g-反而变卡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文档网站响应慢-原-1-5g-扩到-16g-反而变卡"}},[a._v("#")]),a._v(" 文档网站响应慢, 原 1.5G 扩到 16G 反而变卡")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("为什么原网站慢?")]),a._v(" "),s("p",[a._v("很多用户浏览数据，很多数据load到内存，内存不足，频繁GC，STW长，响应时间变慢")])]),a._v(" "),s("li",[s("p",[a._v("为什么会更卡顿？")]),a._v(" "),s("p",[a._v("内存越大，FGC时间越长")])]),a._v(" "),s("li",[s("p",[a._v("PS + PO 换成 PN + CMS 或 G1")])])]),a._v(" "),s("h6",{attrs:{id:"系统cpu经常100-如何调优-面试高频"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统cpu经常100-如何调优-面试高频"}},[a._v("#")]),a._v(" 系统CPU经常100%, 如何调优? (面试高频)")]),a._v(" "),s("blockquote",[s("p",[a._v("推理 - 一定有线程在占用资源,")]),a._v(" "),s("ol",[s("li",[a._v("首先要找出哪个进程, 哪个线程CPU高 (top -Hp pid)")]),a._v(" "),s("li",[a._v("导出该线程的堆栈信息 (jstack)")]),a._v(" "),s("li",[a._v("查找哪个方法(栈帧)消耗时间, 占用CPU")]),a._v(" "),s("li",[a._v("工作线程和 垃圾回收线程, 哪个占比较高")])])]),a._v(" "),s("h6",{attrs:{id:"系统内存飙高-如何查找问题-面试高频"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统内存飙高-如何查找问题-面试高频"}},[a._v("#")]),a._v(" 系统内存飙高, 如何查找问题? (面试高频)")]),a._v(" "),s("blockquote",[s("ol",[s("li",[a._v("导出堆内存 (jmap)")]),a._v(" "),s("li",[a._v("分析 (jhat jvisualvm mat jprofiler)")])])]),a._v(" "),s("h6",{attrs:{id:"如何监控jvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何监控jvm"}},[a._v("#")]),a._v(" 如何监控JVM")]),a._v(" "),s("blockquote",[s("ol",[s("li",[s("ol",[s("li",[a._v("jstat jvisualvm jprofiler arthas top...")])])])])]),a._v(" "),s("h2",{attrs:{id:"第八节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第八节"}},[a._v("#")]),a._v(" 第八节")]),a._v(" "),s("p",[a._v("例子")]),a._v(" "),s("h3",{attrs:{id:"模拟定位问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模拟定位问题"}},[a._v("#")]),a._v(" 模拟定位问题")]),a._v(" "),s("blockquote",[s("ul",[s("li",[a._v("java -Xms200M -Xmx200M -XX:+PrintGC com.mashibing.jvm.gc.T15_FullGC_Problem01")])]),a._v(" "),s("p",[a._v("测试代码")]),a._v(" "),s("ol",[s("li",[a._v("首先收到报警信息")]),a._v(" "),s("li",[a._v("top 查看问题, 如 CPU 内存 占用异常")]),a._v(" "),s("li",[a._v("使用 top -Hp pid 查看进程内子线程信息, 看哪个线程占用高")]),a._v(" "),s("li",[a._v("jps 和 jstack 定位线程状态, 重点关注 WAITING BLOCKED 线程状态, 看是在等哪个对象的锁 (线程名最好自定义)")]),a._v(" "),s("li",[a._v("通过这个对象地址, 查找 jstack dump 日志中所有相关线程的信息, 找到持有锁的线程(RUNNABLE)")]),a._v(" "),s("li",[a._v("...")]),a._v(" "),s("li",[a._v("最终还是需要找到代码问题")])])]),a._v(" "),s("h5",{attrs:{id:"jps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jps"}},[a._v("#")]),a._v(" jps")]),a._v(" "),s("p",[a._v("只列举Java的进程")]),a._v(" "),s("h4",{attrs:{id:"jstack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstack"}},[a._v("#")]),a._v(" jstack")]),a._v(" "),s("p",[a._v("把所有java线程列出来, 线程名, 调用代码行, 锁对象 ... 等信息")]),a._v(" "),s("h5",{attrs:{id:"jinfo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jinfo"}},[a._v("#")]),a._v(" jinfo")]),a._v(" "),s("p",[a._v("把进程的一些详细信息列出来")]),a._v(" "),s("h5",{attrs:{id:"jstat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstat"}},[a._v("#")]),a._v(" jstat")]),a._v(" "),s("p",[a._v("jstat gc pid 1000 打印各种区的大小, GC时间")]),a._v(" "),s("h5",{attrs:{id:"jconsole"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jconsole"}},[a._v("#")]),a._v(" jconsole")]),a._v(" "),s("p",[a._v("可视化的.. 控制台")]),a._v(" "),s("h4",{attrs:{id:"jvisualvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm"}},[a._v("#")]),a._v(" jvisualvm")]),a._v(" "),s("p",[a._v("比 jconsole 更美观的控制台")]),a._v(" "),s("p",[a._v("远程管理时, java JMX 远程管理/监控java进程的一些参数需要在启动时候配置上")]),a._v(" "),s("p",[a._v("图像界面主要用于测试")]),a._v(" "),s("h5",{attrs:{id:"jprofiler-收费"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jprofiler-收费"}},[a._v("#")]),a._v(" jprofiler 收费")]),a._v(" "),s("h4",{attrs:{id:"jmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jmap"}},[a._v("#")]),a._v(" jmap")]),a._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[s("code",[a._v("jmap -histo pid | head -20")]),a._v(" 查看堆内存占用, 有多少对象产生")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("jmap -dump:format=b,file=xxx pid")]),a._v(" 导出堆文件")])])]),a._v(" "),s("p",[a._v("线上系统内存特别大的时候, jmap执行期间会对进程产生很大影响(卡顿)")]),a._v(" "),s("ol",[s("li",[a._v("设定参数, OOM时候自动产生堆转储文件")]),a._v(" "),s("li",[a._v("很多服务器备份(高可用), 停掉其中一台服务器")]),a._v(" "),s("li",[a._v("在线定位 arthas 工具 (小厂一般不用..)")])])]),a._v(" "),s("h5",{attrs:{id:"jhat-堆分析工具-分析-dump"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jhat-堆分析工具-分析-dump"}},[a._v("#")]),a._v(" jhat 堆分析工具, 分析 dump")]),a._v(" "),s("h2",{attrs:{id:"第九节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第九节"}},[a._v("#")]),a._v(" 第九节")]),a._v(" "),s("h3",{attrs:{id:"arthas-在线排查工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arthas-在线排查工具"}},[a._v("#")]),a._v(" arthas 在线排查工具")]),a._v(" "),s("blockquote",[s("p",[a._v("java -jar arthas-boot.jar")]),a._v(" "),s("p",[a._v("启动后, 选择线程, 自动挂到线程上, 可以在arthas里输入命令进行操作")]),a._v(" "),s("ul",[s("li",[a._v("jvm 查看JVM信息")]),a._v(" "),s("li",[a._v("thread 查看线程情况")]),a._v(" "),s("li",[a._v("dashboard 类似top")]),a._v(" "),s("li",[a._v("heapdump 导出堆文件, 相当于jmap导出dump")])]),a._v(" "),s("p",[a._v("arthas特有功能")]),a._v(" "),s("ul",[s("li",[a._v("jad 反编译\n"),s("ul",[s("li",[a._v("查看动态代理生成类 , 第三方类 , 代码版本问题")])])]),a._v(" "),s("li",[a._v("redefine 热替换\n"),s("ul",[s("li",[a._v("目前还有诸多限制")]),a._v(" "),s("li",[a._v("重新编译class, "),s("code",[a._v("redefine 指定class")])])])])])]),a._v(" "),s("h4",{attrs:{id:"分析-dump-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析-dump-文件"}},[a._v("#")]),a._v(" 分析 dump 文件")]),a._v(" "),s("h5",{attrs:{id:"jhat-分析dump文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jhat-分析dump文件"}},[a._v("#")]),a._v(" jhat 分析dump文件")]),a._v(" "),s("blockquote",[s("ul",[s("li",[a._v("jhat -J-mx512M dump文件")])]),a._v(" "),s("p",[a._v("会在7000端口上开启http服务, 可以看到实例数量, 大小等信息, 还可以使用OQL针对某个类进行查询")])]),a._v(" "),s("h5",{attrs:{id:"jvisualvm-分析dump文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm-分析dump文件"}},[a._v("#")]),a._v(" jvisualvm 分析dump文件")]),a._v(" "),s("blockquote",[s("p",[a._v("在图形界面中读取文件, 直接可以在图形化界面做分析了! 也可以使用OQL")])]),a._v(" "),s("h3",{attrs:{id:"案例汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例汇总"}},[a._v("#")]),a._v(" 案例汇总")]),a._v(" "),s("h5",{attrs:{id:"硬件升级系统反而卡顿"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#硬件升级系统反而卡顿"}},[a._v("#")]),a._v(" 硬件升级系统反而卡顿")]),a._v(" "),s("p",[a._v("内存变大, 选择合适的垃圾回收期")]),a._v(" "),s("h5",{attrs:{id:"线程池运用产生oom问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程池运用产生oom问题"}},[a._v("#")]),a._v(" 线程池运用产生OOM问题")]),a._v(" "),s("h5",{attrs:{id:"smile-jira-问题-提交测试报告系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#smile-jira-问题-提交测试报告系统"}},[a._v("#")]),a._v(" smile jira 问题 提交测试报告系统")]),a._v(" "),s("blockquote",[s("p",[a._v("响应速度慢, 需要频繁重启服务器来保持系统响应")]),a._v(" "),s("p",[a._v("没有买jdk 没有jstack")]),a._v(" "),s("p",[a._v("查看GC日志发现频繁GC, 但是没有OOM, 导出堆dump文件分析没有定位到原因, 最终扩内存升级CPU换G1回收解决问题")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动参数")]),a._v("\n/opt/atlassian/jira/jre/bin/java -Djava.util.logging.config.file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/atlassian/jira/conf/logging.properties -Djava.util.logging.manager"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("org.apache.juli.ClassLoaderLogManager -Xms1024m -Xmx9216m -Djava.awt.headless"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true -Datlassian.standalone"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("JIRA -Dorg.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true -Dmail.mime.decodeparameters"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true -Dorg.dom4j.factory"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.atlassian.core.xml.InterningDocumentFactory -XX:-OmitStackTraceInFastThrow -Datlassian.plugins.startup.options"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" -Djdk.tls.ephemeralDHKeySize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v(" -Djava.protocol.handler.pkgs"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("org.apache.catalina.webresources -Xloggc:/opt/atlassian/jira/logs/atlassian-jira-gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" -XX:GCLogFileSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("20M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCCause -classpath /opt/atlassian/jira/bin/bootstrap.jar:/opt/atlassian/jira/bin/tomcat-juli.jar -Dcataline.base"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/atlassian/jira -Dcatalina.home"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/atlassian/jira -Djava.io.tmpdir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/atlassian/jira/temp org/apache.catalina.startup.Bootstrap start\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("blockquote",[s("p",[s("code",[a._v("-Xloggc:/opt/atlassian/jira/logs/atlassian-jira-gc-%t.log")]),a._v(" 看GC日志, 是否GC频繁, 堆大小设置一致")])]),a._v(" "),s("ul",[s("li",[a._v("日志看 assets文件夹下")])]),a._v(" "),s("blockquote",[s("p",[a._v("发现YGC频繁, 垃圾回收组合是 PS + PO 堆大小是9(2+7)G")]),a._v(" "),s("p",[a._v("jmap , 或配置OOM dump参数 , 生成dump文件 , 分析dump文件")]),a._v(" "),s("p",[a._v("卡死 - 先dump - 再重启")])]),a._v(" "),s("h5",{attrs:{id:"tomcat-http-header-size过大问题-hector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tomcat-http-header-size过大问题-hector"}},[a._v("#")]),a._v(" tomcat http-header-size过大问题（Hector）")]),a._v(" "),s("blockquote",[s("p",[a._v("环境上把 http-header-size 设置过大, 每次请求都占用过多内存导致OOM或GC频繁")])]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("server.max-http-header-size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("10000000")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("-Xms256m -Xmx256m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("jmeter模拟100并发请求, 发现Http11OutputBuffer实例占用巨大")])]),a._v(" "),s("h6",{attrs:{id:"lambda表达式导致方法区溢出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lambda表达式导致方法区溢出"}},[a._v("#")]),a._v(" lambda表达式导致方法区溢出")]),a._v(" "),s("blockquote",[s("p",[a._v("对于每个lambda表达式都会产生内部类, 类是装载在方法区中")])]),a._v(" "),s("h6",{attrs:{id:"直接内存溢出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#直接内存溢出"}},[a._v("#")]),a._v(" 直接内存溢出")]),a._v(" "),s("blockquote",[s("p",[a._v("使用Unsafe分配直接内存")])]),a._v(" "),s("h6",{attrs:{id:"栈溢出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#栈溢出"}},[a._v("#")]),a._v(" 栈溢出")]),a._v(" "),s("blockquote",[s("p",[a._v("-Xss设定栈大小")])]),a._v(" "),s("h6",{attrs:{id:"重写finalize引发频繁gc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重写finalize引发频繁gc"}},[a._v("#")]),a._v(" 重写finalize引发频繁GC")]),a._v(" "),s("h6",{attrs:{id:"内存占用少-频繁fgc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存占用少-频繁fgc"}},[a._v("#")]),a._v(" 内存占用少, 频繁FGC")]),a._v(" "),s("blockquote",[s("p",[a._v("System.gc() \t-XX:+DisableExplictGC")])]),a._v(" "),s("h2",{attrs:{id:"第十节-gc算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第十节-gc算法"}},[a._v("#")]),a._v(" 第十节 GC算法")]),a._v(" "),s("h3",{attrs:{id:"基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[a._v("#")]),a._v(" 基本概念")]),a._v(" "),s("h4",{attrs:{id:"card-table"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#card-table"}},[a._v("#")]),a._v(" card table")]),a._v(" "),s("blockquote",[s("p",[a._v("扫描根对象, 根对象可能指向了一个Old区对象, 然后Old区对象指回年轻代对象,  ==>> YGC也要查Old区?")]),a._v(" "),s("p",[a._v("JVM将内存分成一个个card块, 如果Old区有card指向年轻代, 就标记为 dirty card , 下次扫描时只需要扫描Dirty Card , Card 的状态记录在 Card Table 中")]),a._v(" "),s("p",[a._v("Card Table 使用 bitmap 实现")])]),a._v(" "),s("h3",{attrs:{id:"cms"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms"}},[a._v("#")]),a._v(" CMS")]),a._v(" "),s("h3",{attrs:{id:"g1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#g1"}},[a._v("#")]),a._v(" G1")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701142805759.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596354017606"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701143451926.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701142948590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596354131169"}})]),a._v(" "),s("blockquote",[s("p",[a._v("分治")]),a._v(" "),s("p",[a._v("G1把物理内存分为多个小块 Regions 产生GC时干掉存活对象最少的 Regions")]),a._v(" "),s("p",[a._v("Eden")]),a._v(" "),s("p",[a._v("Survivor")]),a._v(" "),s("p",[a._v("Old")]),a._v(" "),s("p",[a._v("Humongous 大对象, 占用多个Region")])]),a._v(" "),s("h4",{attrs:{id:"cset-collection-set"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cset-collection-set"}},[a._v("#")]),a._v(" CSet Collection Set")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701143730700.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596354619069"}})]),a._v(" "),s("blockquote",[s("p",[a._v("哪些Card需要被回收 记录在CSet里")])]),a._v(" "),s("h4",{attrs:{id:"rset-rememberedset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rset-rememberedset"}},[a._v("#")]),a._v(" RSet RememberedSet")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701145302188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596357991537"}})]),a._v(" "),s("blockquote",[s("p",[a._v("Region 中有一份被引用的表格")])]),a._v(" "),s("h4",{attrs:{id:"一般不用指定新老年代比例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一般不用指定新老年代比例"}},[a._v("#")]),a._v(" 一般不用指定新老年代比例")]),a._v(" "),s("blockquote",[s("p",[a._v("G1会动态调整GC时间, 如果YGC时间过长, 动态调整Eden区大小")])]),a._v(" "),s("h4",{attrs:{id:"g1的mixedgc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#g1的mixedgc"}},[a._v("#")]),a._v(" G1的MixedGC")]),a._v(" "),s("blockquote",[s("p",[a._v("堆占用超过一定阈值(默认45%), 触发MixedGC, 流程类似CMS(标记-标记-标记-回收)")])]),a._v(" "),s("h4",{attrs:{id:"如果g1产生fgc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果g1产生fgc"}},[a._v("#")]),a._v(" 如果G1产生FGC")]),a._v(" "),s("blockquote",[s("ol",[s("li",[a._v("加内存, CPU")]),a._v(" "),s("li",[a._v("降低MixedGC触发阈值")])])]),a._v(" "),s("h3",{attrs:{id:"并发标记算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并发标记算法"}},[a._v("#")]),a._v(" 并发标记算法")]),a._v(" "),s("h3",{attrs:{id:"三色标记法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三色标记法"}},[a._v("#")]),a._v(" 三色标记法")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701151235659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596359178768"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701153533351.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596359749250"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701154859176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzQyNDgzMzQx,size_1,color_FFFFFF,t_70",alt:"1596359221659"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200701154957245.png",alt:"1596359472818"}})]),a._v(" "),s("h4",{attrs:{id:"漏标-解决漏标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#漏标-解决漏标"}},[a._v("#")]),a._v(" 漏标, 解决漏标")]),a._v(" "),s("h4",{attrs:{id:"incremetal-update-cms"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#incremetal-update-cms"}},[a._v("#")]),a._v(" Incremetal Update - CMS")]),a._v(" "),s("blockquote",[s("p",[a._v("指针更改, 黑色 - 灰色")])]),a._v(" "),s("h4",{attrs:{id:"satb-snapshot-at-the-beginning-g1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#satb-snapshot-at-the-beginning-g1"}},[a._v("#")]),a._v(" SATB snapshot at the beginning - G1")]),a._v(" "),s("blockquote",[s("p",[a._v("不需要重复扫描 黑色")]),a._v(" "),s("p",[a._v("遍历这些引用, 直接查引用Region的 RSet 就知道他是否是垃圾")])]),a._v(" "),s("h2",{attrs:{id:"第十一节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第十一节"}},[a._v("#")]),a._v(" 第十一节")]),a._v(" "),s("blockquote",[s("p",[a._v("CMS , G1  的日志格式")]),a._v(" "),s("p",[a._v("GC常用参数")]),a._v(" "),s("p",[a._v("纤程")])]),a._v(" "),s("h4",{attrs:{id:"cms日志分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms日志分析"}},[a._v("#")]),a._v(" CMS日志分析")]),a._v(" "),s("blockquote",[s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("java -Xms20M -Xmx20M -XX:+PrintGCDetails -XX:+UseConcMarkSweepGC com.mashibing.jvm.gc.T15_FullGC_Problem01\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 年轻代日志 ParNew 和 PSPO差不多")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CMS日志")]),a._v("\nCMS Initial Mark 初始标记 老年代使用"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("老年代size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" 堆使用"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("堆size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" 耗时\nCMS-concurrent-mark 这里是并发执行\nCMS-concurrent-preclean 标记dirty card至card table, 也称为card making\nCMS Final Remark "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重新标记/最终标记 YG occaupancy(年轻代用量)")]),a._v("\n\tRescan "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parallel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#STW下存活对象标记")]),a._v("\n\tweak refs provessing "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#弱引用处理")]),a._v("\n\tclass unloading "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#卸载用不到的class")]),a._v("\n\tscrub symbol "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#清理引用")]),a._v("\n\tscrub string table "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n\tCMS-remark "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#老年代占用")]),a._v("\n堆占用"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("堆size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nCMS-concurrent-sweep "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#并发清理")]),a._v("\nCMS-concurrent-restart "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重置内部结果, 为下次GC做准备")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])])]),a._v(" "),s("h4",{attrs:{id:"g1日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#g1日志"}},[a._v("#")]),a._v(" G1日志")]),a._v(" "),s("blockquote",[s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("java -Xms20M -Xmx20M -XX:+PrintGCDetails -XX:+UseG1GC com.mashibing.jvm.gc.T15_FullGC_Problem01\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# YGC MixedGC FGC")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("[GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("pause (G1 Evacuation Pause) (young) (initial-mark), 0.0015790 secs]\t# Evacuation 阶段")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Evacuation->复制存活对象   young->年轻代\t")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# initial-mark 混合回收(MixedGC)的阶段，这里是YGC混合老年代回收 ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Parallel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Time: 1.5 ms, GC Workers: 1] #GC workers线程: 一个")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Worker Start (ms):  92635.7]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Ext")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Root Scanning (ms):  1.1]\t# 根scan")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Update")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("RS (ms):  0.0]\t\t\t# 更新RSet RememberedSet")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         [Processed")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Buffers:  1]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Scan")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("RS (ms):  0.0]\t\t\t\t# scan 一下 RS")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Code")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Root Scanning (ms):  0.0]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Object")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Copy (ms):  0.1]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Termination")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("(ms):  0.0]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         [Termination")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Attempts:  1]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Worker Other (ms):  0.0]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Worker Total (ms):  1.2]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Worker End (ms):  92636.9]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Code")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Root Fixup: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Code")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Root Purge: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Clear")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("CT: 0.0 ms]\t\t\t\t\t# 清理 CardTable")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Other")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("0.1 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Choose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("CSet: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Proc: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Enq: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Redirty")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Cards: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Humongous")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Register: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Humongous")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("Reclaim: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("      [Free")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("CSet: 0.0 ms]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Eden")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("0.0B(1024.0K)->0.0B(1024.0K) Survivors: 0.0B->0.0B Heap: 18.8M(20.0M)->18.8M(20.0M)]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("   # 打印报告, Eden S Heap 大小")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v(" [Times")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("user=0.00 sys=0.00, real=0.00 secs] ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 以下是混合回收其他阶段")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("[GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("concurrent-root-region-scan-start]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("[GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("concurrent-root-region-scan-end, 0.0000078 secs]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("[GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("concurrent-mark-start]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果无法evacuation，进行FGC")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("[Full")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("GC (Allocation Failure)  18M->18M(20M), 0.0719656 secs]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("   [Eden")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("0.0B(1024.0K)->0.0B(1024.0K) Survivors: 0.0B->0.0B Heap: 18.8M(20.0M)->18.8M(20.0M)], [Metaspace: 38")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("76K->3876K(1056768K)]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("[Times: user=0.07 sys=0.00, real=0.07 secs]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br")])])]),a._v(" "),s("h4",{attrs:{id:"gc参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gc参数"}},[a._v("#")]),a._v(" GC参数")]),a._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[a._v("-Xmn -Xms -Xmx -Xss\n年轻代 最小堆 最大堆 栈空间 后跟200m")]),a._v(" "),s("ul",[s("li",[a._v("-XX:+UseTLAB\n使用TLAB，默认打开")]),a._v(" "),s("li",[a._v("-XX:+PrintTLAB\n打印TLAB的使用情况")]),a._v(" "),s("li",[a._v("-XX:TLABSize\n设置TLAB大小")]),a._v(" "),s("li",[a._v("-XX:+DisableExplictGC\nSystem.gc()不管用 ，FGC")])])]),a._v(" "),s("li",[s("p",[a._v("-XX:+PrintGC")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+PrintGCDetails")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+PrintHeapAtGC")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+PrintGCTimeStamps")]),a._v(" "),s("p",[a._v("打印各种GC信息")]),a._v(" "),s("ul",[s("li",[a._v("-XX:+PrintGCApplicationConcurrentTime (低)\n打印应用程序时间")]),a._v(" "),s("li",[a._v("-XX:+PrintGCApplicationStoppedTime （低）\n打印暂停时长")]),a._v(" "),s("li",[a._v("-XX:+PrintReferenceGC （重要性低）\n记录回收了多少种不同引用类型的引用")])])]),a._v(" "),s("li",[s("p",[a._v("-verbose:class\n类加载详细过程")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+PrintVMOptions")]),a._v(" "),s("p",[a._v("打印JVM运行参数")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+PrintFlagsFinal  -XX:+PrintFlagsInitial\n必须会用, 查找相关参数")])]),a._v(" "),s("li",[s("p",[a._v("-Xloggc:opt/log/gc.log")])]),a._v(" "),s("li",[s("p",[a._v("-XX:MaxTenuringThreshold\n升代年龄，最大值15")]),a._v(" "),s("ul",[s("li",[a._v("锁自旋次数 -XX:PreBlockSpin")]),a._v(" "),s("li",[a._v("热点代码检测参数-XX:CompileThreshold")]),a._v(" "),s("li",[a._v("逃逸分析 标量替换 ...")])]),a._v(" "),s("p",[a._v("这些不建议设置")])])])]),a._v(" "),s("h4",{attrs:{id:"parallel常用参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parallel常用参数"}},[a._v("#")]),a._v(" Parallel常用参数")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("-XX:SurvivorRatio")]),a._v(" "),s("p",[a._v("Eden与S区比例, 默认 8:1:1")])]),a._v(" "),s("li",[s("p",[a._v("-XX:PreTenureSizeThreshold\n大对象到底多大 , 过大直接分配到Old区")])]),a._v(" "),s("li",[s("p",[a._v("-XX:MaxTenuringThreshold")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+ParallelGCThreads\n并行收集器的线程数，同样适用于CMS，一般设为和CPU核数相同")])]),a._v(" "),s("li",[s("p",[a._v("-XX:+UseAdaptiveSizePolicy\n自动选择/自适应 各区大小比例")])])]),a._v(" "),s("h3",{attrs:{id:"cms常用参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms常用参数"}},[a._v("#")]),a._v(" CMS常用参数")]),a._v(" "),s("ul",[s("li",[a._v("-XX:+UseConcMarkSweepGC 使用")]),a._v(" "),s("li",[a._v("-XX:ParallelCMSThreads\nCMS线程数量 默认使用一半 需要留给应用")]),a._v(" "),s("li",[a._v("-XX:CMSInitiatingOccupancyFraction\n使用多少比例的老年代后开始CMS收集，默认是68%(近似值)，如果频繁发生SerialOld卡顿，应该调小，（频繁CMS回收）")]),a._v(" "),s("li",[a._v("-XX:+UseCMSCompactAtFullCollection\n在FGC时进行压缩 作为解决碎片化的参数")]),a._v(" "),s("li",[a._v("-XX:CMSFullGCsBeforeCompaction\n多少次FGC之后进行压缩")]),a._v(" "),s("li",[a._v("-XX:+CMSClassUnloadingEnabled 回收不用的class")]),a._v(" "),s("li",[a._v("-XX:CMSInitiatingPermOccupancyFraction\n达到什么比例时进行Perm回收")]),a._v(" "),s("li",[a._v("GCTimeRatio\n设置GC时间占用程序运行时间的百分比")]),a._v(" "),s("li",[a._v("-XX:MaxGCPauseMillis\n停顿时间，是一个建议时间，GC会尝试用各种手段达到这个时间，比如减小年轻代")])]),a._v(" "),s("h4",{attrs:{id:"g1常用参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#g1常用参数"}},[a._v("#")]),a._v(" G1常用参数")]),a._v(" "),s("ul",[s("li",[a._v("-XX:+UseG1GC")]),a._v(" "),s("li",[a._v("-XX:MaxGCPauseMillis\n建议值，G1会尝试调整Young区的块数来达到这个值")]),a._v(" "),s("li",[a._v("-XX:GCPauseIntervalMillis\n？GC的间隔时间")]),a._v(" "),s("li",[a._v("-XX:+G1HeapRegionSize\n分区大小，建议逐渐增大该值，1 2 4 8 16 32。单位 m\n随着size增加，垃圾的存活时间更长，GC间隔更长，但每次GC的时间也会更长\nZGC做了改进（动态区块大小）")]),a._v(" "),s("li",[a._v("G1NewSizePercent\n新生代最小比例，默认为5%")]),a._v(" "),s("li",[a._v("G1MaxNewSizePercent\n新生代最大比例，默认为60%")]),a._v(" "),s("li",[a._v("GCTimeRatio\nGC时间建议比例，G1会根据这个值调整堆空间")]),a._v(" "),s("li",[a._v("ConcGCThreads\n线程数量")]),a._v(" "),s("li",[a._v("InitiatingHeapOccupancyPercent\n启动G1的堆空间占用比例")])]),a._v(" "),s("h2",{attrs:{id:"补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[a._v("#")]),a._v(" 补充")]),a._v(" "),s("h3",{attrs:{id:"zgc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zgc"}},[a._v("#")]),a._v(" ZGC")]),a._v(" "),s("h4",{attrs:{id:"colored-pointer-loadbarrier"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#colored-pointer-loadbarrier"}},[a._v("#")]),a._v(" Colored Pointer + LoadBarrier")]),a._v(" "),s("blockquote",[s("p",[a._v("GC信息记录在指针上, 而不是记录在对象头部")]),a._v(" "),s("p",[a._v("指针更改后, 马上可以重用原来指向的内存空间")]),a._v(" "),s("p",[a._v("不支持32位系统, 不可用压缩指针, 取指针中前 19-22 共4位作为标记, 根据标记来决定是否做一些事情")]),a._v(" "),s("p",[a._v("这四位可以看做是不同空间的虚拟地址")])]),a._v(" "),s("h4",{attrs:{id:"cpu如何区分指令和数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cpu如何区分指令和数"}},[a._v("#")]),a._v(" CPU如何区分指令和数")]),a._v(" "),s("blockquote",[s("p",[a._v("总线内部分为: 数据总线 , 地址总线 , 控制总线")]),a._v(" "),s("p",[a._v("目前地址总线是48位")])])])}),[],!1,null,null,null);t.default=n.exports}}]);